!function(){var t=Ext.versions.extjs.major.toString()+Ext.versions.extjs.minor.toString()+Ext.versions.extjs.pad.toString();"600"===t&&(t="6"),Ext.Loader.setPath({Fm:AppConfig.urlStartWith+"Fm",FmApp:AppConfig.urlStartWith+"FmApp",Ext:AppConfig.urlStartWith+"FmContent/lib/extjs"+t+"/src","Ext.draw.ContainerBase":AppConfig.urlStartWith+"FmContent/lib/extjs"+t+"/build/charts.js"})}(),Ext.Error.ignore=!0,Ext.Ajax.setTimeout(AppConfig.ajaxTimeOut),Ext.setGlyphFontFamily("FontAwesome"),Ext.EventManager.on(window,"keydown",function(t,o){t.getKey()!=t.BACKSPACE||/^input|textarea$/i.test(o.tagName)&&!o.disabled&&!o.readOnly||t.stopEvent()}),AppConfig.isDev||(window.onerror=function(t,o,a,n,e){return!0},Ext.Loader.setConfig({disableCaching:!1})),window._fmapp_now_mask_view="";var application;Ext.define("Fm.BaseApp",{extend:"Ext.app.Application",enabled:!0,requires:["Ext.window.MessageBox"],mask:null,masks:{},showMask:function(t,o){var a=application,n=a.getMainView().down(t+"[maskParam="+o+"]"),e=(t||"")+(o||"");if(n||(n=a.getMainView().down(t)),window._fmapp_now_mask_view=e,e?n&&(a.masks[e]||(a.masks[e]=new Ext.LoadMask({msg:AppConfig.maskHtml,style:{backgroundColor:"rgba(255, 255, 255, 0.5);"},border:!1,target:n})),a.masks[e].show()):a.globalMask.show(),!t){Ext.log.error("[showMask] 需要传入view参数.");try{{t.exception}}catch(i){Ext.log.error(i.stack)}}},hideMask:function(t,o){var a=application,n=(t||"")+(o||"");if(n?a.masks[n]&&(Ext.destroy(a.masks[n]),a.masks[n]=void 0):a.globalMask.hide(),!t){Ext.log.error("[showMask] 需要传入view参数.");try{{t.exception}}catch(e){Ext.log.error(e.stack)}}},loginOut:function(t){application.showMask();var o=function(){return a=window.location.pathname.toLowerCase(),a.substr(0,AppConfig.urlStartWith.length)===AppConfig.urlStartWith&&(a=a.substr(0,AppConfig.urlStartWith.length)),"/"===a.substr(a.length-1,1)&&(a=a.substr(a.length-1,1)),a.length?"/"!==a.substr(0,1)&&(a="/"+a):a="_default",a},a=o(),n=Fm.Server.Config.AppNameInfo[a]||Fm.Server.Config.AppNameInfo._default,e=Fm.Server.Config.AppIcoInfo[a]||Fm.Server.Config.AppIcoInfo._default;window.location=AppConfig.loginOutUrl+"?url="+escape(window.location.href)+"&name="+escape(n)+"&logo="+escape(window.location.origin+AppConfig.urlStartWith+e)},addBookmark:function(t,o,a,n){var e=application.getMainView(),i=e.down("sysuser_userbookmark");i.getController().addBookmark(t,o,a,n)}});
Ext.override(Ext.data.validator.Email,{config:{message:'该输入项必须是电子邮件地址，格式如： "user@example.com"'}}),Ext.override(Ext.data.validator.Length,{config:{minOnlyMessage:"长度必须大于 {0}",maxOnlyMessage:"长度不能超过 {0}",bothMessage:"长度必须为 {0}到{1}"}}),Ext.define("Ext.data.validator.ByteLength",{extend:"Ext.data.validator.Bound",alias:"data.validator.bytelength",type:"bytelength",config:{maxOnlyMessage:"长度不能超过 {0}个字符(一个汉字算两个字符)"},getValue:function(a){var e=String(a);return e.length+(e.match(/[^x00-xff]/g)||[]).length}});
Ext.override(Ext.Component,{responsiveFormulas:{w800:function(e){var i="true"===Cookie.get("main-left-panel-micro").toString()?AppConfig.Design.Menu.MinWidth:AppConfig.Design.Menu.MaxWidth;return e.width-i<1e3},w1000:function(e){var i="true"===Cookie.get("main-left-panel-micro").toString()?AppConfig.Design.Menu.MinWidth:AppConfig.Design.Menu.MaxWidth;return e.width-i>=1e3&&e.width-i<1200},w1200:function(e){var i="true"===Cookie.get("main-left-panel-micro").toString()?AppConfig.Design.Menu.MinWidth:AppConfig.Design.Menu.MaxWidth;return e.width-i>=1200}},config:{selfConfig:null},resetAll:function(){var e=this,i=e.query("form"),t=e.query("grid,dataview");try{var n=[];e.isForm&&!e.isIgnoreReset&&(e.reset(!0),e.fireEvent&&e.fireEvent("resetallvalue",e),n=e.query("datefield")),Ext.Array.each(i,function(e){e.isIgnoreReset||(e.reset(!0),e.fireEvent&&e.fireEvent("resetallvalue",e),n=Ext.Array.merge(n,e.query("datefield")))}),Ext.Array.each(n,function(e){e.fireEvent("resetminmaxvalue",e)}),Ext.Array.each(t,function(e){var i=e.getStore();i&&!i.isEmptyStore&&i.clearAll&&!i.isIgnoreReset&&(i.clearAll(),i.clearFilter())})}catch(r){}},initComponent:function(){var e=this,i=e.width,t=e.height;if(e.fieldLabel&&e.up("base_searchform")){var n=(e.fieldLabel||"").toString(),r=n.trim().length+(n.match(/[^x00-xff]/g)||[]).length;r>8&&(e.labelWidth=AppConfig.Design.SearchPanel.Items.LabelWidth+6*(r-8))}try{e.plugins&&!e.plugins.processed&&(e.plugins=e.constructPlugins()),e.pluginsInitialized=!0,(null!=i||null!=t)&&e.setSize(i,t),e.listeners&&(e.on(e.listeners),e.listeners=null),e.focusable&&e.initFocusable()}catch(l){Ext.log.error(l.stack)}}});
!function(){Ext.override(Ext.container.Container,{getExportData:function(e,t){var n=this,i=2*(n.layout.columns||0),o=[],e=e||1,t=t||0,r=0,l=0,u=1,g=document.createElement("div");return Ext.Array.forEach(n.items.items,function(n){if(!n.hidden){l>=i&&(l=0,r++),o.push({CellValue:n.fieldLabel,RowNumber:e+r,CellNumber:t+l,CellCount:1,CellType:"Right"}),l+=1,u=2*(n.colspan||1)-1;var h=n.renderer?n.renderer(n.value):n.value;g.innerHTML=h,h=g.innerText||g.textContent,o.push({CellValue:h||"",RowNumber:e+r,CellNumber:t+l,CellCount:u}),l+=u}}),{Cells:o,EndRow:e+r,EndCol:t+l}},foldPanel:function(e){var t=this,n=t,i=(n.down("[region=north]"),n.down("[region=center]")),o=(n.down("[region=east]"),n.down("[region=south]"));if(0!==o.getHeight()&&0!==i.getHeight()&&(t._southHeight=o.getHeight()),"c"===e)o.setHeight(0===o.getHeight()?t._southHeight:0);else if("s"===e){var r=n.getHeight();o.setHeight(o.getHeight()===r?t._southHeight:r)}}})}();
!function(){var r=Ext.data.Connection.prototype.request;Ext.data.Connection.prototype.request=void 0,Ext.override(Ext.data.Connection,{request:function(s){s=s||{};var e=this,t=s.scope||window,o=s.callback;s.callback=void 0,s.url=(AppConfig.urlStartWith+s.url).replace("//","/");var a=function(){application.loginOut()},c=window._fmapp_now_mask_view+"",n={NetWorkErrorMsg:"网络错误，请检查您的网络。",ServerErrorMsg:"服务器异常，请联系管理人员。",LoadErrorMsg:"加载出错"},i=function(r,s,e){var i=e.responseJson={ErrCode:null,ErrMsg:null,IsSuccess:!0};if(e.status>=400&&e.status<500||0==e.status)i.ErrMsg=n.NetWorkErrorMsg;else if(e.status>=500)i.ErrMsg=n.ServerErrorMsg;else if(e.responseText){var l=e.responseText.match(/("ErrCode[\s\S]*ErrMsg[\s\S]*),"AttachedObject"/);if(l&&l.length){var u="{"+l[1]+"}";i=Ext.JSON.decode(u)}}else s&&(i.ErrMsg=n.loadErrorMsg);if(i.IsSuccess=!i.ErrMsg,!i.IsSuccess){"1002"===i.ErrCode?Ext.Msg.alert("登录过期",i.ErrMsg,function(){a()}):Fm.msg.error(i.ErrMsg);try{application.hideMask(c)}catch(E){}}o&&o.call(t,r,i.IsSuccess,e)};s.callback=i,s.error||(s.error=function(){application.hideMask(c)}),r.call(e,s)}})}();
var _timeZDiffValue=Date.parse("2015-01-01T01:00:00")-14200452e5,_timeZDiffNotTValue=Date.parse("2015-01-01 01:00:00")-14200452e5;Ext.override(Ext.data.field.Date,{convert:function(e){if(!e)return null;if(e instanceof Date)return e;var t=this.dateReadFormat||this.dateFormat;if(t)return Ext.Date.parse(e,t);var a,r=e.split(/[T\-\\\/:\s\.]/i),a=new Date(r[0]||1700,parseInt(r[1]||1,10)-1,r[2]||1,r[3]||0,r[4]||0,r[5]||0);return Ext.isDate(a)?a:null}});
Ext.override(Ext.data.validator.Presence,{config:{message:"必填"},validate:function(t){var e=!(void 0===t||null===t||""===t.toString().trim());return e&&!this.getAllowEmpty()&&(e=!(""===t)),e?!0:this.getMessage()}});
Ext.override(Ext.dd.DragSource,{onInvalidDrop:function(t,e,i){this.hideProxy(),delete this.cachedTarget}}),Ext.override(Ext.dd.DD,{configGetFly:function(t){return t.id?t:t[0]},alignElWithMouse:function(t,e,i){var h,a,d,o,n=this.getTargetCoord(e,i),t=this.configGetFly(t),c=t.dom?t:Ext.fly(t,"_dd"),s=c.getSize(),g=Ext.Element;return this.deltaSetXY?(h=this.cachedViewportSize,this.setLocalXY(c,Math.max(0,Math.min(n.x+this.deltaSetXY[0],h.width-s.width)),Math.max(0,Math.min(n.y+this.deltaSetXY[1],h.height-s.height)))):(h=this.cachedViewportSize={width:g.getDocumentWidth(),height:g.getDocumentHeight()},a=[Math.max(0,Math.min(n.x,h.width-s.width)),Math.max(0,Math.min(n.y,h.height-s.height))],c.setXY(a),d=this.getLocalX(c),o=c.getLocalY(),this.deltaSetXY=[d-n.x,o-n.y]),this.cachePosition(n.x,n.y),this.autoScroll(n.x,n.y,t.offsetHeight,t.offsetWidth),n}});
Ext.override(Ext.form.CheckboxGroup,{twoWayBindable:["value"],defaultBindProperty:"value",valuePublishEvent:"updatebindvalue",getValue:function(){for(var e,t,u=[],a=this.getBoxes(),n=0;n<a.length;n++)e=a[n],t=e.inputValue,e.getValue()&&u.push(t);return u},checkChange:function(e,t){this.fireEvent("updatebindvalue")},setValue:function(e){if(null!==e&&void 0!==e&&Ext.isArray(e)){var t,u,a,n=this,i=n.getBoxes(),r=(n.values,i.length);return n.batchChanges(function(){for(Ext.suspendLayouts(),t=0;r>t;t++)u=i[t],a=!1,e&&(a=Ext.isArray(e)?Ext.Array.contains(e,u.inputValue):e),u.setValue(a);Ext.resumeLayouts(!0)}),n}}}),Ext.override(Ext.form.RadioGroup,{valuePublishEvent:"updatebindvalue",checkChange:function(){this.fireEvent("updatebindvalue")},getValue:function(){for(var e,t,u=null,a=this.getBoxes(),n=0;n<a.length;n++)e=a[n],t=e.inputValue,e.getValue()===!0&&(u=t);return u},setValue:function(e){if(null!==e&&void 0!==e){var t,u=this,a=u.getBoxes();Ext.suspendLayouts();for(var n=0;n<a.length;++n)t=a[n],t.setValue(e===t.inputValue?!0:!1);return Ext.resumeLayouts(!0),u}}});
Ext.override(Ext.form.field.Base,{validateValue:function(e){var a=this,r=a.getErrors(e),t=Ext.isEmpty(r);return a.preventMark||(t?a.clearInvalid():(a.bind&&a.bind.value&&a.bind.value.setValue&&a.bind.value.setValue(a.getValue()),a.markInvalid(r))),t}});
Ext.override(Ext.form.field.ComboBox,{editable:!1,showClearTriggers:!0,emptyText:"全部",singleIsArray:!1,applyTriggers:function(e){var r=this,l=e.picker,i={};l&&!l.cls&&(l.cls=r.triggerCls),r.showClearTriggers&&(i.clear={cls:"cisapp-form-field-clear",renderTpl:'<div id="{triggerId}" class="{baseCls} {baseCls}-{ui} {cls}"></div>',handler:function(){this.clearValue&&this.clearValue(),this.clearTreeChecked&&this.clearTreeChecked(),r.fireEvent("change",r)},scope:"this"});for(var s in e)i[s]=e[s];return r.callParent([i])},getValue:function(){var e=this,r=e.callParent(arguments);return!e.multiSelect&&e.singleIsArray&&r?[r]:r}});
Ext.override(Ext.form.field.Date,{format:"Y-m-d",formatText:"日期格式要求为: 年-月-日",invalidText:"{0} 是无效的日期 必须符合格式：年-月-日",valuePublishEvent:["select","blur","updatebind"],validateOnChange:!1,isRequirsResetMaxMinValue:!1,initComponent:function(){var t=this;t.callParent();var e=["blur","select","validateforreset"],a=function(e,a){t.validate()};Ext.Array.each(e,function(e){t.on(e,a)}),t.on("specialkey",function(e,a){a.getKey()==a.ENTER&&t.validate()}),t.hasListener("change")?t.onAfter("change",t.autoFormat):t.on("change",t.autoFormat);var r=function(){var e=t;e.isRequirsResetMaxMinValue&&(e.setMinValue(0),e.setMaxValue(0))};t.on("resetminmaxvalue",r)},checkDate:function(t){return t instanceof Date?!0:t?new Date(t).getDate()==t.toString().substring(t.length-2):!1},autoFormat:function(t,e){var a;if(e){var r=this.checkDate(e);if(r)10===t.rawValue.length&&t.fireEvent("blur",t);else{switch(dateString=e.toString().replace(/-/g,""),dateString.length){case 5:a=dateString.substr(0,4)+"-"+dateString.substr(4,1);break;case 6:a=dateString.substr(0,4)+"-"+dateString.substr(4,2);break;case 7:var a=dateString.substr(0,4)+"-"+dateString.substr(4,2)+"-"+dateString.substr(6,1);break;case 8:a=dateString.substr(0,4)+"-"+dateString.substr(4,2)+"-"+dateString.substr(6,2),t.fireEvent("blur",t);break;default:return}t.setRawValue(a)}}}});
Ext.override(Ext.form.field.Number,{repeatTriggerClick:!1,decimalPrecision:2,maxValue:9999999999999,initComponent:function(){var e=this;e.callParent(),e.on({change:function(i,a){if("-"!==a){var n=e.parseValue(Ext.Number.constrain(a,i.minValue,i.maxValue));n&&(n=n.toFixed(e.decimalPrecision)),e.setValue(n)}}})}});
Ext.override(Ext.form.field.Picker,{doAlign:function(){var e,t=this,i=t.picker,g="-above";e=i.el.getY()<t.inputEl.getY(),t.bodyEl[e?"addCls":"removeCls"](t.openCls+g),i[e?"addCls":"removeCls"](i.baseCls+g);var r=t.triggerWrap.getXY(),d=Ext.Element;r[1]=r[1]+t.getHeight(),r[0]+i.getWidth()>d.getViewportWidth()&&(r[0]=d.getViewportWidth()-i.getWidth()),r[1]+i.getHeight()>d.getViewportHeight()&&(r[1]=r[1]-i.getHeight()-t.getHeight()),t.picker.setXY(r)}});
Ext.override("Ext.form.field.Text",{allowOnlyWhitespace:!1});
Ext.override("Ext.form.field.TextArea",{allowOnlyWhitespace:!1});
Ext.override(Ext.form.field.VTypes,{daterange:function(e,t){var a=t.parseDate(e);if(!a)return!1;if(!t.startDateField||this.dateRangeMax&&a.getTime()==this.dateRangeMax.getTime()){if(t.endDateField){var r=t.up("daterange").down("#"+t.endDateField)||Ext.getCmp(t.endDateField);r.setMinValue(a)}}else{var d=t.up("daterange").down("#"+t.startDateField)||Ext.getCmp(t.startDateField);d.setMaxValue(a),this.dateRangeMax=a}return!0},daterangeText:"开始日期必须小于结束日期",numberrange:function(e,t){var a=parseFloat(e);if(t.startNumberField){var r=t.up("fieldcontainer").down("#"+t.startNumberField)||Ext.getCmp(t.startNumberField);r.maxValue=a}else if(t.endNumberField){var d=t.up("fieldcontainer").down("#"+t.endNumberField)||Ext.getCmp(t.endNumberField);d.minValue=a}return!0}});
Ext.override(Ext.form.Label,{clickEvent:"click",onRender:function(){var e=this;e.callParent(arguments),e.el.on({click:e.onClick,scope:e})},doPreventDefault:function(e){e&&(this.preventDefault||this.disabled&&this.getHref())&&e.preventDefault()},onClick:function(e){var t=this;t.doPreventDefault(e),t.fireEvent("click",t,e)===!1||t.destroyed||Ext.callback(t.handler,t.scope,[t,e],0,t)}});
Ext.override(Ext.form.Panel,{isForm:!0,isIgnoreReset:!1});
Ext.override(Ext.grid.column.Column,{hideable:!1,menuDisabled:!0,initComponent:function(){var r=this;if(r.showTip)if(r.renderer){var e=r.renderer;r.renderer=function(r,t,n,i,d,l,u){var a=e(r,t,n,i,d,l,u);return null!==a&&void 0!==a&&null!==t&&(t.tdAttr||(t.tdAttr='data-qtip="'+a+'"')),a}}else r.renderer=function(r,e){return null!==r&&void 0!==r&&null!==e&&(e.tdAttr='data-qtip="'+r+'"'),r};r.callParent()}});
Ext.override(Ext.grid.column.RowNumberer,{align:"center",resizable:!0,width:50});
Ext.override(Ext.grid.column.Widget,{sortable:!0,ignoreExport:!1,setWidgetVal:function(e,t){var i=this.dataIndex;if(e&&this.rendered){if(e.cisBindProperty){var d={};for(var a in e.cisBindProperty){var r=t.get(e.cisBindProperty[a].dataIndex);e.cisBindProperty[a].renderer&&(r=e.cisBindProperty[a].renderer(r,t)),d[a]=r,e.setConfig(d)}}else if(e.defaultBindProperty&&i){var r=t.get(i);e.renderer&&(r=e.renderer(r,t)),e.setConfig(e.defaultBindProperty,r)}e.updateLayout()}},updateWidget:function(e){{var t;this.dataIndex}this.rendered&&(t=this.liveWidgets[e.internalId],this.setWidgetVal(t,e))},onViewRefresh:function(e,t){var i,d,a,r,n,s,l,o,g,h,c,p=this,f=e.all,x=!!p.onWidgetAttach,y=p.liveWidgets,b=(p.dataIndex,p.isFixedSize);if(p.isVisible(!0)){for(p.liveWidgets={},Ext.suspendLayouts(),s=f.startIndex,l=0;s<=f.endIndex;s++,l++)o=t[l],o.isNonData||(n=o.internalId,i=e.getRow(f.item(s)).cells[p.getVisibleIndex()].firstChild,d=p.liveWidgets[n]=y[n]||p.getFreeWidget(),d.$widgetRecord=o,d.$widgetColumn=p,delete y[n],h=p.lastBox,h&&!b&&void 0===r&&(r=h.width-parseInt(p.getCachedStyle(i,"padding-left"),10)-parseInt(p.getCachedStyle(i,"padding-right"),10)),this.setWidgetVal(d,o),x&&Ext.callback(p.onWidgetAttach,p.scope,[p,d,o],0,p),a=d.el||d.element,a?(c=a.dom,c.parentNode!==i&&(Ext.fly(i).empty(),i.appendChild(a.dom)),b||d.setWidth(r),d.reattachToBody()):(b||(d.width=r),Ext.fly(i).empty(),d.render(i)));Ext.resumeLayouts(!0);for(g in y)d=y[g],d.$widgetRecord=d.$widgetColumn=null,p.freeWidgetStack.unshift(d),d.detachFromBody()}},onItemAdd:function(e,t,i){var d,a,r,n,s,l,o,g,h=this,c=h.getView(),p=!!h.onWidgetAttach,f=(h.dataIndex,h.isFixedSize),x=e.length;if(h.isVisible(!0))for(d=0;x>d;d++)a=e[d],a.isNonData||(r=c.getRowFromItem(i[d]),r&&(n=r.cells[h.getVisibleIndex()].firstChild,f||g||(g=h.lastBox.width-parseInt(h.getCachedStyle(n,"padding-left"),10)-parseInt(h.getCachedStyle(n,"padding-right"),10)),s=h.liveWidgets[a.internalId]=h.getFreeWidget(),s.$widgetColumn=h,s.$widgetRecord=a,Ext.fly(n).empty(),this.setWidgetVal(s,a),p&&Ext.callback(h.onWidgetAttach,h.scope,[h,s,a],0,h),l=s.el||s.element,l?(n.appendChild(l.dom),f||s.setWidth(g),s.reattachToBody()):(f||(s.width=g),s.render(n)),o=s.getFocusEl(),o&&(c.actionableMode?o.isTabbable()||o.restoreTabbableState():o.isTabbable()&&o.saveTabbableState())))}});
Ext.override(Ext.grid.View,{enableTextSelection:!0});
!function(){Ext.apply(Ext.Boot,{create:function(r,e,t){var a=t||{};try{r=Ext.urlAppend(r,"_v="+AppConfig.version)}catch(o){}return a.url=r,a.key=e,Ext.Boot.scripts[e]=new Ext.Boot.Entry(a)}}),Ext.apply(Ext.Loader,{loadScript:function(r){var e=Ext.Loader,t="string"==typeof r,a=r instanceof Array,o=!a&&!t,s=o?r.url:r,n=o&&r.onError,l=o&&r.onLoad,i=o&&r.scope,c={url:(AppConfig.urlStartWith+s).replace("//","/"),scope:i,onLoad:l,onError:n,_classNames:[]};e.loadScripts(c)},onLoadFailure:function(){var r=Ext.Loader,e=this,t=e.onError;if(r.hasFileLoadError=!0,--r.scriptsLoading,t)t.call(e.userScope,e);else{Ext.Msg.alert("操作失败","网络已断开,请检查您的网络并重试。"),Ext.log.error("[Ext.Loader] Some requested files failed to load.");for(var a=arguments[0].entries,o=0;o<a.length;o++)a[o].error&&(Ext.Boot.scripts[a[o].key]=void 0,Ext.log.error("[Ext.Loader]类: "+e._classNames[o]+" 加载失败,请检查requires或者uses配置路径。"))}r.checkReady()}}),Ext.apply(Ext,{create:function(){try{var r,e=arguments[0],t=typeof e,a=Array.prototype.slice.call(arguments,1);"function"===t?r=e:("string"!==t&&0===a.length&&(a=[e],(e=e.xclass)||(e=a[0].xtype,e&&(e="widget."+e))),("string"!=typeof e||e.length<1)&&Ext.log.error("[Ext.create] Invalid class name or alias '"+e+"' specified, must be a non-empty string"),e=Ext.ClassManager.resolveName(e),r=Ext.ClassManager.get(e));var o="undefined"==typeof window;return r||(!o&&Ext.log.warn("[Ext.Loader] Synchronously loading '"+e+"'; consider adding Ext.require('"+e+"') above Ext.onReady"),Ext.syncRequire(e),r=Ext.ClassManager.get(e)),r||Ext.log.error("[Ext.create] Unrecognized class name / alias: "+e),"function"!=typeof r&&Ext.log.error("[Ext.create] Singleton '"+e+"' cannot be instantiated."),Ext.ClassManager.getInstantiator(a.length)(r,a)}catch(s){Ext.log.error("[Ext.create] 位于Class "+e+" .消息:"+s.message),Ext.log.error(s.stack),application.globalMask.hide()}}}),Ext.apply(Ext.Error,{raise:function(r){r=r||{},Ext.isString(r)&&(r={msg:r});var e,t,a=this,o=a.raise.caller;o===Ext.raise&&(o=o.caller),o&&(!r.sourceMethod&&(t=o.$name)&&(r.sourceMethod=t),!r.sourceClass&&(t=o.$owner)&&(t=t.$className)&&(r.sourceClass=t)),a.handle(r)!==!0&&(e=toString.call(r),AppConfig.isDev&&Fm.msg.error(e),Ext.log.error(e))}})}();
!function(){Ext.override(Ext.layout.component.Dock,{handleItemBorders:function(){var r=this,e=r.owner;e.border!==!0&&(e.border=!1),r.callParent(arguments)}})}();
!function(){Ext.override(Ext.layout.container.Table,{config:{columns:null},getLayoutItems:function(){var t,e,i=this,n=i.owner,o=[],r=n&&n.items,u=r&&r.items||[],l=u.length;for(e=0;l>e;e++)t=u[e],t.hidden&&"visibility"!==t.hideMode||o.push(t);return o}})}();
Ext.override(Ext.list.Tree,{floatItem:function(e,t){var r=this;r.callParent(arguments),e.element.on("mouseout",r.checkForMouseLeave,r)}}),Ext.override(Ext.list.TreeItem,{isSelectionEvent:function(e){var t=this,r=this.getOwner();return r.fireEvent("itemclick",r,t.getNode()),!1}});
Ext.override(Ext.panel.Panel,{border:!1,frame:!1,closeToolText:"关闭"});
Ext.override(Ext.panel.Table,{setDisabled:function(e){{var t=this;t.getView()}Ext.suspendLayouts(),Ext.Array.each(e,function(e){e.set({_isDisabled:!0})}),Ext.resumeLayouts(!0)},updateBindSelection:function(e,t){var i=this,n=null;i.ignoreNextSelection||(i.ignoreNextSelection=!0,t.length&&(n="SINGLE"===e.selectionMode?e.getLastSelected():i.getSelection(),i.hasHadSelection=!0),i.hasHadSelection&&i.setSelection(n),i.ignoreNextSelection=!1)},getRowExpander:function(){if(this.plugins&&Ext.isArray(this.plugins)){for(var e=0;e<this.plugins.length;e++)if(this.plugins[e].isRowExpander)return this.plugins[e]}else if(this.plugins&&this.plugins.isRowExpander)return this.plugins},getClickSelectionModel:function(){if(this.plugins&&Ext.isArray(this.plugins)){for(var e=0;e<this.plugins.length;e++)if(this.plugins[e].isClickSelection)return this.plugins[e]}else if(this.plugins&&this.plugins.isClickSelection)return this.plugins},getExportColumns:function(){var e=this,t=e.getColumns(),i=Ext.Array.filter(t,function(e){return!e.isCheckerHd&&!e.ignoreExport});return i},exportAlign:{left:"Left",right:"Right",center:"Center"},getExportData:function(e){var t,i,n,r,s=this,l=s.getExportColumns(),o=l.length,a=[],u=[],g=/<.*>(.*)<\/.*>|<.*\/>/;if(Ext.Array.each(l,function(e){if(!e.isCheckerHd&&!e.ignoreExport){var t=e.exportWidth||e.width;try{t=e.getWidth()}catch(i){}a.push({TitleName:e.text,TitleValue:e.exportIndex||e.dataIndex,TitleWide:Math.ceil(t/7.5),IsRMB:!!e.exportIsRMB,IsCount:!!e.exportIsCount,DataType:e.dataType,Digit:e.digit,CellType:s.exportAlign[e.align]})}}),e)for(var h=0;h<e.length;h++){t=e[h],i={};for(var p=0;o>p;p++){if(n=l[p],r=t.get(n.dataIndex),n.exportRender?r=n.exportRender(r,null,t):n.renderer&&n.renderer.length>0&&(r=n.renderer(r,null,t)),(null===r||void 0===r)&&(r=""),r=r.toString(),r&&(_v=r.replace(/￥/g,""),_v)){r=_v;var d=r.match(g);d&&(r=d[1])}i[n.exportIndex||n.dataIndex]=r.trim()}u.push(i)}return{titles:a,rows:u}}});
Ext.override(Ext.panel.Title,{onRender:function(){var e=this;e.callParent(arguments),e.el.on({dblclick:e.ondblClick,scope:e})},doPreventDefault:function(e){e&&(this.preventDefault||this.disabled&&this.getHref())&&e.preventDefault()},ondblClick:function(e){var t=this;t.doPreventDefault(e),t.up("tabpanel")&&t.up("tabpanel").fireEvent("tabbardblclick",t,e)!==!1&&!t.destroyed&&Ext.callback(t.handler,t.scope,[t,e],0,t)}});
Ext.override(Ext.resizer.Splitter,{size:5,defaultSplitMin:0,collapseOnDblClick:!1});
!function(){Ext.override(Ext.selection.CheckboxModel,{updateHeaderState:function(){var e,t,o,i,r,d=this,n=d.views,s=!1,f=0;if(e=d.store.store,e||(e=d.store),t=e.getCount(),!e.isBufferedStore&&t>0){for(o=d.selected,s=!0,r=0,i=o.getCount();i>r&&-1!==e.indexOfId(o.getAt(r).id);++r)++f;s=t===f}n&&n.length&&d.toggleUiHeader(s)}})}();
!function(){Ext.override(Ext.selection.Model,{bindCheckedField:null,addSelectItems:function(){var e=this;Ext.suspendLayouts(),e.suspendChanges(),e.selected.removeAll();var t=[];Ext.Array.each(e.store.getData().items,function(n){n.get(e.bindCheckedField)&&t.push(n)}),e.select(t,!0,!0),e.fireEvent("updateGroupSelect"),e.resumeChanges(),Ext.resumeLayouts(!0)},onStoreLoad:function(){var e=this,t=e.store;e.bindCheckedField&&null!=t&&t.getData().items.length>0&&e.addSelectItems()},updateGroupSelect:function(){},doDeselectNew:function(e,t){var n,l,s,i=this,r=i.selected,o=0,c=0,a=0;if(i.locked||!i.store)return!1;if("number"==typeof e){if(l=i.store.getAt(e),!l)return!1;e=[l]}else Ext.isArray(e)||(e=[e]);for(s=function(){++a,l===i.selectionStart&&(i.selectionStart=null)},n=e.length,i.suspendChanges();n>o;o++)l=e[o],i.isSelected(l)&&(i.lastSelected===l&&(i.lastSelected=r.last()),++c,i.onSelectChange(l,!1,t,s));return r.removeAll(),i.resumeChanges(),i.maybeFireSelectionChange(a>0&&!t),a===c},deselectAll:function(e){var t,n,l,s,i,r=this,o={},c=r.store;for(t=r.getSelection(),n=t.length,t=Ext.Array.filter(t,function(e){return!e.get("_isDisabled")}),l=0,s=t.length;s>l;l++)i=t[l],o[i.id]=c.indexOf(i);t=Ext.Array.sort(t,function(e,t){var n=o[e.id],l=o[t.id];return l>n?-1:1}),r.suspendChanges(),r.doDeselectNew(t,!0),r.resumeChanges(),r.fireEvent("deselectAll",r,r.getSelection()),e||r.maybeFireSelectionChange(r.getSelection().length!==n)},selectAll:function(e){var t=this,n=t.store,l=n.getData().items,s=t.getSelection().length,i=Ext.Array.filter(l,function(e){return!e.get("_isDisabled")});t.suspendChanges(),t.doSelect(i,!0,!0),t.resumeChanges(),t.fireEvent("selectAll",t,i),e||t.destroyed||t.maybeFireSelectionChange(t.getSelection().length!==s)},doMultiSelectNew:function(e,t,n){var l,s,i,r,o=this,c=o.selected,a=!1;if(!o.locked&&(e=Ext.isArray(e)?e:[e],e=Ext.Array.filter(e,function(e){return!e.get("_isDisabled")}),s=e.length,!t&&c.getCount()>0&&(o.deselectAll(),a=!0),s)){for(o.suspendChanges(),o.selectionStart=e[0],r=function(){},c.add(e),a=!0,l=0;s>l;l++)if(i=e[l],o.onSelectChange(i,!0,!0,r),o.destroyed)return;o.resumeChanges(),o.lastSelected=i,o.maybeFireSelectionChange(a&&!n)}},doSelect:function(e,t,n){var l,s=this;if(!s.locked&&null!=e){if("number"==typeof e){if(l=s.store.getAt(e),!l)return;e=[l]}"SINGLE"===s.selectionMode?(e.isModel&&(e=[e]),e.length&&s.doSingleSelect(e[0],n)):s.doMultiSelectNew(e,t,n)}}})}();
Ext.override(Ext.tab.Bar,{onRender:function(){var e=this;e.callParent(arguments),e.el.on({dblclick:e.ondblClick,scope:e})},doPreventDefault:function(e){e&&(this.preventDefault||this.disabled&&this.getHref())&&e.preventDefault()},ondblClick:function(e){var t=this;t.doPreventDefault(e)}});
Ext.override(Ext.toolbar.Toolbar,{defaultButtonUI:"default",dblclickEvent:"dblclick",onRender:function(){var e=this;e.callParent(arguments),e.el.on({dblclick:e.ondblClick,scope:e})},doPreventDefault:function(e){e&&(this.preventDefault||this.disabled&&this.getHref())&&e.preventDefault()},ondblClick:function(e){var t=this;t.doPreventDefault(e),t.fireEvent("dblclick",t,e)===!1||t.destroyed||Ext.callback(t.handler,t.scope,[t,e],0,t)}});
Ext.override(Ext.tree.Column,{config:{cellTpl:['<tpl for="lines">','<div class="{parent.childCls} {parent.elbowCls}-img ','{parent.elbowCls}-<tpl if=".">line<tpl else>empty</tpl>" role="presentation"></div>',"</tpl>",'<div class="{childCls} {elbowCls}-img {elbowCls}','<tpl if="isLast">-end</tpl><tpl if="expandable">-plus {expanderCls}</tpl>" role="presentation"></div>','<tpl if="checked !== null">','<div role="button" {ariaCellCheckboxAttr}',' class="{childCls} {checkboxCls}<tpl if="checked"> {checkboxCls}-checked</tpl>"></div>',"</tpl>",'<tpl if="href">','<a href="{href}" role="link" target="{hrefTarget}" class="{textCls} {childCls}">{value}</a>',"<tpl else>",'<span class="{textCls} {childCls}" style="padding-left:0px">{value}</span>',"</tpl>"]}});
Ext.override(Ext.view.AbstractView,{loadingText:AppConfig.maskHtml||'<i class="fa fa-cog fa-spin" style="font-size:30px"></i>'});
Ext.override(Ext.view.Table,{enableTextSelection:!0,initComponent:function(){var e=this;if(AppConfig.enableGridClickCopy)if(Fm.Config.isIE8)e.on("cellclick",function(t,n){e.ownerCt&&!e.ownerCt.notEnabledCopy&&window.clipboardData&&window.clipboardData.setData("Text",Ext.String.trim(n.innerText||n.textContent||""))});else{var t=parseInt(Ext.versions.extjs.major.toString()+Ext.versions.extjs.minor.toString()+Ext.versions.extjs.pad.toString(),10),n=620>t?{text:function(e){return Ext.String.trim(e.innerText||e.textContent||"")}}:{target:function(e){return e}};e.on("refresh",function(t){e.ownerCt&&!e.ownerCt.notEnabledCopy&&setTimeout(function(){var t=e.getEl();if(t){new Clipboard(t.dom.querySelectorAll(".x-grid-cell-inner"),n)}},300)});var o=function(t,o,i,a){if(e.ownerCt&&!e.ownerCt.notEnabledCopy)for(var r=0;r<i.length;r++){new Clipboard(i[r].querySelectorAll(".x-grid-cell-inner"),n)}};e.on("itemadd",o),e.on("itemupdate",o)}e.callParent(arguments)},setActionableMode:function(e,t){var n,o,i,a,r,l,c,d,s,f=this,b=f.getNavigationModel(),g=f.grid.actionables,u=g.length;if(f.actionableMode===e){if(e&&t.isEqual(f.actionPosition))return!1;s=!1}if(e){if(t&&(t.view===f||t.view===(d=f.lockingPartner)&&d.actionableMode)){if(t=t.clone(),l=t.record,n=f.all.item(t.rowIdx),!d){if(!t.column)return!1;for(o=Ext.fly(n).down(t.column.getCellSelector()),r=0;u>r;r++)c=c||g[r].activateCell(t)}if(d||o.restoreTabbableState(!0).length||c){for(r=0;u>r;r++)g[r].activateRow&&g[r].activateRow(n);if(d||(i=o.findTabbableElements()).length){if(n.restoreTabbableState(!0),d)return f.actionableMode=!0,s;if(i)return f.actionRow=n,f.actionableMode=f.ownerGrid.actionableMode=!0,b.setPosition(),b.actionPosition=f.actionPosition=t,i[0].focus(),s}}}return!1}for(a=Ext.fly(Ext.Element.getActiveElement()),r=0;u>r;r++)g[r].deactivate&&g[r].deactivate();f.actionRow&&f.actionRow.saveTabbableState({skipSelf:!0,includeSaved:!1}),f.el.contains(a)&&b.setPosition(new Ext.grid.CellContext(f).setPosition(f.getRecord(a)||0,f.getHeaderByCell(a.findParent(f.getCellSelector()))||0)),f.actionableMode=f.ownerGrid.actionableMode=!1,f.actionPosition=b.actionPosition=f.actionRow=null}});
Ext.override(Ext.window.MessageBox,{prompt:function(t,i,e,s,o,h){return Ext.isString(t)&&(t={prompt:!0,title:t,minWidth:this.minPromptWidth,message:i,buttons:this.OKCANCEL,callback:e,scope:s,multiline:o,value:h,width:360,height:180}),this.show(t)}});
Ext.define("Fm.ux.button.ImageButton",{extend:"Ext.button.Button",alias:"widget.imagebutton",cls:"",iconAlign:"left",initRenderTpl:Ext.emptyFn,componentLayout:null,autoEl:"img",frame:!1,initComponent:function(){this.scale=null,this.callParent(),this.autoEl={tag:"img",role:"button",hidefocus:"on",unselectable:"on"};var t;this.imageUrl&&(t=(new Image).src=this.imageUrl),this.overImageUrl&&(t=(new Image).src=this.overImageUrl),this.disabledImageUrl&&(t=(new Image).src=this.disabledImageUrl),this.pressedImageUrl&&(t=(new Image).src=this.pressedImageUrl)},getElConfig:function(){return Ext.apply(this.callParent(),{tag:"img",id:this.getId(),src:this.imageUrl,style:this.getStyle()})},getStyle:function(){var t="border:none;cursor:pointer;";return this.style&&(t+=this.style),this.height&&(t+="height:"+this.height+"px;"),this.width&&(t+="width:"+this.width+"px;"),t},onRender:function(t,i){this.imgEl=this.el,Ext.isEmpty(this.imgEl.getAttribute("width"),!1)&&Ext.isEmpty(this.imgEl.getAttribute("height"),!1)||(this.imgEl.dom.removeAttribute("width"),this.imgEl.dom.removeAttribute("height")),this.altText&&this.imgEl.dom.setAttribute("alt",this.altText),this.align&&"notset"!==this.align&&this.imgEl.dom.setAttribute("align",this.align),this.pressed&&this.pressedImageUrl&&(this.imgEl.dom.src=this.pressedImageUrl),this.disabled&&this.setDisabled(!0),void 0!==this.tabIndex&&(this.imgEl.dom.tabIndex=this.tabIndex),this.href&&this.on("click",function(){this.target?window.open(this.href,this.target):window.location=this.href},this),this.callParent(arguments),this.btnEl=this.el},onMenuShow:function(t){this.ignoreNextClick=0,this.pressedImageUrl&&(this.imgEl.dom.src=this.pressedImageUrl),this.fireEvent("menushow",this,this.menu)},onMenuHide:function(t){this.ignoreNextClick=Ext.defer(this.restoreClick,250,this),this.imgEl.dom.src=this.monitoringMouseOver?this.overImageUrl:this.imageUrl,this.fireEvent("menuhide",this,this.menu),this.focus()},getTriggerSize:function(){return 0},toggle:function(t,i,s){return t=void 0===t?!this.pressed:!!t,t!=this.pressed&&(t?(this.pressedImageUrl&&(this.imgEl.dom.src=this.pressedImageUrl),this.pressed=!0):(this.imgEl.dom.src=this.monitoringMouseOver?this.overImageUrl:this.imageUrl,this.pressed=!1),i||this.fireEvent("toggle",this,this.pressed),this.toggleHandler&&!s&&this.toggleHandler.call(this.scope||this,this,t)),this},setText:Ext.emptyFn,setDisabled:function(t){this.disabled=t,this.imgEl&&this.imgEl.dom&&(this.imgEl.dom.disabled=t),t?(this.disabledImageUrl?this.imgEl.dom.src=this.disabledImageUrl:this.imgEl.addCls(this.disabledCls),this.imgEl.setStyle({cursor:"default"})):(this.imgEl.dom.src=this.imageUrl,this.imgEl.setStyle({cursor:"pointer"}),this.imgEl.removeCls(this.disabledCls))},onMouseOver:function(t){if(!this.disabled){var i=t.within(this.el.dom,!0);i||(!this.overImageUrl||this.pressed||this.hasVisibleMenu()||(this.imgEl.dom.src=this.overImageUrl),this.monitoringMouseOver||(Ext.getDoc().on("mouseover",this.monitorMouseOver,this),this.monitoringMouseOver=!0))}this.fireEvent("mouseover",this,t)},monitorMouseOver:function(t){t.target==this.el.dom||t.within(this.el)||(this.monitoringMouseOver&&(Ext.getDoc().un("mouseover",this.monitorMouseOver,this),this.monitoringMouseOver=!1),this.onMouseOut(t))},onMouseEnter:function(t){!this.overImageUrl||this.pressed||this.disabled||this.hasVisibleMenu()||(this.imgEl.dom.src=this.overImageUrl),this.fireEvent("mouseover",this,t)},onMouseOut:function(t){this.disabled||this.pressed||this.hasVisibleMenu()||(this.imgEl.dom.src=this.imageUrl),this.fireEvent("mouseout",this,t)},onMouseDown:function(t){var i=this;Ext.isIE&&i.getFocusEl().focus(),i.disabled||0!==t.button||(i.pressedImageUrl&&(i.imgEl.dom.src=i.pressedImageUrl),Ext.button.Manager.onButtonMousedown(i,t))},onMouseUp:function(t){this.isDestroyed||0!==t.button||this.enableToggle||this.hasVisibleMenu()||(this.imgEl.dom.src=this.overImageUrl&&this.monitoringMouseOver?this.overImageUrl:this.imageUrl)},setImageUrl:function(t){this.imageUrl=t,this.disabled&&!Ext.isEmpty(this.disabledImageUrl,!1)||this.pressed&&!Ext.isEmpty(this.pressedImageUrl,!1)?(new Image).src=t:this.imgEl.dom.src=t},setDisabledImageUrl:function(t){this.disabledImageUrl=t,this.disabled?this.imgEl.dom.src=t:(new Image).src=t},setOverImageUrl:function(t){this.overImageUrl=t,this.disabled&&!Ext.isEmpty(this.disabledImageUrl,!1)||this.pressed&&!Ext.isEmpty(this.pressedImageUrl,!1)?(new Image).src=t:this.imgEl.dom.src=t},setPressedImageUrl:function(t){this.pressedImageUrl=t,this.disabled&&!Ext.isEmpty(this.disabledImageUrl,!1)||!this.pressed?(new Image).src=t:this.imgEl.dom.src=t},setAlign:function(t){this.align=t,this.rendered&&this.imgEl.dom.setAttribute("align",this.align)},setAltText:function(t){this.altText=t,this.rendered&&this.imgEl.dom.setAttribute("altText",this.altText)}});
Ext.define("Fm.ux.button.LinkButton",{extend:"Ext.button.Button",alias:"widget.linkbutton",ui:"button-link",initComponent:function(){this.callParent()}});
Ext.define("Fm.ux.form.ComboGrid",{extend:"Ext.form.field.ComboBox",alias:["widget.comboxgrid","widget.combogrid"],editable:!1,windowTitle:null,showClearTriggers:!0,checkChangeEvents:Ext.isIE&&(!document.documentMode||document.documentMode<=9)?["change","propertychange","keyup"]:["change","keyup","dragdrop"],isHandleAllValue:!0,isValidate:!1,taskType:null,month:null,multiAllValue:[],singleIsArray:!1,isSelectAll:!1,allLength:null,isPopWindow:!1,multiSelect:!1,valueSplitChar:",",valueIsString:!1,onTriggerClick:function(e){var t=this;t.isPopWindow?t.onTriggerClickPopWindow():t.readOnly||t.disabled||(t.isExpanded?t.collapse():t.expand())},onFieldMutation:function(e){var t=this,l=e.getKey(),i=l===e.BACKSPACE||l===e.DELETE,a=l===e.CTRL,o=t.inputEl.dom.value,n=o.length;if(!t.readOnly&&(o!==t.lastMutatedValue||i)&&l!==e.TAB){{t.lastMutatedValue}t.lastMutatedValue=o,t.lastKey=l,n||"keyup"===e.type&&e.isSpecialKey()&&!i?n&&("keyup"!==e.type||!e.isSpecialKey()||i||a)?(t.setValue(o),t.fireEvent("change",t)):(n||l&&!i||(t.multiSelect||(t.value=null,t.displayTplData=void 0),t.clearValueOnEmpty&&t.valueCollection.removeAll(),t.collapse(),t.queryFilter&&(t.changingFilters=!0,t.store.removeFilter(t.queryFilter,!0),t.changingFilters=!1)),t.callParent([e])):(t.clearValue(),t.fireEvent("change",t))}},onTriggerClickPopWindow:function(){var e,t,l=this,i=["->"];t=l.multiSelect?{selType:"checkboxmodel",mode:"SIMPLE",allowDeselect:!0}:{mode:"SINGLE",allowDeselect:!0},i.push({text:"选择",width:70,handler:function(e){var t=e.up("window[popWindow=is]"),i=t.down("cisgrid")||t.down("grid"),a=i.getSelection();l.isValidate&&l.setValue(null),l.updateValue(a),l.callbackChecked&&l.callbackChecked(a),t.close()}},{text:"取消",width:70,handler:function(e){var t=e.up("window[popWindow=is]");t.close()}}),e=Ext.create("Ext.window.Window",{title:l.windowTitle||l.fieldLabel,height:l.winHeight,width:l.winWidth,modal:!0,layout:"fit",popWindow:"is",taskType:l.taskType,month:l.month,listeners:{close:function(){l.focus()}},items:[Ext.apply(l.innerGrid,{selModel:t,listeners:{itemdblclick:function(e,t,i,a,o,n){if(!l.multiSelect){var s=[],d=e.up("window[popWindow=is]");s.push(t),l.isValidate&&l.setValue(null),l.updateValue(s),l.callbackChecked&&l.callbackChecked(t),d.close()}},afterrender:function(e,t){e.down("[focusEnable=true]")&&e.down("[focusEnable=true]").focus()}}})],buttons:i}),e.show()},getAllLength:function(){var e,t=this;if(!t.allLength){if(e=t.getStore(),!e||e.isEmptyStore){var l=t.getBind();l&&l.store&&(e=l.store.getValue())}return e.getTotalCount()}return t.allLength},createPicker:function(){var e,t=this;return e=t.picker=t.getGridPicker(),(!t.store||t.store.isEmptyStore)&&(t.store=e.getStore()),(!t.store||t.store.isEmptyStore)&&(t.store=e.getController().getGridStore()),t.pageSize&&e.pagingToolbar.on("beforechange",t.onPageChange,t),e.initialConfig.maxHeight||e.on({beforeshow:t.onBeforePickerShow,scope:t}),e.getSelectionModel().on({beforeselect:t.onBeforeSelect,beforedeselect:t.onBeforeDeselect,scope:t}),e.getNavigationModel().navigateOnSpace=!1,e},getGridPicker:function(){var e=this,t={pickerField:e,hidden:!0,displayField:e.displayField,preserveScrollOnRefresh:!0,pageSize:e.pageSize,selModel:e.pickerSelectionModel,floating:!0,minWidth:e.minPickerWidth,minHeight:e.minPickerHeight,maxHeight:e.maxPickerHeight,autoScroll:!0,listeners:{itemclick:{fn:e.onItemClick}},refresh:function(){}};(e.store||e.store.isEmptyStore)&&(t.store=e.getPickerStore());var l=Ext.apply(e.innerGrid,t);e.originalCollapse=e.collapse,l.listeners.show=e.multiSelect?{fn:function(){e.picker.el.on({mouseover:function(){this.collapse=Ext.emptyFn},mouseout:function(){this.collapse=this.originalCollapse},scope:e})}}:{fn:function(){e.picker.el.on({mousedown:function(){this.collapse=Ext.emptyFn},mouseup:function(){this.collapse=this.originalCollapse},scope:e})}};var i;return i=Ext.ComponentManager.create(Ext.isFunction(l)?l.call():l,"panel")},updateValue:function(e){var t,l,i=this,a=e||i.valueCollection.getRange(),o=a.length,n=[],s=i.displayTplData||(i.displayTplData=[]),d=i.inputEl;for(s.length=0,t=0;o>t;t++)l=a[t],s.push(i.getRecordDisplayData(l)),l!==i.valueNotFoundRecord&&n.push(l.get(i.valueField));i.setHiddenValue(n),i.value=i.multiSelect?n:n[0],Ext.isDefined(i.value)||(i.value=void 0),i.displayTplData=s,d&&i.emptyText&&!Ext.isEmpty(i.value)&&d.removeCls(i.emptyCls),i.setRawValue(i.getDisplayValue()),i.checkChange(),i.applyEmptyText()},updateValue22:function(e){var t,l,i=this,a=i.valueCollection.getRange(),o=a.length,n=[],s=i.displayTplData||(i.displayTplData=[]),d=i.inputEl;for(0==a.length&&e&&(a=e,o=a.length),s.length=0,t=0;o>t;t++)l=a[t],s.push(i.getRecordDisplayData(l)),l!==i.valueNotFoundRecord&&n.push(l.get(i.valueField));i.setHiddenValue(n),i.value=i.multiSelect?n:n[0],Ext.isDefined(i.value)||(i.value=void 0),i.displayTplData=s,d&&i.emptyText&&!Ext.isEmpty(i.value)&&d.removeCls(i.emptyCls),i.setRawValue(i.getDisplayValue()),i.checkChange(),i.applyEmptyText()},doSetValue:function(e,t){this.isPopWindow||this.getPicker();var l,i,a,o,n,s,d,r=this,u=r.getStore(),c=[],p=[],g=r.autoLoadOnValue,h=u.getCount()>0||u.isLoaded(),y=u.hasPendingLoad(),v=g&&!h&&!y,f=r.forceSelection,m=r.pickerSelectionModel,S=(r.displayField===r.valueField,u.isEmptyStore),E=r.lastSelection;if(t&&!r.multiSelect&&Ext.raise("Cannot add values to non multiSelect ComboBox"),y||v||!h||S){if(!e.isModel){if(r.multiSelect&&!r.valueIsString){var C=e;e&&!Ext.isArray(e)&&(C=e.toString().split(r.valueSplitChar)),e=C}if(r.value=t?Ext.Array.from(r.value).concat(e):e,""===e&&(this.displayTplData=[""]),this.displayTplData&&(0===this.displayTplData.length||"string"==typeof this.displayTplData[0])&&"object"!=typeof this.displayTplData[0]){var x=[];x.push(e),this.displayTplData=x}if(r.setHiddenValue(r.value),r.setRawValue(this.displayTplData&&0!==this.displayTplData.length&&"object"!=typeof e?r.getDisplayValue():r.value),r.value&&(this.displayTplData=[],r.inputEl.removeCls(r.emptyCls+"-"+r.ui)),!e.isModel||S)return r}if(v&&!S&&u.load(),!e.isModel||S)return r}for(e=t?Ext.Array.from(r.value).concat(e):Ext.Array.from(e),i=0,a=e.length;a>i;i++)o=e[i],o&&o.isModel||(o=r.store.findRecord(r.valueField,o),o||(o=r.valueCollection.find(r.valueField,d))),o||(f?r.valueNotFoundRecord&&(o=r.valueNotFoundRecord):!o&&e[i]&&(n={},n[r.displayField]=e[i],r.valueField&&r.displayField!==r.valueField&&(n[r.valueField]=e[i]),l=u.getModel(),o=new l(n))),o&&(c.push(o),p.push(o.get(r.valueField)));if(E)if(a=E.length,a===c.length)for(i=0;!s&&a>i;i++)-1===Ext.Array.indexOf(r.lastSelection,c[i])&&(s=!0);else s=!0;else s=c.length;return s?(r.suspendEvent("select"),r.valueCollection.beginUpdate(),c.length?m.select(c,!1):m.deselectAll(),r.valueCollection.endUpdate(),r.resumeEvent("select")):r.updateValue(),r},onValueCollectionEndUpdate:function(){var e=this,t=e.store,l=e.valueCollection.getRange(),i=l[0],a=l.length;e.updateBindSelection(e.pickerSelectionModel,l),e.isSelectionUpdating()||(Ext.suspendLayouts(),e.lastSelection=l,a&&(e.lastSelectedRecords=l),e.updateValue(),a&&(!e.multiSelect&&t.contains(i)||e.collapseOnSelect||!t.getCount())&&(e.updatingValue=!0,e.collapse(),e.updatingValue=!1),Ext.resumeLayouts(!0),a&&!e.suspendCheckChange&&(e.multiSelect||(l=i),e.fireEvent("select",e,l)))},onBindStore:function(e,t){var l,i,a=this,o=a.picker;e&&(e.autoCreated&&(a.queryMode="local",a.valueField=a.displayField="field1",e.expanded||(a.displayField="field2")),Ext.isDefined(a.valueField)||(a.valueField=a.displayField),l={byValue:{rootProperty:"data",unique:!1}},l.byValue.property=a.valueField,e.setExtraKeys(l),a.displayField===a.valueField?e.byText=e.byValue:(l.byText={rootProperty:"data",unique:!1},l.byText.property=a.displayField,e.setExtraKeys(l)),i={rootProperty:"data",extraKeys:{byInternalId:{property:"internalId"},byValue:{property:"",rootProperty:"data"}},listeners:{beginupdate:a.onValueCollectionBeginUpdate,endupdate:a.onValueCollectionEndUpdate,scope:a}},i.extraKeys.byValue.property=a.valueField,a.valueCollection=new Ext.util.Collection(i),a.pickerSelectionModel=a.multiSelect?new Ext.selection.CheckboxModel({mode:"SIMPLE",enableInitialSelection:!1,pruneRemoved:!1,selected:a.valueCollection,store:e}):new Ext.selection.DataViewModel({mode:"SINGLE",enableInitialSelection:!1,pruneRemoved:!1,selected:a.valueCollection,store:e}),t||a.resetToDefault(),o&&(o.setSelectionModel(a.pickerSelectionModel),o.getStore()!==e&&o.bindStore(e)))}});
Ext.define("Fm.ux.form.ComboTreeGrid",{extend:"Fm.ux.form.ComboGrid",alias:["widget.comboxtreegrid","widget.combotreegrid"],requires:["Ext.tree.Panel"],editable:!1,multiSelect:!0,valueIsContainRoot:!1,selectModel:[],isAutoExpandFirst:!0,isHandleAllValue:!0,multiAllValue:[],initComponent:function(){var e=this;e.multiAllTempValue=e.multiAllValue,e.callParent(arguments)},listeners:{afterrender:function(){var e=this;if(e.fakeStore){var t=e.getForData(e.fakeStore);e.store=t&&1===t.length?Ext.create("Ext.data.TreeStore",{fields:["value","text"],root:{text:t[0].text||"全部",value:-1,expanded:!0,checked:t[0].checked,children:t[0].children}}):Ext.create("Ext.data.TreeStore",{fields:["value","text"],root:{text:"全部",value:-1,expanded:!0,checked:!1,children:t}})}}},getForData:function(e){var t=function(e,l){for(var o=[],i=0,n=0;n<e.length;n++)if(e[n].IsAlloted===!0){if(!(Ext.isArray(e[n].Children)&&e[n].Children.length>0)){var r=[];return Ext.each(e,function(e){if(e&&e.IsAlloted===!0){var t={value:e.Id,text:e.Name,Id:e.Id,leaf:!0,checked:!1};r.push(t)}}),r}o[i]={value:e[n].Id,text:e[n].Name,leaf:e[n].Children.length>0?!1:!0,checked:!1,children:t(e[n].Children,e[n].Name)},i+=1}return o};return t(e)},createPicker:function(){var e,t=this;return e=t.picker=t.getGridPicker(),t.pageSize&&e.pagingToolbar.on("beforechange",t.onPageChange,t),e.initialConfig.maxHeight||e.on({beforeshow:t.onBeforePickerShow,scope:t}),e.getNavigationModel().navigateOnSpace=!1,e},getAllLength:function(){var e,t=this;return t.allLength?t.allLength:(e=t.getStore(),e&&"ext-empty-store"!==e.storeId||(e=t.getBind().store.getValue()),t.getTreeStoreLen(e))},getTreeStoreLen:function(e){var t=this,l=0,o=e.getRootNode(),i=function(e){if(e.get("leaf")!==!0){t.valueIsContainRoot&&l++;for(var o=0;o<e.childNodes.length;o++)i(e.childNodes[o])}else l++};return i(o),l},getGridPicker:function(){var e=this,t=Ext.apply(e.innerGrid,{pickerField:e,hidden:!0,store:e.store,displayField:e.displayField,pageSize:e.pageSize,selModel:e.pickerSelectionModel,floating:!0,minWidth:e.minPickerWidth,minHeight:e.minPickerHeight,maxHeight:e.maxPickerHeight,autoScroll:!0,allowDeselect:!1,listeners:{checkchange:{fn:e.onSelectItem,scope:e},render:function(){if(e.isAutoExpandFirst){var t;if(this.store.rootVisible)t=this.store.root;else{var l=this.store.data.item;l&&1===l.length&&(t=this.store.data.item[0])}t&&t.isExpanded()===!1&&t.expand()}}},hideHeaders:!0,useArrows:!0,columns:[{xtype:"treecolumn",flex:1,notAutoWidth:!0,dataIndex:e.displayField,renderer:function(e,t){return t&&(t.tdAttr='data-qtip="'+e+'"'),e}}],refresh:function(){}});e.originalCollapse=e.collapse,t.listeners.show={fn:function(){e.picker.el.on({mouseover:function(){this.collapse=Ext.emptyFn},mouseout:function(){this.collapse=this.originalCollapse},scope:e})}};var l=Ext.ComponentManager.create(Ext.isFunction(t)?t.call():t,"panel");return l},checkedNode:function(e,t){e.set("checked",t),this.selectNode(e,t)},selectNodeRecord:function(e,t){t?(e.get("checked")===!0||e.get("checked")===!1)&&e.set("checked",!0):(e.get("checked")===!0||e.get("checked")===!1)&&e.set("checked",!1)},selectNode:function(e,t){var l=this,o=l.pickerSelectionModel;(l.valueIsContainRoot||e.isLeaf())&&(l.selectNodeRecord(e,t),t?o.select(e,!0,!0):o.deselect(e,!0))},checkedChild:function(e,t){for(var l=t||e.get("checked"),o=0;o<e.childNodes.length;o++){var i=e.childNodes[o].get("checked");i!=l&&this.checkedNode(e.childNodes[o],l),e.childNodes[o].childNodes.length>0&&this.checkedChild(e.childNodes[o])}},checkedParent:function(e){if(e.parentNode){var t=!1;e.parentNode.eachChild(function(e){return e.get("checked")?(t=!0,!1):void 0}),this.checkedNode(e.parentNode,t),e.parentNode.parentNode&&this.checkedParent(e.parentNode)}},onSelectItem:function(e,t,l){{var o=this;o.picker,o.pickerSelectionModel}Ext.Array.contains(o.selectModel,"p-c")&&o.checkedChild(e),Ext.Array.contains(o.selectModel,"c-p")&&o.checkedParent(e),this.selectNode(e,t)},clearTreeChecked:function(){var e,t=this,l=t.picker;l&&(e=l.getChecked(),e&&(Ext.each(e,function(e){e.set("checked",!1)}),t.pickerSelectionModel.deselectAll()))},getTreeStoreAllData:function(){var e=this,t=[],l=e.getStore(),o=l.getRootNode(),i=function(l){if(l.isLeaf())t.push(l);else{e.valueIsContainRoot&&t.push(l);for(var o=0;o<l.childNodes.length;o++)i(l.childNodes[o])}};return i(o),t},onBindStore:function(e,t){var l,o,i=this,n=i.picker;e&&(e.autoCreated&&(i.queryMode="local",i.valueField=i.displayField="field1",e.expanded||(i.displayField="field2")),Ext.isDefined(i.valueField)||(i.valueField=i.displayField),l={byValue:{rootProperty:"data",unique:!1}},l.byValue.property=i.valueField,e.setExtraKeys(l),i.displayField===i.valueField?e.byText=e.byValue:(l.byText={rootProperty:"data",unique:!1},l.byText.property=i.displayField,e.setExtraKeys(l)),o={rootProperty:"data",extraKeys:{byInternalId:{property:"internalId"},byValue:{property:"",rootProperty:"data"}},listeners:{beginupdate:i.onValueCollectionBeginUpdate,endupdate:i.onValueCollectionEndUpdate,scope:i}},o.extraKeys.byValue.property=i.valueField,i.valueCollection=new Ext.util.Collection(o),i.pickerSelectionModel=i.multiSelect?new Ext.selection.CheckboxModel({mode:"SIMPLE",enableInitialSelection:!1,pruneRemoved:!1,checkOnly:!0,addCheckbox:function(e,t){},selected:i.valueCollection,store:e}):new Ext.selection.DataViewModel({mode:"SINGLE",enableInitialSelection:!1,pruneRemoved:!1,selected:i.valueCollection,store:e}),t||i.resetToDefault(),n&&n.getStore()!==e&&n.bindStore(e))},doAutoSelect:function(){},getRecordByValue:function(e,t){var l=this,o=null;if(!e||!e.length)return o;for(var i=0;i<e.length;i++){if(e[i].get(l.valueField)==t)return e[i];if(e[i].childNodes&&(o=l.getRecordByValue(e[i].childNodes,t),null!=o))return o}return o},findRecordByValue:function(e){var t=this.getRecordByValue(this.store.data.items,e),l=!1;return t&&(l=t[0]||t),l},doSetValue:function(e,t){var l,o,i,n,r,a,d=this,c=d.getStore(),s=c.getModel(),u=[],h=[],f=d.autoLoadOnValue,p=c.getCount()>0||c.isLoaded(),g=c.hasPendingLoad(),v=f&&!p&&!g,x=d.forceSelection,k=(d.pickerSelectionModel,d.displayField===d.valueField),m=c.isEmptyStore,y=d.lastSelection;if(t&&!d.multiSelect&&Ext.raise("Cannot add values to non multiSelect ComboBox"),(g||v||!p||m)&&(e.isModel||(d.value=t?Ext.Array.from(d.value).concat(e):e,d.setHiddenValue(d.value),d.setRawValue(k?e:"")),v&&!m&&c.load(),!e.isModel||m))return d;for(e=t?Ext.Array.from(d.value).concat(e):Ext.Array.from(e),l=0,o=e.length;o>l;l++)i=e[l],i&&i.isModel||(i=d.findRecordByValue(a=i),i||(i=d.valueCollection.find(d.valueField,a))),i||(x?d.valueNotFoundRecord&&(i=d.valueNotFoundRecord):!i&&e[l]&&(n={},n[d.displayField]=e[l],d.valueField&&d.displayField!==d.valueField&&(n[d.valueField]=e[l]),i=new s(n))),i&&(u.push(i),h.push(i.get(d.valueField)));if(y)if(o=y.length,o===u.length)for(l=0;!r&&o>l;l++)-1===Ext.Array.indexOf(d.lastSelection,u[l])&&(r=!0);else r=!0;else r=u.length;if(r){if(!d.picker){d.getPicker()}if(d.suspendEvent("select"),d.valueCollection.beginUpdate(),u.length)for(var l=0;l<u.length;l++)d.onSelectItem(u[l],!0);else d.onSelectItem(c.getRoot(),!1);d.valueCollection.endUpdate(),d.resumeEvent("select")}else d.updateValue();return d}});
Ext.define("Fm.ux.form.TimePicker",{extend:"Ext.picker.Date",requires:["Ext.form.field.Number"],hideOnSelect:!1,todayText:"现在",okText:"确定",okTip:"确定选择时间",getRefItems:function(){var e=this,t=e.callParent();return e.TimeContainer&&t.push(TimeContainer),t},beforeDestroy:function(){var e=this;e.rendered&&Ext.destroy(e.okBtn),e.callParent()},_toTime:function(){var e=this;e.TimeContainer&&e.TimeContainer.down("combo[itemId=hours]").focus()},initEvents:function(){var e=this,t=(e.pickerField,Ext.Date),a=t.DAY;e.keyNavConfig=Ext.apply(e.keyNavConfig,{down:function(i){e.update(t.add(e.activeDate,a,7))},pageDown:function(t){e.showNextMonth()},space:function(e){var t=this;return t.TimeContainer?(t.TimeContainer.down("combo[itemId=hours]").focus(),!1):void 0},tab:function(){return!1}}),e.callParent()},beforeRender:function(){var e=this,t=(Ext.Date.format(new Date,e.format),function(e){return Ext.create("Ext.data.Store",{fields:["Text","Value"],data:function(){for(var t=[],a=0;e>a;a++){var i=a.toString();1===i.length&&(i="0"+i),t.push({Text:i,Value:a})}return t}()})});e.TimeContainer=Ext.create("Ext.container.Container",{scope:e,ownerCt:e,ownerLayout:e.getComponentLayout(),layout:"column",ariaRole:"presentation",padding:"0 0 0 15",defaults:{xtype:"combo",editable:!1,enableKeyEvents:!0,displayField:"Text",valueField:"Value",showClearTriggers:!1,width:40},items:[{value:null==e.pickerField.lastValue?(new Date).getHours():Ext.Date.format(e.pickerField.lastValue,"H"),listeners:{keydown:function(e,t,a){t.getKey()==Ext.event.Event.SPACE&&e.next().next().focus()}},store:t(24),itemId:"hours",name:"time"},{xtype:"label",text:":",width:6},{value:null==e.pickerField.lastValue?(new Date).getMinutes():Ext.Date.format(e.pickerField.lastValue,"i"),store:t(60),listeners:{keydown:function(e,t,a){t.getKey()==Ext.event.Event.SPACE&&e.next().next().focus()}},itemId:"minutes",name:"time"},{xtype:"label",text:":",width:6},{value:null==e.pickerField.lastValue?(new Date).getSeconds():Ext.Date.format(e.pickerField.lastValue,"s"),store:t(60),listeners:{keydown:function(e,t,a){t.getKey()==Ext.event.Event.SPACE&&e.next().focus()}},itemId:"seconds",name:"time"},{ui:"default-toolbar",xtype:"button",text:"确认",width:45,handler:e.selectTime,scope:e,name:"time"}],listeners:{render:function(){e.TimeContainer}}}),e.callParent()},setValue:function(e){return Ext.isDate(e)||(e=Ext.Date.parse(e||new Date,this.format)),this.value=e,this.update(this.value)},getTimeSp:function(){var e=this;if(e.TimeContainer){var t=60*parseInt(e.TimeContainer.down("combo[itemId=hours]").getValue(),10)*60,a=60*parseInt(e.TimeContainer.down("combo[itemId=minutes]").getValue(),10),i=parseInt(e.TimeContainer.down("combo[itemId=seconds]").getValue(),10);return t+a+i}return 0},handleDateClick:function(e,t){var a=this,i=a.handler;if(e.stopEvent(),!a.disabled&&t.dateValue&&!Ext.fly(t.parentNode).hasCls(a.disabledCellCls)){var r=Ext.Date.add(new Date(t.dateValue),Ext.Date.SECOND,a.getTimeSp());a.setValue(r),i&&i.call(a.scope||a,a,a.value),a.onSelect()}},selectToday:function(){var e=this,t=e.todayBtn,a=e.handler;return t&&!t.disabled&&(e.setValue(new Date),e.fireEvent("select",e,e.value),a&&a.call(e.scope||e,e,e.value),e.onSelect()),e},fullUpdate:function(e){var t,a,i,r,n,l,s,d=this,o=d.cells.elements,u=d.textNodes,c=d.disabledCellCls,m=Ext.Date,x=0,f=0,v=+m.clearTime(e,!0),p=+m.clearTime(new Date),b=d.minDate?m.clearTime(d.minDate,!0):Number.NEGATIVE_INFINITY,D=d.maxDate?m.clearTime(d.maxDate,!0):Number.POSITIVE_INFINITY,T=d.disabledDatesRE,h=d.disabledDatesText,E=d.disabledDays?d.disabledDays.join(""):!1,C=d.disabledDaysText,y=d.format,g=m.getDaysInMonth(e),w=m.getFirstDateOfMonth(e),k=w.getDay()-d.startDay,V=m.add(e,m.MONTH,-1),S=d.ariaTitleDateFormat;for(0>k&&(k+=7),g+=k,t=m.getDaysInMonth(V)-k,a=new Date(V.getFullYear(),V.getMonth(),t,d.initHour),i=function(e,t){var i=o[e],r=[];i.hasAttribute("id")||i.setAttribute("id",d.id+"-cell-"+e),s=+m.clearTime(a,!0),i.firstChild.dateValue=s,i.setAttribute("aria-label",m.format(a,S)),i.removeAttribute("aria-describedby"),i.removeAttribute("data-qtip"),s===p&&(t+=" "+d.todayCls,r.push(d.id+"-todayText")),s===v?(d.activeCell=i,d.eventEl.dom.setAttribute("aria-activedescendant",i.id),i.setAttribute("aria-selected",!0),t+=" "+d.selectedCls,d.fireEvent("highlightitem",d,i)):i.setAttribute("aria-selected",!1),b>s?(t+=" "+c,r.push(d.id+"-ariaMinText"),i.setAttribute("data-qtip",d.minText)):s>D?(t+=" "+c,r.push(d.id+"-ariaMaxText"),i.setAttribute("data-qtip",d.maxText)):E&&-1!==E.indexOf(a.getDay())?(i.setAttribute("data-qtip",C),r.push(d.id+"-ariaDisabledDaysText"),t+=" "+c):T&&y&&(l=m.dateFormat(a,y),T.test(l)&&(i.setAttribute("data-qtip",h.replace("%0",l)),r.push(d.id+"-ariaDisabledDatesText"),t+=" "+c)),r.length&&i.setAttribute("aria-describedby",r.join(" ")),i.className=t+" "+d.cellCls},d.eventEl.dom.setAttribute("aria-busy","true");x<d.numDays;++x)k>x?(r=++t,n=d.prevCls):x>=g?(r=++f,n=d.nextCls):(r=x-k+1,n=d.activeCls),u[x].innerHTML=r,a.setDate(a.getDate()+1),i(x,n);d.eventEl.dom.removeAttribute("aria-busy"),d.monthBtn.setText(Ext.Date.format(e,d.monthYearFormat))},update:function(e,t){var a=this,i=a.activeDate;return a.rendered&&(a.activeDate=e,!t&&i&&a.el&&i.getMonth()===e.getMonth()&&i.getFullYear()===e.getFullYear()?a.selectedUpdate(e,i):a.fullUpdate(e,i)),a},selectedUpdate:function(e){var t,a,i=this,r=e.getTime(),n=i.cells,l=i.selectedCls,s=n.getCount();for(i.eventEl.dom.setAttribute("aria-busy","true"),a=i.activeCell,a&&(Ext.fly(a).removeCls(l),a.setAttribute("aria-selected",!1)),t=0;s>t;t++)if(a=n.item(t),i.textNodes[t].dateValue===Ext.Date.clearTime(new Date(r)).getTime()){i.activeCell=a.dom,i.eventEl.dom.setAttribute("aria-activedescendant",a.dom.id),a.dom.setAttribute("aria-selected",!0),a.addCls(l),i.fireEvent("highlightitem",i,a);break}i.eventEl.dom.removeAttribute("aria-busy"),i.TimeContainer&&(i.TimeContainer.down("combo[itemId=hours]").setValue(e.getHours()),i.TimeContainer.down("combo[itemId=minutes]").setValue(e.getMinutes()),i.TimeContainer.down("combo[itemId=seconds]").setValue(e.getSeconds()))},selectTime:function(e,t){if(t.getKey()==Ext.event.Event.SPACE)return void e.up().up().focus();var a=this,i=a.okText,r=a.handler,n=a.activeDate;if(i&&!i.disabled){var l=Ext.Date.add(Ext.Date.clearTime(new Date(n)),Ext.Date.SECOND,a.getTimeSp());a.setValue(l),a.fireEvent("select",a,a.value),r&&r.call(a.scope||a,a,a.value),a.onSelect()}return a},renderTpl:['<div id="{id}-innerEl" data-ref="innerEl" role="presentation">','<div class="{baseCls}-header">','<div id="{id}-prevEl" data-ref="prevEl" class="{baseCls}-prev {baseCls}-arrow" role="presentation" title="{prevText}"></div>','<div id="{id}-middleBtnEl" data-ref="middleBtnEl" class="{baseCls}-month" role="heading">{%this.renderMonthBtn(values, out)%}</div>','<div id="{id}-nextEl" data-ref="nextEl" class="{baseCls}-next {baseCls}-arrow" role="presentation" title="{nextText}"></div>',"</div>",'<table role="grid" id="{id}-eventEl" data-ref="eventEl" class="{baseCls}-inner" cellspacing="0" tabindex="0">',"<thead>",'<tr role="row">','<tpl for="dayNames">','<th role="columnheader" class="{parent.baseCls}-column-header" aria-label="{.}">','<div role="presentation" class="{parent.baseCls}-column-header-inner">{.:this.firstInitial}</div>',"</th>","</tpl>","</tr>","</thead>","<tbody>",'<tr role="row">','<tpl for="days">',"{#:this.isEndOfWeek}",'<td role="gridcell">','<div hidefocus="on" class="{parent.baseCls}-date"></div>',"</td>","</tpl>","</tr>","</tbody>","</table>",'<div id="{id}-footerEl22" data-ref="footerEl" class="{baseCls}-footer">{%this.renderTimeField(values, out)%}</div>','<tpl if="showToday">','<div id="{id}-footerEl" data-ref="footerEl" role="presentation" class="{baseCls}-footer">{%this.renderTodayBtn(values, out)%}</div>',"</tpl>",'<div id="{id}-todayText" class="'+Ext.baseCSSPrefix+'hidden-clip">{todayText}.</div>','<div id="{id}-ariaMinText" class="'+Ext.baseCSSPrefix+'hidden-clip">{ariaMinText}.</div>','<div id="{id}-ariaMaxText" class="'+Ext.baseCSSPrefix+'hidden-clip">{ariaMaxText}.</div>','<div id="{id}-ariaDisabledDaysText" class="'+Ext.baseCSSPrefix+'hidden-clip">{ariaDisabledDaysText}.</div>','<div id="{id}-ariaDisabledDatesText" class="'+Ext.baseCSSPrefix+'hidden-clip">{ariaDisabledDatesText}.</div>',"</div>",{firstInitial:function(e){return Ext.picker.Date.prototype.getDayInitial(e)},isEndOfWeek:function(e){e--;var t=e%7===0&&0!==e;return t?'</tr><tr role="row">':""},renderTodayBtn:function(e,t){Ext.DomHelper.generateMarkup(e.$comp.todayBtn.getRenderTree(),t)},renderMonthBtn:function(e,t){Ext.DomHelper.generateMarkup(e.$comp.monthBtn.getRenderTree(),t)},renderTimeField:function(e,t){Ext.DomHelper.generateMarkup(e.$comp.TimeContainer.getRenderTree(),t)}}],privates:{finishRenderChildren:function(){var e=this;e.callParent(),e.TimeContainer.finishRender()}}}),Ext.define("Fm.ux.form.DateTimeField",{extend:"Ext.form.field.Date",alias:"widget.datetimefield",requires:["Ext.form.field.Date"],format:"Y-m-d H:i:s",createPicker:function(){var e,t=this,a=Ext.String.format;return e={pickerField:t,floating:!0,preventRefocus:!1,hidden:!0,minDate:t.minValue,maxDate:t.maxValue,disabledDatesRE:t.disabledDatesRE,disabledDatesText:t.disabledDatesText,ariaDisabledDatesText:t.ariaDisabledDatesText,disabledDays:t.disabledDays,disabledDaysText:t.disabledDaysText,ariaDisabledDaysText:t.ariaDisabledDaysText,format:t.format,showToday:!1,startDay:t.startDay,minText:a(t.minText,t.formatDate(t.minValue)),ariaMinText:a(t.ariaMinText,t.formatDate(t.minValue,t.ariaFormat)),maxText:a(t.maxText,t.formatDate(t.maxValue)),ariaMaxText:a(t.ariaMaxText,t.formatDate(t.maxValue,t.ariaFormat)),listeners:{scope:t,select:t.onSelect},keyNavConfig:{esc:function(){t.inputEl.focus(),t.collapse()}}},t.originalCollapse=t.collapse,e.listeners.show={fn:function(){this.picker.el.on({mousedown:function(){this.collapse=Ext.emptyFn},mouseup:function(){this.collapse=this.originalCollapse},scope:this})}},t.picker=new Fm.ux.form.TimePicker(e),t.picker}});
Ext.define("Fm.ux.Year",{extend:"Ext.Component",requires:["Ext.XTemplate","Ext.util.ClickRepeater","Ext.Date","Ext.button.Button"],alias:"widget.Year",alternateClassName:"Ext.MonthPicker",isMonthPicker:!0,focusable:!0,childEls:["bodyEl","prevEl","nextEl","monthEl","yearEl"],renderTpl:['<div id="{id}-bodyEl" data-ref="bodyEl" class="{baseCls}-body">','<div id="{id}-monthEl" data-ref="monthEl" class="{baseCls}-months" style="display:none">','<tpl for="months">','<div class="{parent.baseCls}-item {parent.baseCls}-month">','<a style="{parent.monthStyle}" role="button" hidefocus="on" class="{parent.baseCls}-item-inner">{.}</a>',"</div>","</tpl>","</div>",'<div id="{id}-yearEl" data-ref="yearEl" class="{baseCls}-years" style=" width:100% ">','<div class="{baseCls}-yearnav">','<div class="{baseCls}-yearnav-button-ct">','<a id="{id}-prevEl" data-ref="prevEl" class="{baseCls}-yearnav-button {baseCls}-yearnav-prev" hidefocus="on" role="button"></a>',"</div>",'<div class="{baseCls}-yearnav-button-ct">','<a id="{id}-nextEl" data-ref="nextEl" class="{baseCls}-yearnav-button {baseCls}-yearnav-next" hidefocus="on" role="button"></a>',"</div>","</div>",'<tpl for="years">','<div class="{parent.baseCls}-item {parent.baseCls}-year">','<a hidefocus="on" class="{parent.baseCls}-item-inner" role="button">{.}</a>',"</div>","</tpl>","</div>",'<div class="'+Ext.baseCSSPrefix+'clear"></div>','<tpl if="showButtons">','<div class="{baseCls}-buttons">{%',"var me=values.$comp, okBtn=me.okBtn, cancelBtn=me.cancelBtn;","okBtn.ownerLayout = cancelBtn.ownerLayout = me.componentLayout;","okBtn.ownerCt = cancelBtn.ownerCt = me;","Ext.DomHelper.generateMarkup(okBtn.getRenderTree(), out);","Ext.DomHelper.generateMarkup(cancelBtn.getRenderTree(), out);","%}</div>","</tpl>","</div>"],okText:"确定",cancelText:"取消",baseCls:Ext.baseCSSPrefix+"monthpicker",showButtons:!0,footerButtonUI:"default",measureWidth:35,measureMaxHeight:20,smallCls:Ext.baseCSSPrefix+"monthpicker-small",totalYears:10,yearOffset:12,monthOffset:6,initComponent:function(){var e=this;e.selectedCls=e.baseCls+"-selected",e.small&&e.addCls(e.smallCls),e.setValue(e.value),e.activeYear=e.getYear((new Date).getFullYear()-4,-4),e.showButtons&&(e.okBtn=new Ext.button.Button({ui:e.footerButtonUI,text:e.okText,handler:e.onOkClick,scope:e}),e.cancelBtn=new Ext.button.Button({ui:e.footerButtonUI,text:e.cancelText,handler:e.onCancelClick,scope:e})),this.callParent()},beforeRender:function(){var e=this,t=0,n=[],a=Ext.Date.getShortMonthName,l=e.monthOffset,s=e.monthMargin,o="";for(e.padding&&!e.width&&e.cacheWidth(),e.callParent();l>t;++t)n.push(a(t),a(t+l));Ext.isDefined(s)&&(o="margin: 0 "+s+"px;"),Ext.apply(e.renderData,{months:n,years:e.getYears(),showButtons:e.showButtons,monthStyle:o})},cacheWidth:function(){var e=this,t=e.parseBox(e.padding),n=Ext.getBody().createChild({cls:e.baseCls+" "+e.borderBoxCls,style:"position:absolute;top:-1000px;left:-1000px;",html:"&nbsp;"});e.self.prototype.width=n.getWidth()+t.left+t.right,n.destroy()},afterRender:function(){var e=this,t=e.bodyEl;e.callParent(),e.mon(t,"click",e.onBodyClick,e),e.mon(t,"dblclick",e.onBodyClick,e),e.years=t.select("."+e.baseCls+"-year a"),e.months=t.select("."+e.baseCls+"-month a"),e.backRepeater=new Ext.util.ClickRepeater(e.prevEl,{handler:Ext.Function.bind(e.adjustYear,e,[-e.totalYears])}),e.prevEl.addClsOnOver(e.baseCls+"-yearnav-prev-over"),e.nextRepeater=new Ext.util.ClickRepeater(e.nextEl,{handler:Ext.Function.bind(e.adjustYear,e,[e.totalYears])}),e.nextEl.addClsOnOver(e.baseCls+"-yearnav-next-over"),e.updateBody(),Ext.isDefined(e.monthMargin)||(Ext.picker.Month.prototype.monthMargin=e.calculateMonthMargin())},calculateMonthMargin:function(){for(var e=this,t=e.months,n=t.first(),a=n.getMargin("l");a&&e.getLargest()>e.measureMaxHeight;)--a,t.setStyle("margin","0 "+a+"px");return a},getLargest:function(e){var t=0;return this.months.each(function(e){var n=e.getHeight();n>t&&(t=n)}),t},setValue:function(e){var t,n=this,a=n.activeYear;return n.value=e?Ext.isDate(e)?[e.getMonth(),e.getFullYear()]:[e[0],e[1]]:[null,null],n.rendered&&(t=n.value[1],null!==t&&(a>t||t>a+n.yearOffset)&&(n.activeYear=t-n.yearOffset+1),n.updateBody()),n},getValue:function(){return this.value},hasSelection:function(){var e=this.value;return null!==e[0]&&null!==e[1]},getYears:function(){for(var e=this,t=e.yearOffset,n=e.activeYear,a=n+t,l=n,s=[];a>l;++l)s.push(l,++l);return s},updateBody:function(){var e,t,n,a,l,s=this,o=s.years,r=s.months,i=s.getYears(),c=s.selectedCls,u=s.getYear(null),d=s.value[0],h=s.monthOffset;if(s.rendered){for(o.removeCls(c),r.removeCls(c),t=o.elements,a=t.length,n=0;a>n;n++)l=Ext.fly(t[n]),e=i[n],l.dom.innerHTML=e,e===u&&l.addCls(c);null!==d&&(d=h>d?2*d:2*(d-h)+1,r.item(d).addCls(c))}},getYear:function(e,t){var n=this.value[1];return t=t||0,null===n?e:n+t},onBodyClick:function(e,t){var n=this,a="dblclick"===e.type;e.getTarget("."+n.baseCls+"-month")?(e.stopEvent(),n.onMonthClick(t,a)):e.getTarget("."+n.baseCls+"-year")&&(e.stopEvent(),n.onYearClick(t,a))},adjustYear:function(e){"number"!=typeof e&&(e=this.totalYears),this.activeYear+=e,this.updateBody()},onOkClick:function(){this.fireEvent("okclick",this,this.value)},onCancelClick:function(){this.fireEvent("cancelclick",this)},onMonthClick:function(e,t){var n=this;n.value[0]=n.resolveOffset(n.months.indexOf(e),n.monthOffset),n.updateBody(),n.fireEvent("month"+(t?"dbl":"")+"click",n,n.value),n.fireEvent("select",n,n.value)},onYearClick:function(e,t){var n=this;n.value[1]=n.activeYear+n.years.indexOf(e),n.updateBody(),n.fireEvent("year"+(t?"dbl":"")+"click",n,n.value),n.fireEvent("select",n,n.value)},resolveOffset:function(e,t){return e%2===0?e/2:t+Math.floor(e/2)},beforeDestroy:function(){var e=this;e.years=e.months=null,Ext.destroyMembers(e,"backRepeater","nextRepeater","okBtn","cancelBtn"),e.callParent()},onDestroy:function(){Ext.destroyMembers(this,"okBtn","cancelBtn"),this.callParent()},privates:{finishRenderChildren:function(){var e=this;this.callParent(arguments),this.showButtons&&(e.okBtn.finishRender(),e.cancelBtn.finishRender())}}}),Ext.define("Fm.ux.form.DateYearField",{extend:"Ext.form.field.Date",alias:"widget.dateyearfield",requires:["Fm.ux.Year"],format:"Y",formatText:"日期格式要求为年份",createPicker:function(){{var e,t,n=this;Ext.String.format}return n.okText&&(t=t||{},t.okText=n.okText),n.cancelText&&(t=t||{},t.cancelText=n.cancelText),e={ownerCmp:n,floating:!0,hidden:!0,small:!0,listeners:{scope:n,cancelclick:n.collapse,okclick:n.onMonthSelect,yeardblclick:n.onMonthSelect,monthdblclick:n.onMonthSelect},keyNavConfig:{esc:function(){n.collapse()}}},n.originalCollapse=n.collapse,e.listeners.show={fn:function(){this.picker.el.on({mousedown:function(){this.collapse=Ext.emptyFn},mouseup:function(){this.collapse=this.originalCollapse},scope:this})}},n.pickerOptions&&Ext.apply(e,n.pickerOptions,t||{}),Ext.create("Fm.ux.Year",e)},onMonthSelect:function(e,t){var n=this,n=this,a=t[0],l=t[1],s=new Date(l,a,1);s.getMonth()!==a&&(s=new Date(l,a,1).getLastDateOfMonth()),n.setValue(s),n.fireEvent("select",n,s),n.collapse()}});
Ext.define("Fm.ux.form.FileUpload",{extend:"Ext.form.field.File",alias:["widget.fileupload"],alternateClassName:["Ext.form.FileUploadField","Ext.ux.form.FileUploadField","Ext.form.File"],requires:["Ext.form.field.FileButton","Ext.form.trigger.Component"],needArrowKeys:!1,auto:null,compressMode:!1,uploader:null,progressBar:null,fileName:null,dateSeparate:!0,currrentFile:null,onRender:function(){var e=this;e.callParent(arguments),e.rendWebUpload(e.button.id)},setProgressBar:function(e){var r=this;r.progressBar=e},startUpload:function(e){var r=this,a=r.uploader;e="function"==typeof e?{callback:e}:Ext.apply({},e),a&&a.upload(),Ext.apply(r,e)},stopUpload:function(){var e=this,r=e.uploader;r&&r.stop(!0)},retryUpload:function(){var e=this,r=e.uploader;r&&r.retry()},removeFile:function(){var e=this,r=e.uploader;e.setRawValue(""),r&&e.currrentFile&&r.removeFile(e.currrentFile.id,!0)},cancelFile:function(){var e=this,r=e.uploader;r&&r.isInProgress()&&r.cancelFile(e.currrentFile)},getFiles:function(){var e=this,r=e.uploader;return r?r.getFiles():void 0},getFileName:function(){var e=this;return e.fileName},setFileName:function(e){var r=this,a=r.uploader;r.fileName=e,a.option("formData",{fileName:e})},rendWebUpload:function(e){var r,a,t=this,o=t.dateSeparate,l=!0,i=1048576;t.progressBar?t.progressBar.hide():l=!1,WebUploader.Uploader.register({"before-send":"checkchunk"},{checkchunk:function(e){var a=(e.blob.getSource(),this.owner,WebUploader.Deferred());return Ext.Ajax.request({url:"fmshared/file/chunkcheck",method:"post",params:{guid:r,chunk:e.chunk,fileName:e.file.name},success:function(e){var r=Ext.util.JSON.decode(e.responseText);r.isSuccess?a.reject():a.resolve()}}),a.promise()}});var n=WebUploader.create({auto:t.auto,swf:AppConfig.urlStartWith+"lib/webuploader/Uploader.swf",server:AppConfig.urlStartWith+"fmshared/file/upload",chunkSize:i,chunked:!0,chunkRetry:1,threads:1,fileSingleSizeLimit:t.fileSingleSizeLimit,resize:!1,formData:{savePath:t.savePath,compressMode:t.compressMode,chunkSize:i},pick:{multiple:!1,id:"#"+e},accept:{extensions:t.extensions}});t.uploader=n,n.on("error",function(e){Fm.msg.info("F_DUPLICATE"===e?"文件重复添加":"Q_TYPE_DENIED"===e?"文件类型选择出错，请重试":"F_EXCEED_SIZE"===e?"文件过大，请压缩后再进行上传":"出错"+e)}),n.on("uploadProgress",function(e,r){var a,o=Math.floor(100*r);t.progressBar&&(t.progressBar.show(),a=100===o?1:r,t.progressBar.setValue(a,""+e.name+"　正在处理文件..."))}),n.on("fileQueued",function(e){if(t.fireEvent("fileChange",e.name),t.currrentFile&&n.removeFile(t.currrentFile),t.currrentFile=e,r=Fm.Common.Util.Guid().replace(/\s/g,""),o){var l=new Date(Fm.Server.Config.NowDate);a=Ext.util.Format.date(l,"Y-m-d"),n.option("formData",{guid:r,datePath:a})}else n.option("formData",{guid:r});t.setValue(e.name),t.setRawValue(e.name),t.fileName=r+"."+e.name}),n.on("uploadSuccess",function(e){n.removeFile(e),t.currrentFile=null,t.setRawValue(""),l&&t.progressBar.hide(),Ext.Ajax.request({url:"fmshared/file/UploadSuccess",method:"post",params:{fileName:t.fileName,businessPath:t.savePath,datePath:a,compressMode:t.compressMode},success:function(e){var r=Ext.util.JSON.decode(e.responseText);t.fireEvent("fileChange",null),r.IsSuccess?(t.callback&&t.callback(r.Result),t.fireEvent("uploadSuccess",r.Result)):Fm.msg.info("附件上传失败")}})}),n.on("uploadError",function(e){n.removeFile(e),t.fireEvent("fileChange",null),t.callback&&t.callback(null),Fm.msg.info("附件上传失败")})},onDestroy:function(){var e=this;e.uploader.destroy(),e.callParent()}});
Ext.define("Fm.ux.form.MonthDate",{extend:"Ext.form.field.Date",alias:"widget.monthdatefield",requires:["Ext.picker.Month"],alternateClassName:["Ext.form.MonthDateField","Ext.form.MonthDate"],format:"Y-m",createPicker:function(){{var e,t,n=this;Ext.String.format}return n.okText&&(t=t||{},t.okText=n.okText),n.cancelText&&(t=t||{},t.cancelText=n.cancelText),e={ownerCmp:n,floating:!0,hidden:!0,small:!0,listeners:{scope:n,cancelclick:n.collapse,okclick:n.onMonthSelect,yeardblclick:n.onMonthSelect,monthdblclick:n.onMonthSelect},keyNavConfig:{esc:function(){n.collapse()}}},n.originalCollapse=n.collapse,e.listeners.show={fn:function(){this.picker.el.on({mousedown:function(){this.collapse=Ext.emptyFn},mouseup:function(){this.collapse=this.originalCollapse},scope:this})}},n.pickerOptions&&Ext.apply(e,n.pickerOptions,t||{}),Ext.create("Ext.picker.Month",e)},onMonthSelect:function(e,t){var n=this,n=this,o=t[0],l=t[1],c=new Date(l,o,1);c.getMonth()!==o&&(c=new Date(l,o,1).getLastDateOfMonth()),n.setValue(c),n.fireEvent("select",n,c),n.collapse()}});
Ext.define("Fm.ux.form.PopWindow",{extend:"Ext.form.field.ComboBox",alias:"widget.popwindowfield",triggerCls:Ext.baseCSSPrefix+"cis-window-trigger",multiSelect:!0,showClearTriggers:!0,clearValue:function(){this.setValue([])},onTriggerClickPopWindow:function(){var e,i=this;e=new Ext.window.Window({title:i.fieldLabel,height:i.winHeight,width:i.winWidth,modal:!0,layout:"fit",items:[i.innerGrid],bbar:["->",{text:"全选",handler:"onExpandAll",bind:{hidden:"{singleSelected}"}},{text:"取消选中",handler:"cancelCheck",bind:{hidden:"{singleSelected}"}},{text:"选择",handler:function(){var e=this;e.setValue("ssss"),e.close()}},{text:"取消",handler:"cancel"}],listeners:{scope:i,close:i.onClose,select:i.onSelect}}),e.show()},initComponent:function(){var e=this;triggers=e.getTriggers(),"window"!==e.pickerType&&(e.triggerCls=null),triggers.picker={weight:1,handler:"onTriggerClick",scope:"this"},e.setTriggers(triggers),e.callParent()},onTriggerClick:function(e){var i=this;"window"===i.pickerType?i.onTriggerClickPopWindow():i.readOnly||i.disabled||(i.isExpanded?i.collapse():i.expand())},initValue:function(){var e=this,i=e.value;Ext.isString(i)&&(e.value=e.rawToValue(i)),e.callParent()},onClose:function(){var e=this;e.collapse(),e.setValue("关闭弹出窗口")},createPicker:function(){var e,i=this;i.store=i.innerGrid.store;var i=this,e=i.picker=i.getGridPicker();return i.pageSize&&e.pagingToolbar.on("beforechange",i.onPageChange,i),e.initialConfig.maxHeight||e.on({beforeshow:i.onBeforePickerShow,scope:i}),e.getSelectionModel().on({beforeselect:i.onBeforeSelect,beforedeselect:i.onBeforeDeselect,scope:i}),e.getNavigationModel().navigateOnSpace=!1,e},getGridPicker:function(){var e=this,i=Ext.apply(e.innerGrid,{pickerField:e,hidden:!0,store:e.getPickerStore(),displayField:e.displayField,preserveScrollOnRefresh:!0,pageSize:e.pageSize,selModel:e.pickerSelectionModel,floating:!0,minWidth:e.minPickerWidth,minHeight:e.minPickerHeight,maxHeight:e.maxPickerHeight,autoScroll:!0,listeners:{itemclick:{fn:e.onItemClick}},refresh:function(){}});e.originalCollapse=e.collapse,i.listeners.show={fn:function(){e.picker.el.on({mousedown:function(){this.collapse=Ext.emptyFn},mouseup:function(){this.collapse=this.originalCollapse},scope:e})}};var n;return n=Ext.ComponentManager.create(Ext.isFunction(i)?i.call():i,"panel")},onSelect:function(e,i){var n=this;n.setValue(i),n.fireEvent("select",n,i),n.collapse()},onArrowKey:function(e,i){("left"===e||"right"===e)&&i.preventDefault()}});
Ext.define("Fm.ux.form.TreePicker",{extend:"Ext.form.field.Picker",xtype:"treepicker",uses:["Ext.tree.Panel"],triggerCls:Ext.baseCSSPrefix+"form-arrow-trigger",config:{store:null,displayField:null,columns:null,selectOnTab:!0,maxPickerHeight:300,minPickerHeight:100},editable:!1,initComponent:function(){var e=this;e.callParent(arguments),e.mon(e.store,{scope:e,load:e.onLoad,update:e.onUpdate})},createPicker:function(){this.originalCollapse=this.collapse;var e=this,t=new Ext.tree.Panel({shrinkWrapDock:2,store:e.store,floating:!0,displayField:e.displayField,columns:e.columns,height:e.pickerHeight,width:e.pickerWidth,minHeight:e.minPickerHeight,maxHeight:e.maxPickerHeight,manageHeight:!1,shadow:!1,listeners:{scope:e,itemclick:e.onItemClick,show:function(){e.picker.el.on({mouseover:function(){this.collapse=Ext.emptyFn},mouseout:function(){this.collapse=this.originalCollapse},scope:e})}},viewConfig:{listeners:{scope:e,render:e.onViewRender}}}),i=t.getView();return Ext.isIE9&&Ext.isStrict&&i.on({scope:e,highlightitem:e.repaintPickerView,unhighlightitem:e.repaintPickerView,afteritemexpand:e.repaintPickerView,afteritemcollapse:e.repaintPickerView}),t},onViewRender:function(e){e.getEl().on("keypress",this.onPickerKeypress,this)},repaintPickerView:function(){var e=this.picker.getView().getEl().dom.style;e.display=e.display},onItemClick:function(e,t,i,n,o){this.selectItem(t)},onPickerKeypress:function(e,t){var i=e.getKey();(i===e.ENTER||i===e.TAB&&this.selectOnTab)&&this.selectItem(this.picker.getSelectionModel().getSelection()[0])},selectItem:function(e){var t=this;t.setValue(e.getId()),t.fireEvent("select",t,e),t.collapse()},onExpand:function(){var e,t=this,i=t.picker,n=i.store,o=t.value;o&&(e=n.getNodeById(o)),e||(e=n.getRoot()),i.selectPath(e.getPath())},setValue:function(e){var t,i=this;return i.value=e,i.store.loading?i:(t=e?i.store.getNodeById(e):i.store.getRoot(),void 0===e?(t=i.store.getRoot(),i.value=t.getId()):t=i.store.getNodeById(e),i.setRawValue(t?t.get(i.displayField):""),i)},getSubmitValue:function(){return this.value},getValue:function(){return this.value},onLoad:function(){var e=this.value;e&&this.setValue(e)},onUpdate:function(e,t,i,n){var o=this.displayField;"edit"===i&&n&&Ext.Array.contains(n,o)&&this.value===t.getId()&&this.setRawValue(t.get(o))}});
Ext.define("Fm.ux.form.UEditor",{extend:"Ext.form.field.TextArea",alias:["widget.ueditor"],fieldSubTpl:['<textarea id="{id}-ue" autocomplete="off">\n','<tpl if="value">{[Ext.util.Format.htmlEncode(values.value)]}</tpl>',"</textarea>",'<textarea id="{id}" data-ref="inputEl" style="display:none" ','<tpl if="name"> name="{name}"</tpl>',' autocomplete="off">\n','<tpl if="value">{[Ext.util.Format.htmlEncode(values.value)]}</tpl>',"</textarea>",{disableFormats:!0}],width:700,config:{ueditorConfig:{}},initComponent:function(){var e=this;e.callParent(arguments)},afterRender:function(){var e=this;if(e.callParent(arguments),e.ue)e.ue.setContent(e.getValue());else{e.ue=UE.getEditor(e.getInputId()+"-ue",Ext.apply(e.ueditorConfig,{initialFrameHeight:e.height||"300px",initialFrameWidth:"100%",imageActionName:"uploadimage",imageFieldName:"upfile",imageAllowFiles:[".png",".jpg",".jpeg",".gif",".bmp"],imageCompressEnable:!1,imageInsertAlign:"none",imageUrlPrefix:"",fileActionName:"uploadfile",fileFieldName:"upfile",fileUrlPrefix:"",fileAllowFiles:[".png",".jpg",".jpeg",".gif",".bmp",".rar",".zip",".tar",".gz",".7z",".doc",".docx",".xls",".xlsx",".ppt",".pptx",".pdf",".txt"]})),e.ue.ready(function(){e.UEditorIsReady=!0});var t=e.up("window");if(t&&"hide"==t.closeAction)t.on("beforehide",function(){e.onDestroy()});else{var i=e.up("panel");i&&"hide"==i.closeAction&&i.on("beforehide",function(){e.onDestroy()})}}},setValue:function(e){var t=this;return t.UEditorIsReady?t.ue.insertHtml(e):t.setRawValue(t.valueToRaw(e)),t.callParent(arguments),t},getRawValue:function(){var e=this;e.UEditorIsReady&&(document.getElementById(e.getInputId()).innerText=e.ue.getContent());var t=e.callParent();return t===e.emptyText&&e.valueContainsPlaceholder&&(t=""),t},onDestroy:function(){var e=this;if(e.rendered)try{e.ue.destroy(),delete e.ue}catch(t){}e.callParent()}});
Ext.define("Fm.ux.grid.feature.Grouping",{extend:"Ext.grid.feature.Grouping",alias:"feature.cisgrouping",checkCls:Ext.baseCSSPrefix+"grid-group-checked",groupHeaderTpl:"{columnName}: {name}",checkSelector:Ext.baseCSSPrefix+"grid-group-checked-select",isShowCheck:!0,init:function(e){var t=this;t.isShowCheck&&(t.groupHeaderTpl=['<i class="{checkedCls} '+t.checkSelector+'" data-groupName-check="{name:htmlEncode}"></i>'+t.groupHeaderTpl]),t.callParent([e]),t.isShowCheck&&(e.on({select:t.groupCheckedChange,deselect:t.groupDeCheckedChange,scope:t}),e.getSelectionModel().on({selectAll:t.groupCheckedAllChange,deselectAll:t.groupDeCheckedAllChange,updateGroupSelect:t.groupFristCheckedChange,scope:t}))},getGridStore:function(){return this.view.getStore()||this.view.selModel.store},groupFristCheckedChange:function(){for(var e=this,t=e.getGridStore(),r=t.getGroups().items,o=0;o<r.length;o++)e.doUpdateGroupCheckedHead(r[o].getGroupKey(),null)},groupCheckedChange:function(e,t){var r=this,o=r.getGridStore().getGrouper().getGroupString(t);r.doUpdateGroupCheckedHead(o,null)},groupCheckedAllChange:function(e,t){for(var r=this,o=this.getGridStore(),c=o.getGroups().items,a=0;a<c.length;a++)r.doUpdateGroupCheckedHead(c[a].getGroupKey(),!0)},groupDeCheckedChange:function(e,t){var r=this,o=r.getGridStore().getGrouper().getGroupString(t);r.doUpdateGroupCheckedHead(o,!1)},groupDeCheckedAllChange:function(e,t){for(var r=this,o=this.getGridStore(),c=o.getGroups().items,a=0;a<c.length;a++)r.doUpdateGroupCheckedHead(c[a].getGroupKey(),!1)},doUpdateGroupCheckedHead:function(e,t){var r,o,c=this;null===t&&(t=!0,r=c.getGroup(e),o=c.grid.getSelectionModel(),Ext.each(r.items,function(e){return o.isSelected(e)?void 0:(t=!1,!1)})),c.getCache()[e].isCheckedSub=t,Ext.suspendLayouts(),c.dataSource&&c.dataSource.onRefresh?c.dataSource.onRefresh():c.dataSource&&c.dataSource.onDataChanged&&c.dataSource.onDataChanged(),Ext.resumeLayouts(!0)},doSetGroupChecked:function(e,t){var r=this;r.grid.mask("......"),setTimeout(function(){Ext.suspendLayouts();var o=r.grid.getSelectionModel(),c=o.getSelection().length;if(o.suspendChanges(),t)o.select(r.getGroup(e).items,!0,!0);else{var a=r.getGroup(e).items;if(a.length>100){var u=Ext.Array.difference(o.getSelection(),r.getGroup(e).items);o.deselectAll(!0),o.select(u,!0,!0),r.groupFristCheckedChange()}else o.deselect(r.getGroup(e).items,!0)}o.resumeChanges(),o.destroyed||o.maybeFireSelectionChange(o.getSelection().length!==c),r.doUpdateGroupCheckedHead(e,t),Ext.resumeLayouts(!0),r.grid.unmask()},10)},onGroupClick:function(e,t,r,o){var c,a=this,u=a.getCache();a.isShowCheck?(c=Ext.get(o.target),c.hasCls(a.checkSelector)?(a.doSetGroupChecked(r,!u[r].isCheckedSub),u[r].isCheckedSub=!u[r].isCheckedSub,o.stopEvent()):a.callParent(arguments)):a.callParent(arguments)},setupRowData:function(e,t,r){this.callParent(arguments);var o=this,c=o.refreshData,a=r.groupRenderInfo;if(c.doGrouping&&r.isFirstRow){var u=o.getMetaGroup(r.groupName);u.isCheckedSub?(r.metaGroupCache&&(r.metaGroupCache.checkedCls=o.checkCls),a&&(a.checkedCls=o.checkCls)):(r.metaGroupCache&&(r.metaGroupCache.checkedCls=o.checkCls+"-no"),a&&(a.checkedCls=o.checkCls+"-no"))}}});
Ext.define("Fm.ux.grid.plugin.CisRowExpander",{extend:"Ext.plugin.Abstract",lockableScope:"normal",requires:["Ext.grid.feature.RowBody"],alias:"plugin.cisrowexpander",columnWidth:24,mixins:{observable:"Ext.util.Observable"},autoExpandFirstRow:!0,singleExpand:!0,isRowExpander:!0,rowBodyTpl:null,lockedTpl:null,expandOnEnter:!1,expandOnClick:!0,closeOnDblClick:!0,selectRowOnExpand:!1,headerWidth:24,bodyBefore:!1,hiddenColumn:!1,rowBodyTrSelector:"."+Ext.baseCSSPrefix+"grid-rowbody-tr",rowBodyHiddenCls:Ext.baseCSSPrefix+"grid-row-body-hidden",rowCollapsedCls:Ext.baseCSSPrefix+"grid-row-collapsed",swallowBodyEvents:!0,addCollapsedCls:{fn:function(e,t,o){var n=this.rowExpander;n.recordsExpanded[t.record.internalId]||t.itemClasses.push(n.rowCollapsedCls),this.nextTpl.applyOut(t,e,o)},syncRowHeights:function(e,t){this.rowExpander.syncRowHeights(e,t)},priority:2e4},constructor:function(e){this.callParent(arguments),this.mixins.observable.constructor.call(this),this.fitCmpWidth=Ext.Function.createDelayed(this.fitCmpWidth,1)},setCmp:function(e){var t,o=this;this.callParent(arguments),this.recordsExpanded={},this.preventsExpanding={},this.bodyContent={},this.rowBodyTpl||(this.rowBodyTpl=""),Ext.isEmpty(this.rowBodyTpl)||!this.loader&&!this.component||(this.cmpBodyTpl=this.rowBodyTpl instanceof Ext.XTemplate?this.rowBodyTpl:Ext.create("Ext.XTemplate",this.rowBodyTpl),this.rowBodyTpl=""),this.rowBodyTpl=this.rowBodyTpl instanceof Ext.XTemplate?this.rowBodyTpl:Ext.create("Ext.XTemplate",this.rowBodyTpl),t=o.getFeatureConfig(e),e.features=e.features?Ext.Array.push(t,e.features):t,this.componentsCache=[],this.outerComponentsCache=[],this.component&&this.singleExpand===!1&&(this.componentCfg=this.component,delete this.component),this.component&&!this.component.initialConfig&&(this.component.monitorResize=!0,this.componentCfg=this.component,this.component=Ext.ComponentManager.create(Ext.isFunction(this.component)?this.component.call({expander:this}):this.component,"panel"),this.component.on({render:function(){var t=this;o.swallowRow(t),Ext.each(t.query("textfield,textarea"),function(t){t.on({focus:function(t,o,n,i){e.getStore().suspendEvents()},blur:function(t){e.getStore().resumeEvents()}})})}}))},getFeatureConfig:function(e){var t=this,o=[],n={ftype:"rowbody",rowExpander:t,bodyBefore:t.bodyBefore,recordsExpanded:this.recordsExpanded,rowBodyHiddenCls:this.rowBodyHiddenCls,rowCollapsedCls:this.rowCollapsedCls,setupRowData:this.getRowBodyFeatureData,setup:this.setup,expander:this};return o.push(Ext.apply({lockableScope:"normal",getRowBodyContents:t.getRowBodyContentsFn(t.rowBodyTpl)},n)),e.enableLocking&&o.push(Ext.apply({lockableScope:"locked",getRowBodyContents:t.lockedTpl?t.getRowBodyContentsFn(t.lockedTpl):function(){return""}},n)),o},getRowBodyContentsFn:function(e){var t=this;return function(o){return e.owner=t,e.applyTemplate(o.record.getData())||this.rowExpander.bodyContent[o.record.internalId]}},getExpanded:function(){var e=this.grid.store,t=[];return(e.store||e).each(function(e,o){this.recordsExpanded[e.internalId]&&t.push(e)},this),t},init:function(e){e.lockable&&(e=e.normalGrid);var t,o=this,n=e.ownerLockable;this.callParent(arguments),this.grid=e,o.view=e.getView(),o.bindView(o.view),o.view.addRowTpl(o.addCollapsedCls).rowExpander=o,n?(o.addExpander(n.lockedGrid.headerCt.items.getCount()?n.lockedGrid:e),t=n.lockedGrid.getView(),o.bindView(t),t.addRowTpl(o.addCollapsedCls).rowExpander=o,n.syncRowHeight=!0,n.mon(n,{processcolumns:o.onLockableProcessColumns,lockcolumn:o.onColumnLock,unlockcolumn:o.onColumnUnlock,scope:o}),o.viewListeners=view.on({itemadd:Ext.Function.createAnimationFrame(n.syncRowHeights,n)})):(o.addExpander(e),e.on("beforereconfigure",o.beforeReconfigure,o)),e.headerCt.on("columnhide",this.updateComponentsWidth,this,{delay:20,buffer:20}),e.headerCt.on("columnshow",this.updateComponentsWidth,this,{delay:20,buffer:20}),o.expands=[]},updateComponentsWidth:function(){var e,t,o,n=this.grid,i=n.store.store||n.store,r=this.componentsCache.length;try{if(this.component&&this.component.record&&this.recordsExpanded[this.component.record.internalId]){var s=Ext.get(n.view.getNode(i.getByInternalId(this.component.record.internalId)));s&&s.down&&(t=s.down("div.x-grid-rowbody"),this.component.setWidth(t.getWidth()-t.getPadding("lr")-(this.scrollOffset||0)))}if(this.componentsCache&&r>0)for(e=0;r>e;e++)o=this.componentsCache[e],this.recordsExpanded[o.id]&&(t=Ext.get(n.view.getNode(i.getByInternalId(o.id))).down("div.x-grid-rowbody"),o.cmp.setWidth(t.getWidth()-t.getPadding("lr")-(this.scrollOffset||0)))}catch(d){}},beforeReconfigure:function(e,t,o,n,i){var r=this;r.viewListeners&&r.viewListeners.destroy(),o&&(r.expanderColumn=new Ext.grid.Column(r.getHeaderConfig()),o.unshift(r.expanderColumn))},onLockableProcessColumns:function(e,t,o){this.addExpander(t.length?e.lockedGrid:e.normalGrid)},addExpander:function(e){var t=this,o=t.getHeaderConfig();t.expandOnClick||(e.isLocked&&e.ownerLockable.shrinkWrapLocked&&(e.width+=o.width),t.expanderColumn=e.headerCt.insert(0,o),e.getSelectionModel().injectCheckbox=1)},getRowBodyFeatureData:function(e,t,o){var n=this;n.self.prototype.setupRowData.apply(n,arguments),o.rowBody=n.getRowBodyContents(o),o.rowBodyCls=n.recordsExpanded[e.internalId]?"":n.rowBodyHiddenCls},setup:function(e,t){var o=this,n=o.grid.ownerLockable;o.self.prototype.setup.apply(o,arguments),n&&-1!==Ext.Array.indexOf(o.grid.columnManager.getColumns(),o.rowExpander.expanderColumn)&&(t.rowBodyColspan-=1)},bindView:function(e){if(e.stopEventFn=this.stopEventFn,e.on("beforerefresh",function(){this.preventsExpanding={}},this),this.expandOnEnter&&e.on("itemkeydown",this.onKeyDown,this),this.closeOnDblClick&&e.on("itemdblclick",this.onDblClick,this),this.expandOnClick&&e.on("itemclick",this.onClick,this),this.autoExpandFirstRow){e.ownerCt.on("expandfirstrow",this.onExpandFirstRow,this),e.on("refresh",function(){this.fireEvent("expandfirstrow",this)},e.ownerCt)}e.on("itemmousedown",function(e,t,o,n,i){return!i.getTarget("div.x-grid-rowbody",e.el)},this),(this.componentCfg&&this.singleExpand===!1||this.loader)&&(e.on("beforerefresh",this.mayRemoveComponents,this),e.on("beforeitemupdate",this.mayRemoveComponent,this),e.on("beforeitemremove",this.removeComponent,this),e.on("refresh",this.restoreComponents,this),e.on("itemupdate",this.restoreSingleComponent,this),e.on("itemadd",this.onExpandMemRows,this)),this.component&&(e.on("beforerefresh",this.moveComponent,this),e.on("beforeitemupdate",this.moveComponent,this),e.on("beforeitemremove",this.moveComponent,this),e.on("refresh",this.restoreComponent,this),e.on("itemupdate",this.restoreComponent,this),e.on("itemremove",this.moveComponent,this),e.on("itemadd",this.restoreComponent,this),e.ownerCt.on("show",this.restoreComponent,this))},moveComponent:function(){if(this.componentInsideGrid){var e=this.component.getEl(),t=Ext.getBody();e.addCls("x-hidden"),t.dom.appendChild(e.dom),this.componentInsideGrid=!1}},removeComponent:function(e,t,o){for(var n=0,i=this.componentsCache.length;i>n;n++)if(this.componentsCache[n].id==t.internalId){try{var r=this.componentsCache[n].cmp;r.destroy(),Ext.Array.remove(this.componentsCache,this.componentsCache[n])}catch(s){}break}},mayRemoveComponent:function(e,t,o){if(this.invalidateComponentsOnRefresh)return void this.removeComponents(e,t,o);for(var n,i,r,s=0,d=this.componentsCache.length;d>s;s++)if(n=this.componentsCache[s],n.id==t.internalId){i=n.cmp.getEl(),r=Ext.getBody(),i.addCls("x-hidden"),r.dom.appendChild(i.dom),this.outerComponentsCache.push(n),Ext.Array.remove(this.componentsCache,n);break}},mayRemoveComponents:function(){if(this.invalidateComponentsOnRefresh)return void this.removeComponents();for(var e,t,o=Ext.getBody(),n=0,i=this.componentsCache.length;i>n;n++)e=this.componentsCache[n].cmp,t=e.getEl(),t.addCls("x-hidden"),o.dom.appendChild(t.dom);this.outerComponentsCache=this.componentsCache,this.componentsCache=[]},removeComponents:function(e){for(var t=0,o=this.componentsCache.length;o>t;t++)try{var n=this.componentsCache[t].cmp;n.destroy()}catch(i){}if(this.componentsCache=[],e&&this.outerComponentsCache){for(var t=0,o=this.outerComponentsCache.length;o>t;t++)try{var n=this.outerComponentsCache[t].cmp;n.destroy()}catch(i){}this.outerComponentsCache=[]}},restoreComponent:function(){if(this.component.rendered!==!1){var e=this.grid;Ext.each(e.getView().getViewRange(),function(t,o){if(!t.isCollapsedPlaceholder&&this.recordsExpanded[t.internalId]){{var n=e.view.getNode(t,!1),i=Ext.get(n),r=i.down("div.x-grid-rowbody");this.getComponent(t,r)}return r.appendChild(this.component.getEl()),this.component.removeCls("x-hidden"),this.componentInsideGrid=!0,!1}},this),e.view.refreshSize(!0),this.fitCmpWidth(this.component)}},onRowCmpLoad:function(e,t,o){var n=e.paramsFnScope.expander,i=n.grid,r=e.getTarget();i.view.refreshSize(!0),n.fitCmpWidth(r)},createComponent:function(e,t){var o,n,i,r;return this.loader?(n=!("html"==this.loader.renderer||"data"==this.loader.renderer),i={record:e,expander:this,el:t,grid:this.grid},r=Ext.isFunction(this.loader)?this.loader.call(i):Ext.clone(this.loader),r.paramsFnScope=i,r.success=this.onRowCmpLoad,o=Ext.create(n?"Ext.container.Container":"Ext.Component",{loader:r,layout:"anchor",defaults:{anchor:"100%"},tpl:Ext.isEmpty(this.cmpBodyTpl)?void 0:this.cmpBodyTpl instanceof Ext.XTemplate?this.cmpBodyTpl:Ext.create("Ext.XTemplate",this.cmpBodyTpl)})):o=Ext.ComponentManager.create(Ext.isFunction(this.componentCfg)?this.componentCfg.call({record:e,expander:this}):Ext.clone(this.componentCfg),"panel"),this.componentMargin&&(o.margin=this.componentMargin),o.ownerCt=this.grid,o.record=e,o.width=t.getWidth()-(this.scrollOffset||0),o.render(t),o.addCls("x-row-expander-control"),this.componentsCache.push({id:e.internalId,cmp:o}),o},restoreSingleComponent:function(e,t,o){var n=this.grid;if(!e.isCollapsedPlaceholder&&this.recordsExpanded[e.internalId]){var i=n.view.getNode(e,!1),r=Ext.get(i),s=(r.down(this.rowBodyTrSelector),r.down("div.x-grid-rowbody")),d=this.getComponent(e,s);d||(d=this.createComponent(e,s)),n.view.refreshSize(!0),this.fitCmpWidth(d)}},restoreComponents:function(){var e=this.grid,t=[];Ext.each(e.getView().getViewRange(),function(o,n){if(!o.isCollapsedPlaceholder&&this.recordsExpanded[o.internalId]){var i=e.view.getNode(o,!1),r=Ext.get(i),s=(r.down(this.rowBodyTrSelector),r.down("div.x-grid-rowbody")),d=this.getComponent(o,s);d||(d=this.createComponent(o,s)),t.push(d)}},this),this.removeOuterOrphans(),e.view.viewReady&&e.view.refreshSize(!0),Ext.each(t,function(e){this.fitCmpWidth(e)},this)},removeOuterOrphans:function(){if(this.outerComponentsCache&&this.outerComponentsCache.length>0)for(var e,t,o,n=this.outerComponentsCache.length,i=this.grid.store.store||this.grid.store,r=i.data.items,s=r.length,d=0;n>d;){for(o=this.outerComponentsCache[d],t=!1,e=0;s>e;e++)if(r[e].internalId==o.id){t=!0;break}if(t)d++;else{try{o.cmp.destroy()}catch(h){}Ext.Array.remove(this.outerComponentsCache,o),n--}}},swallowRow:function(e){this.swallowBodyEvents&&e.getEl().swallowEvent(["click","mousedown","mousemove","mouseup","dblclick","contextmenu","mouseover","mouseout"],!1)},onKeyDown:function(e,t,o,n,i){if(i.getKey()===i.ENTER)for(var r=e.store.store||e.store,s=e.getSelectionModel().getSelection(),d=s.length,h=0;d>h;h++)this.preventsExpanding[s[h].internalId]||(n=r.indexOf(s[h]),this.toggleRow(n,s[h]))},beforeExpand:function(e,t,o,n){return this.fireEvent("beforeexpand",this,e,t,o,n)!==!1?((this.singleExpand||this.component)&&this.collapseAll(),!0):!1},expandAll:function(){if(!this.singleExpand&&!this.component){var e=0,t=this.view.getViewRange(),o=this.grid.store.store||this.grid.store,n=t.length;for(e;n>e;e++)this.toggleRow(o.indexOf(t[e]),t[e],!0)}},collapseAll:function(){try{var e=0,t=this.view.getViewRange(),o=this.grid.store.store||this.grid.store,n=t.length;for(e;n>e;e++)this.toggleRow(o.indexOf(t[e]),t[e],!1);this.recordsExpanded={},this.grid.view.rowBodyFeature.recordsExpanded=this.recordsExpanded}catch(i){}},collapseRow:function(e){this.toggleRow(e,this.view.getRecord(this.view.getNode(e)),!1)},expandRow:function(e){try{if(!Ext.get(e.offsetParent).hasCls(this.rowCollapsedCls))return;this.toggleRow(e,this.view.getRecord(this.view.getNode(e)),!0)}catch(t){}},toggleRow:function(e,t,o){if(!t.isCollapsedPlaceholder){var n,i=this,r=this.view,s=r.bufferedRenderer,d=r.getScrollable(),h=r,a=this.view.getNode(t,!1),l=Ext.get(a);try{l.down(this.rowBodyTrSelector)}catch(c){return}var p,m,C=l.down(this.rowBodyTrSelector),g=l.down("div.x-grid-rowbody"),u=Ext.isDefined(o),f=l.hasCls(i.rowCollapsedCls),w=f?"removeCls":"addCls",x=this.grid,E=f?2:1,v=i.grid.ownerLockable;e=(x.store.store||x.store).indexOf(t),Ext.suspendLayouts(),!u||u&&o===!0?this.beforeExpand(t,C,a,e)&&(l.removeCls(this.rowCollapsedCls),C.removeCls(this.rowBodyHiddenCls),this.recordsExpanded[t.internalId]=!0,this.component?(this.recreateComponent&&(this.component.destroy(),this.component=Ext.ComponentManager.create(Ext.isFunction(this.componentCfg)?this.componentCfg.call({record:t,expander:this}):this.componentCfg,"panel")),this.component.rendered?(g.appendChild(this.component.getEl()),this.component.show(),this.component.setWidth(g.getWidth()-(this.scrollOffset||0))):(this.component.width=g.getWidth()-(this.scrollOffset||0),this.component.render(g)),this.component.addCls("x-row-expander-control"),this.component.removeCls("x-hidden"),this.componentInsideGrid=!0,p=this.component):(this.componentCfg||this.loader)&&(p=this.getComponent(t,g),p?p.show():p=this.createComponent(t,g)),p&&(p.record=t,this.fitCmpWidth(p)),this.expands.push(t),this.fireEvent("expand",this,t,p,C,a,e)):(!l.hasCls(this.rowCollapsedCls)&&!u||u&&o===!1&&!l.hasCls(this.rowCollapsedCls))&&this.fireEvent("beforecollapse",this,t,C,a,e)!==!1&&(this.component&&this.component.rendered?this.component.hide():(this.componentCfg||this.loader)&&(p=this.getComponent(t,g),p&&p.rendered&&p.hide()),l.addCls(this.rowCollapsedCls),C.addCls(this.rowBodyHiddenCls),this.recordsExpanded[t.internalId]=!1,Ext.Array.remove(this.expands,t),this.fireEvent("collapse",this,t,p,C,a,e)),i.grid.ownerLockable&&(h=v.getView(),v.lockedGrid.isVisible()&&(r=v.view.lockedGrid.view,n=Ext.fly(r.getNode(e)),n&&(n[w](i.rowCollapsedCls),C=n.down(i.rowBodyTrSelector,!0),Ext.fly(C)[w](i.rowBodyHiddenCls)))),i.expanderColumn&&(m=Ext.fly(r.getRow(e)).down(i.expanderColumn.getCellSelector(),!0),m&&(m.rowSpan=E)),h.fireEvent(f?"expandbody":"collapsebody",a,t,C),(r.getSizeModel().height.shrinkWrap||v)&&r.refreshSize(!0),d&&(s?s.refreshSize():d.refresh(!0)),Ext.resumeLayouts(!0)}},onDblClick:function(e,t,o,n,i){this.preventsExpanding[t.internalId]||i.getTarget(this.rowBodyTrSelector,e.el)||this.isExpanded(o)&&this.collapseRow(o)},onClick:function(e,t,o,n,i){var r,s=this,d=s.grid;return d.getSelectionModel&&(r=d.getSelectionModel()),r&&r.checkOnly&&i.position.colIdx===r.injectCheckbox?!1:void(this.isExpanded(o)||this.preventsExpanding[t.internalId]||i.getTarget(this.rowBodyTrSelector,e.el)||(this.collapseAll(),this.toggleRow(n,t)))},onExpandMemRows:function(e){for(var t,o=this,n=o.grid.view,i=0;i<this.expands.length;i++){var r=n.getNode(this.expands[i],!1);t=Ext.get(r),t&&setTimeout(function(){o.expandRow(t)},100)}},onExpandFirstRow:function(e){var t=this,o=e.view,n=o.getRow(0),i=e.getStore().getAt(0);n&&(t.recordsExpanded[i.internalId]=!0,t.collapseAll(),setTimeout(function(){if(Ext.get(n))try{t.expandRow(n)}catch(e){}},100))},renderer:Ext.emptyFn,syncRowHeights:function(e,t){var o,n,i=this,r=Ext.fly(e).down(i.rowBodyTrSelector),s=Ext.fly(t).down(i.rowBodyTrSelector);s.isVisible()?(o=r.getHeight())!==(n=s.getHeight())&&(o>n?s.setHeight(o):r.setHeight(n)):r.dom.style.height=s.dom.style.height=""},onColumnUnlock:function(e,t){var o,n=this;e=n.grid.ownerLockable,o=e.lockedGrid.visibleColumnManager.getColumns(),1===o.length&&(o[0]===n.expanderColumn?(e.unlock(n.expanderColumn),n.grid=e.normalGrid):e.lock(n.expanderColumn,0))},onColumnLock:function(e,t){var o,n,i=this;e=i.grid.ownerLockable,o=e.lockedGrid.visibleColumnManager.getColumns(),1===o.length&&(i.grid=n=e.lockedGrid,n.headerCt.insert(0,i.expanderColumn))},getHeaderConfig:function(){var e=this,t=e.grid.ownerLockable;return{width:e.headerWidth,isExpanderColumn:!0,lockable:!1,sortable:!1,resizable:!1,draggable:!1,hideable:!1,menuDisabled:!0,hidden:this.hiddenColumn,tdCls:Ext.baseCSSPrefix+"grid-cell-special",innerCls:Ext.baseCSSPrefix+"grid-cell-inner-row-expander",preinitScope:e,preinitFn:function(e){this.expanderColumn=e},renderer:function(t,o,n){var i=e.renderer.apply(this,arguments);return i===!1?(i="&#160;",e.preventsExpanding[n.internalId]=!0):i===!0&&(i=null),e.recordsExpanded[n.internalId]&&(o.tdAttr+=' rowspan="2"'),i?i:'<div class="'+Ext.baseCSSPrefix+'grid-row-expander" role="presentation"></div>'},processEvent:function(t,o,n,i,r,s,d){return s.getTarget("."+Ext.baseCSSPrefix+"grid-row-expander")&&"click"===t?(e.toggleRow(i,d),e.selectRowOnExpand):void 0},isLocked:function(){return t&&(t.lockedGrid.isVisible()||this.locked)},editRenderer:function(){return"&#160;"}}},isCollapsed:function(e){return"number"==typeof e&&(e=this.view.getNode(e)),Ext.fly(e).hasCls(this.rowCollapsedCls)},isExpanded:function(e){return"number"==typeof e&&(e=this.view.getNode(e)),!Ext.fly(e).hasCls(this.rowCollapsedCls)},getComponent:function(e,t){var o,n,i,r;if(this.componentsCache)for(o=0,n=this.componentsCache.length;n>o;o++)if(i=this.componentsCache[o],i.id==e.internalId)return t&&i.cmp.setWidth(t.getWidth()-(this.scrollOffset||0)),i.cmp;if(this.outerComponentsCache)for(o=0,n=this.outerComponentsCache.length;n>o;o++)if(this.outerComponentsCache[o].id==e.internalId)return i=this.outerComponentsCache[o],r=i.cmp,t&&(t.appendChild(r.getEl()),r.removeCls("x-hidden"),r.setWidth(t.getWidth()-(this.scrollOffset||0)),Ext.Array.remove(this.outerComponentsCache,i),this.componentsCache.push(i)),r;return null},destroy:function(){this.component&&Ext.isFunction(this.component.destroy)&&this.component.destroy(),this.componentsCache&&this.removeComponents(!0)},fitCmpWidth:function(e){if(e&&e.record&&this.recordsExpanded[e.record.internalId]){var t=Ext.get(this.grid.view.getNode((this.grid.store.store||this.grid.store).getByInternalId(e.record.internalId)));if(t){var o=t.down("div.x-grid-rowbody");e.setWidth(o.getWidth()-o.getPadding("lr")-(this.scrollOffset||0))}}}});
Ext.override(Ext.grid.Panel,{config:{clickSelection:null},publishes:["selection","clickSelection"],twoWayBindable:["selection","clickSelection"]}),Ext.define("Fm.ux.grid.plugin.ClickSelection",{extend:"Ext.plugin.Abstract",alias:"plugin.clickselection",isClickSelection:!0,allowDeSelect:!1,singleClick:!1,init:function(e){if(!e.isLocked&&!e.ClickSelection){var t=this;t.grid=e,t.store=e.getStore(),t.clickSelection=this.grid.getClickSelection(),t.grid.getView().on("refresh",this.deSelect,t),t.grid.on("beforeitemclick",this._updateClickSelection,t),t.grid.lastSelectRecordId=null;var i=t.grid.getView().getRowClass;this.grid.getView().getRowClass=function(){},this.grid.getView().getRowClass=function(e,l,c,o){var r=i(e,l,c,o)||"";return t.grid.lastSelectRecordId&&e.getId()===t.grid.lastSelectRecordId&&(r+=" x-grid-record-click"),r}}},destroy:function(){this.grid&&!this.grid.lockable&&(this.grid.getView().un("refresh",this.deSelect),this.grid.un("itemclick",this._updateClickSelection))},_updateClickSelection:function(e,t,i,l,c){if(t.get("_isDisabled"))return!1;var o,r,d=this,s=d.grid,n=s.getStore().store||s.getStore();return d.singleClick&&s.lastSelectRecordId===t.getId()?!1:(s.getSelectionModel&&(o=s.getSelectionModel()),o&&o.checkOnly&&c.position.colIdx===o.injectCheckbox?!1:(d.allowDeSelect&&s.lastSelectRecordId===t.getId()?(s.lastSelectRecordId=null,s.setClickSelection(null)):(null!==s.lastSelectRecordId&&(r=n.getById(s.lastSelectRecordId)),s.lastSelectRecordId=t.getId(),s.setClickSelection(t)),r&&r.set("_rowclassclick",!r.get("_rowclassclick")),t.set("_rowclassclick",!t.get("_rowclassclick")),!0))},deSelect:function(){this._clearClickSelection()},_clearClickSelection:function(){var e=this,t=e.grid,i=t.getStore();try{if(t.lastSelectRecordId){if(i&&!i.isEmptyStore){var l=i.getById(t.lastSelectRecordId);if(l){var c=t.getView().getRow(l);c&&Ext.get(c).removeCls("x-grid-record-click")}}t.lastSelectRecordId=null}}catch(o){}t.setClickSelection&&t.setClickSelection(null)}});
Ext.define("Fm.ux.grid.plugin.SubTable",{extend:"Ext.grid.plugin.RowExpander",alias:"plugin.subtable",rowBodyTpl:['<div class="x-grid-subtable-con">',"{%","this.owner.renderTable(out, values);","%}","<div>"],autoExpandFirstRow:!0,autoExpandAllRow:!1,pageSize:10,sumColumns:[],sumFormat:"",init:function(e){var t,n,a,r,o=this,i=o.columns;if(o.callParent(arguments),t=e.getView(),o.autoExpandFirstRow&&!o.autoExpandAllRow&&(t.ownerCt.on("expandfirstrow",o.onExpandFirstRow,o),t.on("refresh",function(){t.ownerCt.fireEvent("expandfirstrow",e)},t.ownerCt)),o.autoExpandAllRow&&(t.ownerCt.on("expandalltrow",o.onExpandAllRow,o),t.on("refresh",function(){t.ownerCt.fireEvent("expandalltrow",e)},t.ownerCt)),t.on({expandbody:function(e,t,n){o.swallowEvent(e.id),t._isrendersubpage||(t._isrendersubpage=!0,o.rendPageByRecord(e.id,t,o))}}),e.on("beforeitemdblclick",function(e,t,n,a,r){return Ext.get(r.target).up(".x-grid-subtable-con")?(r.stopEvent(),!1):void 0}),o.columns=[],i)for(a=0,n=i.length;n>a;++a)r=Ext.apply({preventRegister:!0},i[a]),r.xtype=r.xtype||"gridcolumn",o.columns.push(Ext.widget(r))},onExpandFirstRow:function(e){var t,n=this,a=e.view,r=a.getRow(0);r&&setTimeout(function(){if(Ext.get(r))try{t=e.getStore().getAt(0),n.expandRow(0,t)}catch(a){}},150)},onExpandAllRow:function(e){var t,n,a=this,r=e.view,o=e.getStore();setTimeout(function(){for(var i=0;i<o.data.length;i++)if(t=r.getRow(i),Ext.get(t))try{n=e.getStore().getAt(i),a.expandRow(i,n)}catch(s){}},150)},expandRow:function(e,t){var n=this,a=n.view,r=a.getNode(e),o=Ext.fly(r),i=o.hasCls(n.rowCollapsedCls);i&&n.toggleRow(e,t)},destroy:function(){var e,t,n=this.columns;if(n)for(t=0,e=n.length;e>t;++t)n[t].destroy();this.columns=null,this.callParent()},getRowBodyFeatureData:function(e,t,n){this.callParent(arguments),n.rowBodyCls+=" "+Ext.baseCSSPrefix+"grid-subtable-row"},getTableHtml:function(e,t){var n,a,r,o,i,s=this,l=s.columns,u=l.length,d=s.getAssociatedRecords(e),g=d.length,c=[],p=s.pageSize,t=t||1,h=p*(t-1),m=p*t;for(m>g&&(m=g),c.push("<tr>"),o=0;u>o;o++)a=l[o],c.push('<th style="white-space: nowrap;"><div'+(null!=a.width?' style="display:block;width:'+a.width+'px"':"")+">",l[o].text,"</div></th>");c.push("</tr>");for(var r=h;m>r;r++){for(n=d[r],c.push("<tr>"),o=0;u>o;o++)a=l[o],i=n[a.dataIndex],a.renderer&&a.renderer.call&&(i=a.renderer.call(a.scope||s,i,{},n)),c.push(a.autoExpand?'<td class="sub_table_inner_cell x-text-nowrap" ':'<td class="sub_table_inner_cell x-text-break" '),a.align&&c.push(' style="text-align:'+a.align+';"'),c.push(">",i,"</td>");c.push("</tr>")}return c.join("")},swallowEvent:function(e){var t=Ext.get(e);if(t&&t.el){t.el.swallowEvent(["mousedown","mousemove","mouseup","contextmenu","mouseover","mouseout"],!1),rowBody=t.down("tr.x-grid-subtable-row"),rowBody&&rowBody.el&&rowBody.el.swallowEvent(["click","mousedown","mousemove","mouseup","dblclick","contextmenu","mouseover","mouseout"],!1);{new Clipboard(t.el.dom.querySelectorAll(".sub_table_inner_cell"),{text:function(e){return Ext.String.trim(e.innerText||e.textContent||"")}})}}},rendPageByRecord:function(e,t,n){var a=n||this,r=a.getAssociatedRecords(t);if(a.swallowEvent(e),r.length/a.pageSize<=1)return!0;var o=new fei.pageBar({nowPage:t._subtablepagenum||1,totalSize:r.length,pageSize:a.pageSize,callback:function(r){t._subtablepagenum=r,a.pageRenderTable(e,t,n),a.rendPageByRecord(e,t,n)}});o.render("subPage_"+e+t.getId())},pageRenderTable:function(e,t,n){var a=this,r=e+t.getId(),o=a.getTableHtml(t,t._subtablepagenum||1);document.getElementById("subPage_table_"+r).innerHTML=o},renderTable:function(e,t){var n,a=this,r=a.getAssociatedRecords(t.record),o=t.rowId+t.record.getId();if(n=a.getTableHtml(t.record,1),e.push('<table class="x-grid-subtable" id="subPage_table_'+o+'" cellpadding="2" cellspacing="0">'),e.push(n),a.sumColumns&&a.sumColumns.length>0){for(var i=a.getSums(t),s=a.sumFormat,l=0;l<a.sumColumns.length;l++){var u=i[a.sumColumns[l]],d=Ext.Array.filter(a.columns,function(e){return e.dataIndex===a.sumColumns[l]})[0];d&&d.renderer&&(u=d.renderer(u)),s=s.replace("{"+a.sumColumns[l]+"}",u)}e.push('<tr><td colspan="'+a.columns.length+'">'+s+"</td></tr>")}e.push("</table>"),r.length/a.pageSize>1&&e.push('<div class="page" id="subPage_'+o+'"></div>')},getSums:function(e){for(var t,n=this,a=n.getAssociatedRecords(e.record),r={},o=0;o<n.sumColumns.length;o++)r[n.sumColumns[o]]=0;for(var o=0;o<a.length;o++){t=a[o];for(var i=0;i<n.sumColumns.length;i++)r[n.sumColumns[i]]+=parseInt(t[n.sumColumns[i]],10)||0}return r},getRowBodyContentsFn:function(e){var t=this;return function(n){return e.owner=t,e.applyTemplate(n)}},getAssociatedRecords:function(e){return e.get(this.association)},getExportColumns:function(){var e=this,t=e.columns,n=Ext.Array.filter(t,function(e){return!e.isCheckerHd&&!e.ignoreExport});return n},exportAlign:{left:"Left",right:"Right",center:"Center"},getExportData:function(e){var t,n,a,r,o=this,i=o.getExportColumns(),s=i.length,l=[],u=[],d=/<.*>(.*)<\/.*>|<.*\/>/;Ext.Array.each(i,function(e){if(!e.isCheckerHd&&!e.ignoreExport){var t=e.exportWidth||e.width;try{t=e.getWidth()}catch(n){}l.push({TitleName:e.text,TitleValue:e.exportIndex||e.dataIndex,TitleWide:Math.ceil(t/7.5),IsRMB:!!e.exportIsRMB,IsCount:!!e.exportIsCount,CellType:o.exportAlign[e.align]})}});for(var g=0;g<e.length;g++){t=e[g],n={};for(var c=0;s>c;c++){if(a=i[c],r=t.get(a.dataIndex),a.exportRender?r=a.exportRender(r,null,t):a.renderer&&(r=a.renderer(r,null,t)),(null===r||void 0===r)&&(r=""),r=r.toString(),r&&(_v=r.replace(/￥/g,""),_v)){r=_v;var p=r.match(d);p&&(r=p[1])}n[a.exportIndex||a.dataIndex]=r.trim()}u.push(n)}return{titles:l,rows:u}}}),fei={},fei.pageBar=function(e){this.nowPage=1,this.totalSize=100,this.pageSize=10,this.pageNumBarLength=2,this.isSyncPageSize=!0,this.callback=function(e){alert(e)};for(var t in e)this[t]=e[t]},fei.pageBar.prototype.render=function(e){this.container=document.getElementById(e),this.container.innerHTML="",this.nowPage=parseInt(this.nowPage,10),this.totalSize=parseInt(this.totalSize,10),this.pageSize=parseInt(this.pageSize,10),this.pageNumBarLength=parseInt(this.pageNumBarLength,10),this.totalPage=Math.ceil(this.totalSize/this.pageSize)<1?1:Math.ceil(this.totalSize/this.pageSize),this.nowPage<1&&(this.nowPage=1),this.isSyncPageSize&&this._appendSyncPageSize(),this._appendPageNumBar()},fei.pageBar.prototype._appendSyncPageSize=function(){var e=this,t=document.createElement("label");t.innerHTML="每页 "+e.pageSize+" 条&nbsp;共 "+e.totalSize+" 条&nbsp;&nbsp;",e.container.appendChild(t)},fei.pageBar.prototype._appendPageNumBar=function(){var e=this.nowPage-this.pageNumBarLength;if(2>e&&(e=2),this._getPageNumText(1,"1",!0),e>2){var t=document.createElement("label");t.innerHTML="...",this.container.appendChild(t)}for(e;e<this.nowPage;e++)this._getPageNumText(e,e,!0);var n=this.nowPage+this.pageNumBarLength;n>this.totalPage-1&&(n=this.totalPage-1);var a=this.nowPage;for(2>a&&(a=2),a;n>=a;a++)this._getPageNumText(a,a,!0);if(n<this.totalPage-1){var t=document.createElement("label");t.innerHTML="...",this.container.appendChild(t)}this.totalPage>1&&this._getPageNumText(this.totalPage,this.totalPage,!0)},fei.pageBar.prototype._getPageNumText=function(e,t,n){var a=this;if(e==a.nowPage){var r=document.createElement("span");r.innerHTML=t,a.container.appendChild(r)}else{var o=document.createElement("a");o.href="javascript:void(0)";var i=function(){a.callback.call(window,e)};o.addEventListener?o.addEventListener("click",i,!1):o.attachEvent?o.attachEvent("onclick",i):o.onclick=i,o.innerHTML=t,this.container.appendChild(o)}};
Ext.define("Fm.ux.CheckField",{extend:"Ext.container.Container",alias:"widget.checkfield",items:[],viewModel:{data:{Checked:!1}},layout:{type:"hbox",align:"right"},initComponent:function(){var e=this;Ext.apply(e,{items:[{xtype:"checkbox",labelAlign:"right",fieldLabel:e.fieldLabel,colspan:1,width:205,labelWidth:180,bind:{value:"{Checked}"}},{xtype:"textfield",margin:"0 60 0 0",colspan:1,width:150,value:e.value,bind:{disabled:"{!Checked}"}}]}),e.callParent()}});
Ext.define("Fm.ux.CisPagingToolBar",{extend:"Ext.toolbar.Paging",xtype:"cispagingtoolbar",alternateClassName:"Fm.ux.CisPagingToolBar",cls:"cis-pagingtoolbar-panel",padding:0,displayInfo:!0,displayMsg:"显示{0}-{1}&nbsp;共{2}条",emptyMsg:"没有数据",beforePageText:"第",afterPageText:"页&nbsp;共{0}页",firstText:"首页",prevText:"上一页",nextText:"下一页",lastText:"最后一页",refreshText:"刷新",pageSizes:"10,50,100,500,1000,3000",getPagingItems:function(){var e=this,t={scope:e,blur:e.onPagingBlur};t[Ext.supports.SpecialKeyDownRepeat?"keydown":"keypress"]=e.onPagingKeyDown;for(var a=e.pageSizes.split(","),i=[],r=0;r<a.length;r++)a[r]&&(i[i.length]={text:a[r].toString(),value:a[r]});var s=Ext.create("Ext.data.Store",{fields:["text","value"],data:i});return["每页",{itemId:"pageSizes",xtype:"combo",store:s,queryMode:"local",displayField:"text",valueField:"value",width:65,editable:!1,showClearTriggers:!1,value:e.store.getPageSize(),listeners:{change:function(t,a){e.store.setPageSize(a),e._notFireChange||e.moveFirst()}}},"条","-",{itemId:"first",tooltip:e.firstText,overflowText:e.firstText,iconCls:Ext.baseCSSPrefix+"tbar-page-first",disabled:!0,handler:e.moveFirst,scope:e},{itemId:"prev",tooltip:e.prevText,overflowText:e.prevText,iconCls:Ext.baseCSSPrefix+"tbar-page-prev",disabled:!0,handler:e.movePrevious,scope:e},"-",e.beforePageText,{xtype:"numberfield",itemId:"inputItem",name:"inputItem",cls:Ext.baseCSSPrefix+"tbar-page-number",allowDecimals:!1,minValue:1,hideTrigger:!0,enableKeyEvents:!0,keyNavEnabled:!1,selectOnFocus:!0,submitValue:!1,isFormField:!1,width:e.inputItemWidth,margin:"-1 2 3 2",listeners:t},{xtype:"tbtext",itemId:"afterTextItem",text:Ext.String.format(e.afterPageText,1)},"-",{itemId:"next",tooltip:e.nextText,overflowText:e.nextText,iconCls:Ext.baseCSSPrefix+"tbar-page-next",disabled:!0,handler:e.moveNext,scope:e},{itemId:"last",tooltip:e.lastText,overflowText:e.lastText,iconCls:Ext.baseCSSPrefix+"tbar-page-last",disabled:!0,handler:e.moveLast,scope:e},"-",{itemId:"refresh",tooltip:e.refreshText,overflowText:e.refreshText,iconCls:Ext.baseCSSPrefix+"tbar-loading",disabled:e.store.isLoading(),handler:e.doRefresh,scope:e}]},initComponent:function(){var e=this;e.store.on({beforeUpdatePageInfo:{fn:e.beforeUpdatePageInfo,scope:e},updatePageInfo:{fn:e.updatePageInfo,scope:e}}),e.callParent()},beforeUpdatePageInfo:function(){var e=this;e.mask("正在更新分页信息...")},updatePageInfo:function(){var e=this;e.unmask(),e.updateBarInfo()},onLoad:function(){var e,t,a,i,r,s,o,n=this;if(r=n.store.getCount(),s=0===r)t=0,a=0,i=Ext.String.format(n.afterPageText,0);else{if(e=n.getPageData(),t=e.currentPage,a=e.pageCount,t>a)return;i=Ext.String.format(n.afterPageText,isNaN(a)?1:a)}Ext.suspendLayouts(),o=n.child("#afterTextItem"),o&&o.setText(i),o=n.getInputItem(),o&&o.setDisabled(s).setValue(t),o=n.child("#pageSizes"),o&&(n._notFireChange=!0,o.setValue(n.store.getPageSize()),n._notFireChange=!1),n.setChildDisabled("#first",1===t||s),n.setChildDisabled("#prev",1===t||s),n.setChildDisabled("#next",t===a||s),n.setChildDisabled("#last",t===a||s),n.setChildDisabled("#refresh",!1),n.setChildDisabled("#go",s),n.updateInfo(),Ext.resumeLayouts(!0),n.calledInternal||n.fireEvent("change",n,e||n.emptyPageData)},onPagingBlur:function(e){var t,a=this,i=this.getInputItem(),r=a.getPageData();i&&(t=a.readPageFromInput(r),t!==!1&&(t=Math.min(Math.max(1,t),r.pageCount),t!==r.currentPage&&a.fireEvent("beforechange",a,t)!==!1&&a.store.loadPage(t)))}});
Ext.define("Fm.ux.DateRange",{extend:"Ext.form.FieldContainer",alias:"widget.daterange",requires:["Ext.form.field.Date"],fieldLabel:"日期范围",width:330,labelWidth:60,layout:"column",labelAlign:"right",defaults:{width:120,labelWidth:60,xtype:"datefield",labelAlign:"right"},addTnterval:Ext.Date.MONTH,addValue:1,addModel:["s-e"],disableLD:!1,isValidateMoreThen:!0,initComponent:function(){var e,t,a=this,i=(new Date).getTime();if(Ext.apply(a.items[0],{width:95,itemId:"startdt"+i,endDateField:"enddt"+i,vtype:"daterange",validateOnChange:!1,isRequirsResetMaxMinValue:!0}),Ext.apply(a.items[1],{width:100,itemId:"enddt"+i,vtype:"daterange",fieldLabel:"-",errorfieldLabel:"结束日期",labelWidth:5,labelSeparator:"",labelAlign:"right",style:{marginLeft:"3px;"},isRequirsResetMaxMinValue:!0}),a.callParent(),e=a.items.items[0],t=a.items.items[1],Ext.Array.contains(a.addModel,"s-e")){var d=function(e){if(!a.disableLD){var i=e.getValue();if(i&&Ext.isDate(i)){var d=Ext.Date.add(i,a.addTnterval,a.addValue);a.addTnterval===Ext.Date.MONTH?(t.setValue(Ext.Date.add(d,Ext.Date.DAY,-1)),t.fireEvent("updatebind",Ext.Date.add(d,Ext.Date.DAY,-1))):(t.setValue(d),t.fireEvent("updatebind",d))}}};setTimeout(function(){e.on("blur",d),e.on("select",d)},500)}if(Ext.Array.contains(a.addModel,"e-s")){var d=function(t){if(!a.disableLD){var i=t.getValue();if(i&&Ext.isDate(i)){var d=Ext.Date.add(i,a.addTnterval,-1*a.addValue);e.setValue(d),e.fireEvent("updatebind",d)}}};setTimeout(function(){t.on("blur",d),t.on("select",d)},500)}},checkDate:function(e){return e instanceof Date?!0:e?new Date(e).getDate()==e.toString().substring(e.length-2):!1},autoFormat:function(e,t){var a;if(dateRange=e.up("daterange"),t){var i=dateRange.checkDate(t);if(i)10===e.rawValue.length&&e.fireEvent("blur",e);else{switch(dateString=t.toString().replace(/-/g,""),dateString.length){case 5:a=dateString.substr(0,4)+"-"+dateString.substr(4,1);break;case 6:a=dateString.substr(0,4)+"-"+dateString.substr(4,2);break;case 7:var a=dateString.substr(0,4)+"-"+dateString.substr(4,2)+"-"+dateString.substr(6,1);break;case 8:a=dateString.substr(0,4)+"-"+dateString.substr(4,2)+"-"+dateString.substr(6,2),e.fireEvent("blur",e);break;default:return}e.setRawValue(a)}}}});
Ext.define("Fm.ux.IFrame",{extend:"Ext.Component",alias:"widget.uxiframe",loadMask:Fm.Config.maskHtml,src:"about:blank",renderTpl:['<iframe src="{src}" id="{id}-iframeEl" data-ref="iframeEl" name="{frameName}" width="100%" height="100%" frameborder="0"></iframe>'],childEls:["iframeEl"],initComponent:function(){var e=this;e.callParent(),e.frameName=e.frameName||e.id+"-frame"},onRender:function(){var e=this;e.callParent(),e.htmlContent&&e.setHtmlContent(e.htmlContent),e.onKeyDown(e.getDoc())},setHtmlContent:function(e){var t=this,n=t.getDoc();if(n){n.open(),n.write(e),n.close();var r=n.createElement("link");r.rel="stylesheet",r.type="text/css",r.href=(AppConfig.UrlStartWith||"")+"FmContent/lib/ueditor/themes/ueditor.iframe.css",n.getElementsByTagName("head")[0].appendChild(r)}t.onKeyDown(n)},onKeyDown:function(e){var t=this;e.onkeydown||(e.onkeydown=function(e){if(27===e.keyCode){var n=t.up("window");n.close()}})},initEvents:function(){var e=this;e.callParent(),e.iframeEl.on("load",e.onLoad,e)},initRenderData:function(){return Ext.apply(this.callParent(),{src:this.src,frameName:this.frameName})},getBody:function(){var e=this.getDoc();return e.body||e.documentElement},getDoc:function(){try{return this.getWin().document}catch(e){return null}},getWin:function(){var e=this,t=e.frameName,n=Ext.isIE?e.iframeEl.dom.contentWindow:window.frames[t];return n},getFrame:function(){var e=this;return e.iframeEl.dom},beforeDestroy:function(){this.cleanupListeners(!0),this.callParent()},cleanupListeners:function(e){var t,n;if(this.rendered)try{if(t=this.getDoc(),t&&(Ext.get(t).un(this._docListeners),e))for(n in t)t.hasOwnProperty&&t.hasOwnProperty(n)&&delete t[n]}catch(r){}},onLoad:function(){var e=this,t=e.getDoc(),n=e.onRelayedEvent;if(t){try{Ext.get(t).on(e._docListeners={mousedown:n,mousemove:n,mouseup:n,click:n,dblclick:n,scope:e})}catch(r){}Ext.get(this.getWin()).on("beforeunload",e.cleanupListeners,e),this.el.unmask(),this.fireEvent("load",this)}else e.src&&(this.el.unmask(),this.fireEvent("error",this))},onRelayedEvent:function(e){var t=this.iframeEl,n=t.getTrueXY(),r=e.getXY(),i=e.getTrueXY();e.xy=[n[0]+i[0],n[1]+i[1]],e.injectEvent(t),e.xy=r},load:function(e){var t=this,n=t.loadMask,r=t.getFrame();t.fireEvent("beforeload",t,e)!==!1&&(n&&t.el&&t.el.mask(n),r.src=t.src=e||t.src)}});
Ext.define("Fm.ux.ImageView",{extend:"Ext.panel.Panel",requires:["Fm.ux.IFrame"],alias:"widget.imageview",layout:{type:"vbox",align:"stretch"},imageIndex:0,imageList:[],layout:"fit",loadingMsg:"加载中...",initComponent:function(){var e=this;e.items=[{xtype:"uxiframe",src:AppConfig.urlStartWith+"FmContent/lib/feiimageview/viewpanel.html?v=1&imageList="+encodeURIComponent(Ext.JSON.encode(e.imageList))+"&index="+e.imageIndex,listeners:{load:function(i){e.image=i.getWin()._fImagePanel.image},error:function(){}}}],e.callParent()},getImage:function(){return this.image}});
Ext.define("Fm.ux.MindMap",{extend:"Ext.container.Container",alias:["widget.mindmap"],twoWayBindable:["jmData"],defaultBindProperty:"jmData",publishes:["jmDataChange"],config:{jmData:[]},jmOptions:{},onRender:function(){var t=this;t.callParent(),t.toolTip=Ext.create("Ext.menu.Menu",{items:[{xtype:"container",minWidth:100,minHeight:50,padding:5,style:{color:"#555"},html:"tooltip"}]}),t.showJm()},showJm:function(){var t,e,n=this,a=n.getId()+"-innerCt";if(n.jmData&&!(n.jmData.length<1)){t={meta:{name:n.getId(),author:"mjl",version:"1.0"},format:"node_array",data:n.jmData},e=Ext.apply({editable:!1,theme:"greensea",container:a,support_html:!0,default_event_handle:{enable_mousedown_handle:!0,enable_click_handle:!0,enable_dblclick_handle:!1},view:{line_color:["#ff0000","#00ff08","#0014ff","#ffa500","#683489","#136987","#456852"]}},n.jmOptions);var o=n.jm=new jsMind(e);o.show(t);var i=n.getEl(),d=i.query("jmnode");i.on("contextmenu",function(t){t.stopEvent()});for(var m=0;m<d.length;m++){var l=Ext.get(d[m]);l.on("contextmenu",function(t){n.fireEvent("contextMenu",n.jm.get_selected_node(),t)}),l.on("click",function(t){n.fireEvent("nodeClick",n.jm.get_selected_node(),t)}),l.on("mouseover",function(t,e){var a=n.jm.view.get_binded_nodeid(e),o=n.jm.get_node(a);o.data.toolTip?(n.toolTip.down("container").setConfig({html:o.data.toolTip}),n.toolTip.showAt(t.getPoint())):n.toolTip.down("container").setConfig({html:""})}),l.on("mouseout",function(t,e){n.toolTip.hide()})}}},setJmData:function(t){var e=this;e.jmData=t,e.rendered&&e.showJm()},getJmData:function(){var t=this,e=t.jm.get_data("node_array");return t.jmData=e.data,t.jmData}});
Ext.define("Fm.ux.MultiSelect",{extend:"Ext.form.FieldContainer",mixins:["Ext.util.StoreHolder","Ext.form.field.Field"],alternateClassName:"Ext.ux.Multiselect",alias:["widget.multiselectfield","widget.multiselect"],requires:["Ext.panel.Panel","Ext.view.BoundList","Ext.layout.container.Fit","Ext.data.StoreManager"],uses:["Ext.view.DragZone","Ext.view.DropZone"],layout:"anchor",publishes:["value","selection","validators","store"],twoWayBindable:["value","selection","store"],defaultBindProperty:"value",config:{validationField:null,validation:null,selection:null},selectionMode:"item",ddReorder:!1,appendOnly:!1,displayField:"text",allowBlank:!0,minSelections:0,maxSelections:Number.MAX_VALUE,blankText:"为必选项",minSelectionsText:"至少需要选择 {0} 项",maxSelectionsText:"最多选择 {0} 项",delimiter:",",dragText:"{0} Item{1}",ignoreSelectChange:0,multiSelect:!0,initComponent:function(){var e=this;e.items=e.setupItems(),e.bindStore(e.store||e.getBind().store.getValue(),!0),e.store.autoCreated&&(e.valueField=e.displayField="field1",e.store.expanded||(e.displayField="field2")),Ext.isDefined(e.valueField)||(e.valueField=e.displayField),e.callParent(),e.initField()},setupItems:function(){var e=this;e.selectionModel=new Ext.selection.DataViewModel({mode:e.multiSelect?"SIMPLE":"SINGLE",allowDeselect:!1});var t=function(e){return'<div class="x-boundlist-item-cis-item"><i class="x-boundlist-item-cis-checker"></i><span <tpl if="_rowclass">class="{_rowclass}"</tpl>>{'+e+"}</span></div>"},i=null;return"checkbox"===e.selectionMode?(i='<tpl for="."><li role="option" unselectable="on" class="x-boundlist-item-cis">'+t(e.displayField)+"</li></tpl>",e.listConfig||(e.listConfig={}),e.listConfig.itemCls="x-boundlist-item-cis-item"):i='<tpl for="."><li role="option" unselectable="on" class="'+Ext.baseCSSPrefix+'boundlist-item  <tpl if="_rowclass">{_rowclass}</tpl>">{'+e.displayField+"}</li></tpl>",e.boundList=Ext.create("Ext.view.BoundList",Ext.apply({anchor:"none 100%",border:1,selectionModel:e.selectionModel,store:e.store,displayField:e.displayField,disabled:e.disabled,tpl:i,onContainerClick:function(e){return!1}},e.listConfig)),e.boundList.getSelectionModel().on("selectionchange",e.onSelectChange,e),e.boundList.pickerField=e,e.title?(e.boundList.border=!1,{border:!0,anchor:"none 100%",layout:"anchor",title:e.title,tbar:e.tbar,items:e.boundList}):e.boundList},onSelectChange:function(e,t){this.ignoreSelectChange||this.setValue(t)},getSelected:function(){return this.boundList.getSelectionModel().getSelection()},isEqual:function(e,t){var i,l=Ext.Array.from,n=0;if(e=l(e),t=l(t),i=e.length,i!==t.length)return!1;for(;i>n;n++)if(t[n]!==e[n])return!1;return!0},afterRender:function(){var e,t=this;t.callParent(),t.selectOnRender&&(e=t.getRecordsForValue(t.value),e.length&&(++t.ignoreSelectChange,t.boundList.getSelectionModel().select(e),--t.ignoreSelectChange),delete t.toSelect),!t.ddReorder||t.dragGroup||t.dropGroup||(t.dragGroup=t.dropGroup="MultiselectDD-"+Ext.id()),(t.draggable||t.dragGroup)&&(t.dragZone=Ext.create("Ext.view.DragZone",{view:t.boundList,ddGroup:t.dragGroup,dragText:t.dragText})),(t.droppable||t.dropGroup)&&(t.dropZone=Ext.create("Ext.view.DropZone",{view:t.boundList,ddGroup:t.dropGroup,handleNodeDrop:function(e,i,l){var n,r=this.view,o=r.getStore(),a=e.records;e.view.store.remove(a),n=o.indexOf(i),"after"===l&&n++,o.insert(n,a),r.getSelectionModel().select(a),t.fireEvent("drop",t,a)}}))},isValid:function(){var e=this,t=e.disabled,i=e.forceValidation||!t;return i?e.validateValue(e.value):t},validateValue:function(e){var t=this,i=t.getErrors(e),l=Ext.isEmpty(i);return t.preventMark||(l?t.clearInvalid():t.markInvalid(i),t.boundList[l?"removeCls":"addCls"](["x-form-trigger-wrap-default","x-form-trigger-wrap-invalid"])),l},markInvalid:function(e){var t=this,i=t.getActiveError();t.setActiveErrors(Ext.Array.from(e)),i!==t.getActiveError()&&t.updateLayout()},clearInvalid:function(){var e=this,t=e.hasActiveError();e.unsetActiveError(),t&&e.updateLayout()},getSubmitData:function(){var e,t=this,i=null;return t.disabled||!t.submitValue||t.isFileUpload()||(e=t.getSubmitValue(),null!==e&&(i={},i[t.getName()]=e)),i},getSubmitValue:function(){var e=this,t=e.delimiter,i=e.getValue();return Ext.isString(t)?i.join(t):i},getValue:function(){return this.value||[]},getRecordsForValue:function(e){var t,i,l,n=this,r=[],o=n.store.getRange(),a=n.valueField,s=0,d=o.length;for(l=e.length;l>s;++s)for(i=0;d>i;++i)t=o[i],t.get(a)==e[s]&&r.push(t);return r},setupValue:function(e){var t,i,l,n=this.delimiter,r=this.valueField,o=0;if(Ext.isDefined(e)){for(n&&Ext.isString(e)?e=e.split(n):Ext.isArray(e)||(e=[e]),i=e.length;i>o;++o)l=e[o],l&&l.isModel&&(e[o]=l.get(r));t=Ext.Array.unique(e)}else t=[];return t},setValue:function(e){var t=this,i=t.boundList.getSelectionModel(),l=t.store;return l.getCount()?(e=t.setupValue(e),t.mixins.field.setValue.call(t,e),void(t.rendered?(++t.ignoreSelectChange,i.deselectAll(),e.length&&i.select(t.getRecordsForValue(e),!1,!0),--t.ignoreSelectChange):t.selectOnRender=!0)):void l.on({load:Ext.Function.bind(t.setValue,t,[e]),single:!0})},clearValue:function(){this.setValue([])},onEnable:function(){var e=this.boundList;this.callParent(),e&&e.enable()},onDisable:function(){var e=this.boundList;this.callParent(),e&&e.disable()},getErrors:function(e){var t,i=this,l=Ext.String.format,n=[];return e=Ext.Array.from(e||i.getValue()),t=e.length,!i.allowBlank&&1>t&&n.push(i.blankText),t<i.minSelections&&n.push(l(i.minSelectionsText,i.minSelections)),t>i.maxSelections&&n.push(l(i.maxSelectionsText,i.maxSelections)),n},onDestroy:function(){var e=this;e.bindStore(null),Ext.destroy(e.dragZone,e.dropZone),e.callParent()},onBindStore:function(e){var t=this.boundList;t&&t.bindStore(e)}});
Ext.define("Fm.ux.TabCloseMenu",{extend:"Ext.plugin.Abstract",alias:"plugin.tabclosemenu",mixins:{observable:"Ext.util.Observable"},closeTabText:"Close Tab",showCloseOthers:!0,closeOthersTabsText:"Close Other Tabs",showCloseAll:!0,closeAllTabsText:"Close All Tabs",extraItemsHead:null,extraItemsTail:null,constructor:function(e){this.callParent([e]),this.mixins.observable.constructor.call(this,e)},init:function(e){this.tabPanel=e,this.tabBar=e.down("tabbar"),this.mon(this.tabPanel,{scope:this,afterlayout:this.onAfterLayout,single:!0})},onAfterLayout:function(){this.mon(this.tabBar.el,{scope:this,contextmenu:this.onContextMenu,delegate:".x-tab"})},destroy:function(){this.callParent(),Ext.destroy(this.menu)},onContextMenu:function(e,t){var s=this,o=s.createMenu(),l=!0,n=!0,a=s.tabBar.getChildByElement(t),i=s.tabBar.items.indexOf(a);s.item=s.tabPanel.getComponent(i),o.child("#close").setDisabled(!s.item.closable),(s.showCloseAll||s.showCloseOthers)&&(s.tabPanel.items.each(function(e){return e.closable&&(l=!1,e!==s.item)?(n=!1,!1):!0}),s.showCloseAll&&o.child("#closeAll").setDisabled(l),s.showCloseOthers&&o.child("#closeOthers").setDisabled(n)),e.preventDefault(),s.fireEvent("beforemenu",o,s.item,s),o.showAt(e.getXY())},createMenu:function(){var e=this;if(!e.menu){var t=[{itemId:"close",text:e.closeTabText,scope:e,handler:e.onClose}];(e.showCloseAll||e.showCloseOthers)&&t.push("-"),e.showCloseOthers&&t.push({itemId:"closeOthers",text:e.closeOthersTabsText,scope:e,handler:e.onCloseOthers}),e.showCloseAll&&t.push({itemId:"closeAll",text:e.closeAllTabsText,scope:e,handler:e.onCloseAll}),e.extraItemsHead&&(t=e.extraItemsHead.concat(t)),e.extraItemsTail&&(t=t.concat(e.extraItemsTail)),e.menu=Ext.create("Ext.menu.Menu",{items:t,listeners:{hide:e.onHideMenu,scope:e}})}return e.menu},onHideMenu:function(){var e=this;e.fireEvent("aftermenu",e.menu,e)},onClose:function(){this.tabPanel.remove(this.item)},onCloseOthers:function(){this.doClose(!0)},onCloseAll:function(){this.doClose(!1)},doClose:function(e){var t=[];this.tabPanel.items.each(function(s){s.closable&&(e&&s===this.item||t.push(s))},this),Ext.suspendLayouts(),Ext.Array.forEach(t,function(e){this.tabPanel.remove(e)},this),Ext.resumeLayouts(!0)}});
Ext.define("Fm.base.Grid",{extend:"Ext.grid.Panel",alias:"widget.cisgrid",requires:["Fm.ux.CisPagingToolBar"],isPage:!0,pageSizes:null,loadMask:!1,multiColumnSort:!0,initComponent:function(){var t,e,s,a=this;if(a.isPage)try{try{s=a.store||a.getBind().store.getValue()}catch(i){}(!s||s.isEmptyStore)&&a.config.bind&&a.config.bind.store&&(e=Ext.String.trim(a.config.bind.store).replace("{","").replace("}",""),t=a.getViewModel(),s=t.getStore(e)),a.buttons&&a.buttons.length>0?(Ext.apply(this,{dockedItems:{xtype:"panel",dock:"bottom",items:[new Fm.ux.CisPagingToolBar({displayInfo:!0,displayMsg:"显示{0}-{1}&nbsp;共{2}条",store:s,pageSizes:a.pageSizes||"10,50,100,500,1000,3000"})],buttons:a.buttons}}),a.buttons=void 0):Ext.apply(this,{bbar:new Fm.ux.CisPagingToolBar({displayInfo:!0,displayMsg:"显示{0}-{1}&nbsp;共{2}条",store:s,pageSizes:a.pageSizes||"10,50,100,500,1000,3000"})})}catch(i){Ext.log.error(i.stack)}a.viewConfig=Ext.apply({loadMask:a.loadMask,getRowClass:function(t,e,s,a){var i="";return t.data._isDisabled&&(i="x-grid-disabled "),(t._rowclass||t.data._rowclass)&&(i+=t._rowclass||t.data._rowclass),i?i:void 0}},a.viewConfig),a.callParent(arguments)}});
Ext.define("Fm.base.GridController",{extend:"Ext.app.ViewController",alias:"controller.cisgrid",operationView:"",autoLoad:!1,init:function(){var e=this,t=e.getView().xtype,r={};r[t]={afterrender:e.selfRender},r[t+" cispagingtoolbar"]={beforechange:e.beforePageChange},e.control(r,e),e.callParent(arguments),e.initSelfEvents()},getGridStore:function(){var e,t,r=this;return r.__gridStore||(e=this.getView(),t=e.getStore(),t.isEmptyStore&&(t=e.getBind().store.getValue()),r.__gridStore=t),r.__gridStore},initSelfEvents:function(){var e=this,t=e.getGridStore();e.dataChanged&&t.on("datachanged",e.dataChanged,e),e.dataLoaded&&t.on("load",e.dataLoaded,e)},selfRender:function(){var e=this,t=e.getGridStore();e.autoLoad&&!t.autoLoad&&e.refresh()},doFilter:function(e){var t,r,a=this,i=a.getView(),n=a.getGridStore(),l=Ext.clone(e.filterConfig),o=e.id+"_filter";if(i.filterArray||(i.filterArray={}),r=i.filterArray,n.clearFilter(!1),!(n.getDataSource().items.length<0)){t=a.getFilter(l,e.getValue()),r[o]=t;var s=[];for(var u in r)r[u]&&s.push(r[u]);var f;s.length>0&&(f=n.filter(s)),e.filterCallBack&&e.filterCallBack.call(e,a.getView(),n)}},filter:function(e){var t=this;t.doFilter(e)},isFilter:function(e,t,r){var a=!1;if(r&&"list"===r)t&&(Ext.isArray(t)||(t=t.split(",")),t.length>0&&(a=!0));else switch(e){case"string":t=(t||"").toString(),t&&(a=!0);break;case"date":t&&(t=Date.parse(t),t&&(a=!0));break;case"number":t=parseFloat(t),isNaN(t)||(a=!0);break;case"int":t=parseInt(t,10),isNaN(t)||(a=!0)}return a},getFilterValue:function(e,t){switch(e){case"string":t=0===t?"0":(t||"").toString();break;case"date":t=Date.parse(t);break;case"number":t=parseFloat(t);break;case"int":t=parseInt(t,10)}return t},getFilterListValue:function(e,t){var r=this;if(t){Ext.isArray(t)||(t=t.split(","));for(var a=[],i=0;i<t.length;i++)"int"===e||"number"===e?(t||0===t)&&a.push(r.getFilterValue(e,t[i])):t&&a.push(r.getFilterValue(e,t[i]));if(a.length>0)return a}return null},getFilter:function(e,t){var r,a=this;if(e.type&&"filter"===e.type)return e.filter._cmpValue=t,e.filter;Ext.isArray(e)||(e=[e]);var i=Ext.Array.filter(e,function(e){return a.isFilter(e.type,t,e.valueType)});if(i.length>1){for(var n=[],l=!1,o=0;o<i.length;o++)if("list"===i[o].valueType){var s=a.getFilterListValue(i[o].type,t);l=s.length>1,1===s.length&&(s=s[0],delete i[o].valueType),n.push(s)}else n.push(a.getFilterValue(i[o].type,t));r=l?{filterFn:function(e){for(var t=0;t<i.length;t++)if("list"===i[t].valueType){if(Ext.Array.findBy(n[t],function(r){return Fm.Common.Util.comp(i[t].operator,a.getFilterValue(i[t].type,e.data[i[t].property]),r)}))return!0}else if(Fm.Common.Util.comp(i[t].operator,a.getFilterValue(i[t].type,e.data[i[t].property]),n[t]))return!0;return!1}}:{filterFn:function(e){for(var t=0;t<i.length;t++)if(Fm.Common.Util.comp(i[t].operator,a.getFilterValue(i[t].type,e.data[i[t].property]),n[t]))return!0;return!1}}}else if(1===i.length){var u=i[0],l=!1;if("list"===u.valueType){var s=a.getFilterListValue(u.type,t);l=s.length>1,1===s.length&&(s=s[0],delete u.valueType),t=s}else t=a.getFilterValue(u.type,t);r=l?{filterFn:function(e){return Ext.Array.findBy(t,function(t){return Fm.Common.Util.comp(u.operator,a.getFilterValue(u.type,e.data[u.property]),t)})?!0:void 0}}:{filterFn:function(e){return Fm.Common.Util.comp(u.operator,a.getFilterValue(u.type,e.data[u.property]),t)}}}return r},getRefreshParams:function(){return{}},beforePageChange:function(){var e=this;return e.getGridStore().isRequiresPage=!1,e.addParams()},addParams:function(){var e=this.getRefreshParams();return e!==!1?(this.getGridStore().outParams=e,!0):!1},refresh:function(){this.getGridStore().isRequiresPage=!0,this.refreshByParams()},refreshByParams:function(e){var t=this,r=t.addParams();r!==!1&&setTimeout(function(){t.getGridStore().loadPage(1,e)},10)}});
Ext.define("Fm.base.MainController",{extend:"Ext.app.ViewController",requires:["Ext.window.MessageBox"],mainRender:function(){var e=this;Ext.History.init(),Ext.History.on("change",function(t){var i=t;i||(i=0),e.openNewTab(i)});var t=Ext.History.getToken();if(t&&"0"!==t.toString()||(t=AppConfig.defaultMenuId),t)var i=setInterval(function(){application&&(clearInterval(i),e.openNewTab(t))},30)},deSelectMenuById:function(e){var t=this,i=t.getView().down("treelist");e&&i.getItem(e).updateSelected(!1)},selectMenuById:function(e){var t,i=this,n=i.getView().down("treelist"),a=n.getStore();t=a.getAt(a.findBy(function(t){return t.get("Id")==e})),t&&(n.getItem(t).updateSelected(!0),i.lastSelectedRecord=t)},tabChange:function(e,t){var i,n=this,a=n.getView();if(null!==t.menuId&&void 0!==t.menuId){var r=t.menuId;Ext.History.add(r);try{var i=a.down("container[msgarea=msgarea]");i.removeAll(!0),t.msgItems&&i.add(t.msgItems)}catch(s){}return!1}},toggleMenu:function(e){var t=this,i=t.getView().down("treelist"),n=i.ownerCt;void 0===t.pressed&&(t.pressed=AppConfig.Design.Menu.Pressed),Ext.suspendLayouts(),i.setMicro(!t.pressed),t.pressed?(n.setWidth(AppConfig.Design.Menu.MaxWidth),e.setIconCls("fa fa-angle-left")):(n.setWidth(AppConfig.Design.Menu.MinWidth),e.setIconCls("fa fa-angle-right")),Cookie.set(AppConfig.cookieStartWith+"main-left-panel-micro",!t.pressed,365),t.pressed=!t.pressed,Ext.isIE8&&this.repaintList(i,!t.pressed),Ext.GlobalEvents.fireEvent("resize"),Ext.resumeLayouts(!0)},mainResize:function(){return Ext.util.CSS.removeStyleSheet("x-treelist-item-floated-height"),Ext.util.CSS.createStyleSheet(".x-treelist-nav .x-treelist-item-floated .x-treelist-container{max-height:"+(this.getView().getHeight()-36)+"px;overflow-y:auto;}","x-treelist-item-floated-height"),!0},openNewTab:function(e,t){var i,n,a=this,r=a.getView(),s=r.down(a.xtypeStartWith+"-maintab"),o=r.down(a.xtypeStartWith+"-mainleft").down("treelist"),l=o.getStore();if(a.deSelectMenuById(a.lastSelectedRecord),"0"===e.toString())return s.setActiveTab(Ext.getCmp("main_tab_0")),!1;if(i=Ext.Array.findBy(Fm.Server.Menus,function(t){return t.Id.toString()===e.toString()}),!i)return!1;0!==i.ParentId&&(n=l.getAt(l.findBy(function(e){return e.get("Id")==i.ParentId})),n&&o.getItem(n).expand()),a.selectMenuById(e);var c="main_tab_"+i.Id,d=Ext.getCmp(c);try{d?(s.setActiveTab(d),t&&d[t.event]&&d[t.event].call(d,t.params)):(application.globalMask.show(),setTimeout(function(){try{d=Ext.create(i.MenuView,{id:c,menuId:e,closable:!0,iconCls:i.iconCls,closeAction:"destroy",autoDestroy:!0,title:i.Name,cls:"cis-panel-default",frame:!1,border:!1,maskParam:(i.ViewParams||{}).maskParam,viewParams:i.ViewParams,listeners:{afterrender:function(e){application.globalMask.hide(),t&&d[t.event]&&d[t.event].call(d,t.params)}}})}catch(n){Ext.log.error(n.stack)}d&&(s.add(d),s.setActiveTab(d))},10))}catch(g){Ext.log.error(g.stack)}},repaintList:function(e,t){e.getStore().getRoot().cascadeBy(function(i){var n,a;n=e.getItem(i),n&&n.isTreeListItem&&(t?(a=n.getToolElement(),a&&a.isVisible(!0)&&a.syncRepaint()):n.element.isVisible(!0)&&(n.iconElement.syncRepaint(),n.expanderElement.syncRepaint()))})},addTabForTest:function(e){var t=this,i=t.getView(),n=i.down(t.xtypeStartWith+"-maintab"),a="main_tab_"+e,r=Ext.getCmp(a);try{r?n.setActiveTab(r):(application.globalMask.show(),setTimeout(function(){try{r=Ext.create(e,{id:a,closable:!0,closeAction:"destroy",autoDestroy:!0,title:e,cls:"cis-panel-default",frame:!1,border:!1})}catch(t){Ext.log.error(t.stack)}r&&(n.add(r),n.setActiveTab(r))},10),application.globalMask.hide())}catch(s){Ext.log.error(s.stack)}}});
Ext.define("Fm.base.Model",{extend:"Ext.data.Model"});
Ext.define("Fm.base.SearchForm",{extend:"Ext.form.Panel",alias:"widget.base_searchform",requires:["Ext.plugin.Responsive"],modelValidation:!0,bodyCls:"cis-searh-panel",plugins:"responsive",configKey:"",searchHandler:"refresh",allItems:null,initComponent:function(){var e,t=this,n=!!t.record,i={1:{width:800,formula:"w800"},2:{width:1e3,formula:"w1000"},3:{width:1200,formula:"w1200"}},a={};if(n)e=t.record,Ext.apply(t,{allItems:e.items,width:i[e.resolution.toString()],height:AppConfig.Design.SearchPanel.Height[e.row.toString()]+1,selfConfig:e});else{var r=t.configs=t.configs||appFactory.Config.getFormItems(t.configKey);t.allItems=r[0].items,Ext.Array.each(r,function(t){e=t;var n=i[e.resolution.toString()];a[n.formula]={height:AppConfig.Design.SearchPanel.Height[e.row.toString()],selfConfig:e}},t),e=r[window.screen.width>1400?2:window.screen.width>1200?1:0],t.responsiveConfig=a}t.items=[{xtype:"container",selfType:"itemsContainer",layout:{type:"table",columns:e.col,itemCls:"x_seachform_item"},padding:AppConfig.Design.SearchPanel.Padding,defaults:{margin:AppConfig.Design.SearchPanel.Items.Margin,width:AppConfig.Design.SearchPanel.Items.Width,labelAlign:"right",labelWidth:AppConfig.Design.SearchPanel.Items.LabelWidth},items:t.allItems}],t.dockedItems=[{dock:"right",xtype:"toolbar",layout:{type:"hbox",align:"middle"},seltype:"searchbar",width:120,padding:"5 0 0 0",style:{zIndex:0},cls:"cis-searh-panel",items:[{xtype:"container",width:130,items:[{margin:"0 0 0 5",width:70,xtype:"button",text:"检索",listeners:{click:t.searchHandler},disabled:n,optype:"search"},{width:22,margin:"0 0 0 5",xtype:"button",iconCls:"fa fa-arrow-down cis-searchform-expand-btn",style:{backgroundColor:"#368ecc"},handler:function(){var e,t=this,i=t.up("base_searchform"),a=i.record?{row:i.record.row}:i.getSelfConfig(),r=i.down("container[selfType=itemsContainer]").getLayout(),o=AppConfig.Design.SearchPanel.Height[a.row.toString()]+(n?1:0),s=r.table.getHeight()+5;o>s&&(o=s),e=i.getHeight()!==o,Ext.suspendLayouts(),i.setHeight(e?o:s),t.setIconCls(e?"fa fa-arrow-down cis-searchform-expand-btn":"fa fa-arrow-up cis-searchform-expand-btn"),Ext.resumeLayouts(!0)}}]}]}],Ext.Array.each(t.allItems,function(e){e.labelPad=0;var t=function(e){e.listeners||(e.listeners={}),e.listeners.specialkey=function(e,t){if(t.getKey()==t.ENTER){e.up("base_searchform").down("button[optype=search]").fireEvent("click")}},e.labelPad=0};e.items&&e.items.length>0?Ext.Array.each(e.items,function(e){e.margin=0,t(e)}):t(e)}),!n&&!AppConfig.Design.FixedResolution&&t.on("resize",function(){var e=this,t=e.down("container[selfType=itemsContainer]"),n=t.getLayout(),i=e.getWidth(),a=e.getSelfConfig(),r=0,o=(a.row,0);Ext.suspendLayouts(),n.setColumns(a.col),e.allItems=a.items,Ext.Array.each(Ext.Array.filter(t.items.items,function(e){return"container"===e.xtype}),function(e){t.remove(e)});var s=!1;Ext.Array.each(e.allItems,function(e,n){t.insert(n,Ext.Array.findBy(t.items.items,function(t){return e.configIndex===t.configIndex})||e);var i=e.colspan||1;(r+1)%a.col===0&&(s=s||i>1,i=1),r+=i},e),o=Math.ceil(r/a.col);var l=e.down("toolbar[seltype=searchbar]"),c=l.down("container").items.items[1],g=i-(a.col+(s?1:0))*(AppConfig.Design.SearchPanel.Items.Width+3);l.setWidth(130>g?130:g),130>g&&l.setLocalX(i-130),c.setConfig("hidden",a.row>=o),e.updateLayout(),Ext.resumeLayouts(!0)},t),t.callParent(arguments)}});
Ext.define("Fm.base.SearchForm",{extend:"Ext.form.Panel",alias:"widget.base_searchform",modelValidation:!0,bodyCls:"cis-searh-panel",configKey:"",searchHandler:"refresh",heights:{1:36,2:66,3:96,4:126,5:156,6:186,7:216,8:246,9:276,10:306},widths:{1:800,2:1e3,3:1200},layout:{type:"hbox",pack:"start",align:"stretch"},initComponent:function(){var t=this,e=!!t.record,o=Ext.getCmp("ViewPortCoreTab"),i=o.getWidth(),n=i>1200?2:i>1e3?1:0,a=1e3>i?800:1200>i?1e3:1200;if(t._layouting=!0,t.record)t._setLayoutConfig(t.record),t.layoutConfig=t.record;else if(t.configKey){t.layoutConfigs=appFactory.Config.getFormItems(t.configKey);for(var s=0;s<t.layoutConfigs.length;s++)t._setLayoutConfig(t.layoutConfigs[s]);t.layoutConfig=t.layoutConfigs[n]}e&&(t.width=t.widths[t.layoutConfig.resolution.toString()],a=t.width<1e3?800:t.width<1200?1e3:1200),t.height=t.heights[t.layoutConfig.row.toString()]+(e?1:0),t.items=[{xtype:"panel",selfType:"itemsContainer",layout:{type:"table",columns:t.layoutConfig.col,itemCls:"x_seachform_item"},width:a,padding:3,defaults:{margin:"3 0",width:186,labelAlign:"right",labelWidth:66},items:t.layoutConfig.items,dockedItems:[{dock:"right",xtype:"toolbar",layout:{type:"hbox",align:"middle"},width:130,padding:"5 0 0 0",style:{zIndex:0},cls:"cis-searh-panel",items:[{margin:"0 0 0 5",width:70,xtype:"button",text:"检索",listeners:{click:t.searchHandler},disabled:e,optype:"search"},{width:22,margin:"0 0 0 5",xtype:"button",hidden:!t.layoutConfig.isShowToggleBtn,iconCls:"fa fa-arrow-down cis-searchform-expand-btn",optype:"toggle",style:{backgroundColor:"#368ecc"},listeners:{click:t._toggleHeight,scope:t}}]}]},{xtype:"container",flex:1}],t.callParent(arguments),e||AppConfig.Design.FixedResolution||(t.on("resize",t._updateLayout,t),t.on("afterlayout",function(){t._layouting=!1},t))},_toggleHeight:function(){var t=this,e=!!t.record;e||AppConfig.Design.FixedResolution||t.un("resize",t._updateLayout,t);var o,i=t.layoutConfig,n=t.down("panel[selfType=itemsContainer]").getLayout(),a=t.heights[i.row.toString()]+(e?1:0),s=n.table.getHeight()+5;a>s&&(a=s),o=t.getHeight()!==a,Ext.suspendLayouts(),t.setHeight(o?a:s),t.down("button[optype=toggle]").setIconCls(o?"fa fa-arrow-down cis-searchform-expand-btn":"fa fa-arrow-up cis-searchform-expand-btn"),Ext.resumeLayouts(!0),e||AppConfig.Design.FixedResolution||t.on("resize",t._updateLayout,t)},_updateLayout:function(){if(!this._layouting&&this.configKey){this._layouting=!0;var t=this,e=t.down("panel[selfType=itemsContainer]"),o=e.getLayout(),i=!!t.record,n=t.getWidth(),a=n>1200?2:n>1e3?1:0;t.layoutConfig=t.layoutConfigs[a],Ext.suspendLayouts(),o.setColumns(t.layoutConfig.col),Ext.Array.each(Ext.Array.filter(e.items.items,function(t){return"container"===t.xtype}),function(t){e.remove(t)});var s=0,r=!1;Ext.Array.each(t.layoutConfig.items,function(o,i){e.insert(i,Ext.Array.findBy(e.items.items,function(t){return o.configIndex===t.configIndex})||o);var n=o.colspan||1;(s+1)%t.layoutConfig.col===0&&(r=r||n>1,n=1),s+=n}),e.setWidth(1e3>n?800:1200>n?1e3:1200),t.setHeight(t.heights[t.layoutConfig.row.toString()]+(i?1:0));var l=t.down("button[optype=toggle]");l.setHidden(!t.layoutConfig.isShowToggleBtn),Ext.resumeLayouts(!0)}},_setLayoutConfig:function(t){var e=0;Ext.Array.each(t.items,function(o,i){var n=o.colspan||1;(e+1)%t.col===0&&(n=1),e+=n}),t.maxRow=Math.ceil(e/t.col),t.isShowToggleBtn=t.maxRow>t.row,Ext.Array.each(t.items,function(t){t.labelPad=0;var e=function(t){t.listeners||(t.listeners={}),t.listeners.specialkey=function(t,e){if(e.getKey()==e.ENTER){t.up("base_searchform").down("button[optype=search]").fireEvent("click")}},t.labelPad=0};t.items&&t.items.length>0?Ext.Array.each(t.items,function(t){t.margin=0,e(t)}):e(t)})}});
Ext.define("Fm.base.Store",{extend:"Ext.data.Store",outParams:{},pageSize:Fm.Server.Config.PageRowCount||10,autoLoad:!1,isRequiresPage:!0,latestTotalCount:0,proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},reader:{type:"json",rootProperty:"Result",successProperty:"IsSuccess",messageProperty:"ErrMsg",totalProperty:"TotalCount"},limitParam:"PageSize",pageParam:"PageNum",startParam:"StartIndex",timeout:AppConfig.ajaxTimeOut},listeners:{beforeload:function(t,a,e){var o=this;if(o.lastTotalCount=t.totalCount,o.isRequiresPage)o.outParams.TotalCount=0;else try{o.outParams.TotalCount=t.totalCount||0}catch(r){}Ext.apply(t.proxy.extraParams,o.outParams),setTimeout(function(){var a=t.getProxy();if(a){var e=a.api.readTotalCount;e&&(o.isRequiresPage?(t.fireEvent("beforeUpdatePageInfo"),Ext.Ajax.request({url:e,method:"post",callback:function(a,e,r){if(e){var s=Ext.JSON.decode(r.responseText);t.totalCount=s.Result,t.latestTotalCount=s.Result,o.updateTotalCount(),t.fireEvent("updatePageInfo")}},params:t.proxy.extraParams})):t.totalCount=o.lastTotalCount)}},1e3)},load:function(t){var a=this,e=t.getProxy().api.readTotalCount;e&&a.updateTotalCount()}},clearAll:function(t){this.outParams={},this.proxy.extraParams={},this.removeAll(t||!1)},updateTotalCount:function(){var t=this;t.totalCount=t.latestTotalCount}});
Ext.ns("Fm").msg={show:function(n,r){setTimeout(function(){Ext.toast({title:r,html:n,closable:!0,align:"br",frame:!1,slideInDuration:300,minHeight:80,width:400,minWidth:400})},50)},info:function(n,r){Fm.msg.show("<span>"+(n||"")+"</span>",r||"提示")},notify:function(n,r){Fm.msg.show("<span>"+(n||"")+"</span>",r||"通知")},warn:function(n,r){Fm.msg.show('<span style="color:rgb(246, 252, 5)">'+(n||"")+"</span>",r||"警告")},error:function(n,r){n&&Fm.msg.show('<span style="color:#ff0000">'+(n||"")+"</span>",r||"错误")}},Ext.ns("Fm").Array={eachSync:function(n,r,t,e){var o=n.length,a=e||200,i=0,f=Math.ceil(o/a),s=!1;if(1>o)return void(t&&t());if(a>=o){for(var u=0;o>u;u++){var c=r(n[u],u);if(c===!1)break}return void(t&&t())}var h=function(t){for(var e=t*a,i=t===f-1?o:e+a,u=e;i>u;u++){var c=r(n[u],u);if(s||c===!1){s=!0;break}}},l=function(n){return function(){h(n),i++}};if(Ext&&Ext.Deferred){for(var v=[],u=0;f>u;u++)v.push(l(u));Ext.Deferred.parallel(v).then(t||function(){})}else{for(var u=0;f>u;u++)setTimeout(l(u),5*u);var m=setInterval(function(){i===f&&0!=i&&(clearInterval(m),t&&t())},50)}},group:function(n,r){var t={};return Ext.Array.forEach(n,function(n){t[n[r]]?t[n[r]].push(n):t[n[r]]=[n]}),t},tier:function(n,r,t,e,o,a,i){var f=function(e){for(var s=[],u=0;u<n.length;u++){var c=n.shift();e[r]===c[t]?(s.push(c),u--):n.push(c)}for(var u=0;u<s.length;u++)f(s[u]),i&&i(s[u])===!1&&(s=Ext.Array.removeAt(s,u),u--);a&&(e.checked=e[a]),s.length>0?e.children=s:o&&(e.leaf=!0)};return f(e),e}};
Ext.ns("Fm.Common").Core={};

function fmDataFactory(t){this.nsStartWith=t.nsStartWith}function fmUiFactory(t){this.nsStartWith=t.nsStartWith}function fmCommonFactory(t){return{Data:new fmDataFactory({nsStartWith:(t.appName||AppConfig.appName)+".Server.Datas"}),Config:new fmUiFactory({nsStartWith:(t.appName||AppConfig.appName)+".Config"})}}fmDataFactory.prototype.getDatas=function(t,r){return Ext.ns(this.nsStartWith)[t]},fmDataFactory.prototype.getDataStore=function(t,r,e){var n=this,o=n.getDatas(t);o||(Ext.log.error("[fmDataFactory-getDataStore]"+n.nsStartWith+": "+t+" 不存在。"),o=[]);var a=[];r&&(a=e||[{Value:-1,Text:"全部"}]),a=Ext.Array.push(a,Ext.Array.filter(o,function(t){return t.IsAlloted===!0}));var i=Ext.create("Ext.data.Store",{fields:["Value","Text"],data:a});return i},fmDataFactory.prototype.getAllDataStore=function(t,r,e){var n=this,o=n.getDatas(t);o||(Ext.log.error("[fmDataFactory-getAllDataStore]"+n.nsStartWith+": "+t+" 不存在。"),o=[]);var a=[];r&&(a=e||[{Value:-1,Text:"全部"}]),a=Ext.Array.push(a,o);var i=Ext.create("Ext.data.Store",{fields:["Value","Text"],data:a});return i},fmDataFactory.prototype.judgePrivilege=function(t){return null!=Ext.Array.findBy(this.getDatas("Privileges"),function(r){return r.Value===t&&r.IsAlloted})},fmUiFactory.prototype.getAllItems=function(t){var r=this,e=Ext.ns(t);return"function"!=typeof e&&(e=Ext.ns(t)),"function"!=typeof e&&(e=Ext.ns(r.nsStartWith+"."+t)),"function"==typeof e?(e=e(),1===AppConfig.isDev&&"string"!=typeof e&&Ext.Array.forEach(e,function(r){Ext.Array.filter(e,function(t){return r.configIndex==t.configIndex}).length>1&&Fm.msg.error(t+"配置信息出现异常！出现重复configIndex，值为："+r.configIndex)}),e):(Fm.msg.error("配置信息出现异常！请检查拼写"),[])},fmUiFactory.prototype.getConfigs=function(t){var r=Ext.ns("Fm.ViewConfig");if(r[t])return r[t]();var e=t;return this.nsStartWith&&(e=this.nsStartWith+"."+t),r[e]?r[e]():null},fmUiFactory.prototype.getShowItems=function(t){return this.getGridItems(t)},fmUiFactory.prototype.getGridItems=function(t){var r=this,e=r.getAllItems(t),n=r.getConfigs(t),o=[];if(n)for(var a=0;a<n.length;a++){var i=Ext.Array.findBy(e,function(t,r){return t.configIndex==n[a].index});i&&(r.handlerGridConfig(i,n[a]),o.push(i))}else Ext.Array.forEach(e,function(t){t.configHidden||o.push(t)});return o},fmUiFactory.prototype.getFormItems=function(t){var r=this,e=r.getAllItems(t),n=r.getConfigs(t),o=[],a=[];return n?Ext.Array.forEach(n,function(t){var r={resolution:t.resolution,col:t.col,row:t.row,items:[]};Ext.Array.forEach(t.items,function(t){var n=Ext.Array.findBy(e,function(r){return r.configIndex==t.index});n||(n={xtype:"container",colspan:t.colspan,configIndex:t.index,height:25,width:180*t.colspan}),r.items.push(n)}),a.push(r)}):(Ext.Array.forEach(e,function(t){t.configHidden||o.push(t)}),a=[{resolution:1,col:3,row:Math.ceil(o.length/3)>3?3:Math.ceil(o.length/3),items:o},{resolution:2,col:4,row:o.length>4?2:1,items:o},{resolution:3,col:5,row:o.length>5?2:1,items:o}]),a},fmUiFactory.prototype.handlerGridConfig=function(t,r){if(r.width&&(t.width=r.width,t.flex=void 0),r.exportIsCount&&(t.exportIsCount=r.exportIsCount),r.datatype)switch(r.datatype){case"Money":t.renderer=Fm.Common.Util.moneyRender("f00"),t.align="right";break;case"Date":t.renderer=Fm.Common.Util.dateRender("Y-m-d h:i")}};var appFactory=fmCommonFactory({appName:null});
Ext.ns("Fm.Common").Util={dateRender:function(r,t){var r=r||"Y-m-d";return function(e){var n;if(!e)return"";if(Ext.isDate(e))n=e;else{var o=e.split(/[T\-\\\/:\s\.]/i),n=new Date(o[0]||1700,parseInt(o[1]||1,10)-1,o[2]||1,o[3]||0,o[4]||0,o[5]||0);if(!Ext.isDate(n))return""}var a=Ext.Date.format(n,r);return t?"<span style='color:#"+t+"'>"+a+"</span>":a}},dateTextRender:function(){return Fm.Common.Util.dateRender("Y-m-d H:i:s")},dateTransfer:function(r,t){var t=t||"Y/m/d",e=Fm.Common.Util.convertISOStrToDate(r);return new Date(Ext.Date.format(e,t))},linkRender:function(r){return r?"<a href='"+r+"' target='_blank'>"+r+"</a>":""},booleanRender:function(r,t,e){return r&&"0"!==r?"是":"否"},colorRender:function(r){return function(t){return t?"<span style='color:#"+r+"'>"+t+"</span>":""}},convertISOStrToDate:function(r){return r?new Date(r.replace(/-/g,"/").replace(/T|Z/g," ").trim()):""},moneyRender:function(r,t){for(var e=t||parseInt(Fm.Server.Config.MoneyAccuracy,10)||2,n="0.",o=0;e>o;o++)n+="0";return r?function(t){return t=Ext.util.Format.round(t,e),"<span style='color:#"+r+"'>￥"+Ext.util.Format.number(t,n)+"</span>"}:function(r){return r=Ext.util.Format.round(r,e),"￥"+Ext.util.Format.number(r,n)}},moneyForAllowNullRender:function(r,t){for(var e=t||parseInt(Fm.Server.Config.MoneyAccuracy,10)||2,n="0.",o=0;e>o;o++)n+="0";return r?function(t){return null===t||void 0===t||0===t?"":(t=Ext.util.Format.round(t,e),"<span style='color:#"+r+"'>￥"+Ext.util.Format.number(t,n)+"</span>")}:function(r){return null===r||void 0===r||0===r?"":(r=Ext.util.Format.round(r,e),"￥"+Ext.util.Format.number(r,n))}},percentRender:function(){for(var r=parseInt(Fm.Server.Config.MoneyAccuracy,10)||2,t="0.",e=0;r>e;e++)t+="0";return function(r){return r=100*r,Ext.util.Format.number(r,t)+"%"}},dataTextRender:function(r){return function(t){if(void 0!==t&&null!==t&&""!==t){var e=Ext.Array.findBy(r,function(r,e){return r.Value==t});if(e)return e.Text}return""}},columnPanelBuild:function(r){var t={xtype:"container",layout:"column",defaults:{xtype:"textfield",margin:"5 0 0 0",labelAlign:"right",labelWidth:80,columnWidth:.5},items:r};return t},comp:function(r,t,e){switch(r){case">":return t>e;case">=":return t>=e;case"<":return e>t;case"=":case"===":return t===e;case"==":return t==e;case"<=":return e>=t;case"like":return t&&t.toLowerCase().indexOf(e.toLowerCase())>-1;case"ClikeL":return e&&e.toLowerCase().indexOf(t.toLowerCase())>-1;case"!empty":return!(!t||!t.toLowerCase());default:return!0}},containString:function(r,t){for(var e=0,n=0;e<r.length;e++)if(r[e]===t[n]){if(n++,n===t.length)return!0}else n=0;return!1},getFormErrorMsg:function(r){return errors=Ext.Array.findBy(r.getForm().monitor.items.items,function(r,t,e){return r.wasValid===!1}),errors?(errors.errorfieldLabel||errors.fieldLabel||"输入错误")+":"+errors.activeErrors.join(","):null},Guid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxx xxxxxx".replace(/[xy]/g,function(r){var t=16*Math.random()|0,e="x"===r?t:3&t|8;return e.toString(16)})},downLoadFile:function(r){var t=Ext.apply({method:"post"},r),e="down-file-form-kdkjgjkdagjfkdgh",n=Ext.fly(e);n||(n=Ext.getBody().createChild({tag:"form",id:e,name:e,method:"POST",style:"display:none"})),Ext.Ajax.request({url:t.url,form:n,isUpload:!0,params:t.data})},getNowDate:function(){var r=Date.parse(Fm.Server.Config.NowDate.replace(/-/g,"/")),t=Fm.Config.clientDate.getTime(),e=(new Date).getTime();return new Date(e+(r-t))},getNowDateStr:function(r){var r=r||"Y-m-d H:i:s";return Fm.Common.Util.dateRender(r)(Fm.Common.Util.getNowDate())},numberRender:function(r){for(var t=parseInt(Fm.Server.Config.NumberAccuracy,10)||0,e="0.",n=0;t>n;n++)e+="0";return r?function(t){return"<span style='color:#"+r+"'>"+Ext.util.Format.number(t,e)+"</span>"}:function(r){return Ext.util.Format.number(r,e)}},getTips:function(){return function(r,t,e){return null!==t&&(t.tdAttr='data-qtip="'+r+'"'),r}}},fmUtil=Ext.ns("Fm.Common").Util;
Ext.ns("FmApp.Common").Core={Shared:{getMenuData:function(){var e=Fm.Server.Menus,r=function(t,a){for(var n=Ext.Array.filter(e,function(e,r){return e.ParentId===t&&"_"!==e.Name}),i=0;i<n.length;i++){var u=n[i];a||(u.iconCls=u.Icon&&""!=Ext.String.trim(u.Icon)?u.Icon:"fa fa-chevron-right"),u.ViewParams&&"string"==typeof u.ViewParams&&(u.ViewParams=Ext.JSON.decode(u.ViewParams)),u.text=u.Name;var o=r(u.Id,!0);o.length>0?u.children=o:u.leaf=!0}return n};return r(0)},getForData:function(e){var r=function(e,t){if(e){for(var a=[],n=0;n<e.length;n++){if(!Ext.isArray(e[n].Value)){for(var i=[],u=0;u<e.length;u++)i[u]={GroupRuleBit:t+"|"+e[u].RuleBit,RuleBit:e[u].RuleBit,value:e[u].RuleBit,text:e[u].Name,Id:e[u].Id,leaf:!0,checked:!1};return i}a[n]={text:e[n].Text,leaf:!1,checked:!1,children:r(e[n].Value,e[n].Text)}}return a}};return r(e)}}};
var fmAppFactory=fmCommonFactory({appName:"FmApp"}),appFactory=fmCommonFactory({appName:null});
Ext.ns("FmApp.Common").Service={Sys:{isPermission:function(n){return null!=Ext.Array.findBy(fmAppFactory.Data.getDatas("Privileges"),function(t){return t.Value===n&&t.IsAlloted})}}};