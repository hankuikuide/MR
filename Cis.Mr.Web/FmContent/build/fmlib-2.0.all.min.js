Ext.Loader.setPath({FmApp:AppConfig.urlStartWith+"FmApp",Ext:AppConfig.urlStartWith+"FmContent/lib/extjs621/src","Ext.ux":AppConfig.urlStartWith+"FmContent/lib/extjs621/ux","Ext.exporter":AppConfig.urlStartWith+"FmContent/lib/extjs621/ux/exporter","Ext.draw.ContainerBase":AppConfig.urlStartWith+"FmContent/lib/extjs621/build/charts.js"}),Ext.Ajax.setTimeout(AppConfig.ajaxTimeOut),Ext.setGlyphFontFamily("FontAwesome"),Ext.EventManager.on(window,"keydown",function(t,e){t.getKey()!=t.BACKSPACE||/^input|textarea$/i.test(e.tagName)&&!e.disabled&&!e.readOnly||t.stopEvent()}),AppConfig.isDev||(Ext.log.warn=function(){},Ext.Error.ignore=!0,window.onerror=function(t,e,n,i,o){return!0},Ext.Loader.setConfig({disableCaching:!1}));
Ext.define("Fm.override.Component",{override:"Ext.Component",resetAll:function(){var e=this,r=e.query("form"),t=e.query("grid,dataview");try{var i=[];e.isForm&&!e.isIgnoreReset&&(e.reset(!0),e.fireEvent&&e.fireEvent("resetallvalue",e),i=e.query("datefield")),Ext.Array.each(r,function(e){e.isIgnoreReset||(e.reset(!0),e.fireEvent&&e.fireEvent("resetallvalue",e),i=Ext.Array.merge(i,e.query("datefield")))}),Ext.Array.each(i,function(e){e.isRequirsResetMaxMinValue&&(e.setMinValue(0),e.setMaxValue(0))}),Ext.Array.each(t,function(e){var r=e.getStore();r&&!r.isEmptyStore&&r.clearAll&&!r.isIgnoreReset&&(r.clearAll(),r.clearFilter())})}catch(a){}},isFirstSetBindValue:function(e){var r,t,i=this;if(r=i.getBind(),t=r&&r.value,t&&t.syncing){if(Ext.isEmpty(e)&&Ext.isEmpty(i.value)||e===i.value)return!0;if(Ext.isArray(e)&&Ext.isArray(i.value)&&Ext.Array.equals(e,i.value))return!0}return!1}});
Ext.define("Fm.override.container.Container",{override:"Ext.container.Container",getExportData:function(e,t){var n=this,i=2*(n.layout.columns||0),r=[],e=e||1,t=t||0,o=0,l=0,g=1,h=document.createElement("div");return Ext.Array.forEach(n.items.items,function(n){if(!n.hidden){l>=i&&(l=0,o++),r.push({CellValue:n.fieldLabel,RowNumber:e+o,CellNumber:t+l,CellCount:1,CellType:"Right"}),l+=1,g=2*(n.colspan||1)-1;var u=n.renderer?n.renderer(n.value):n.value;h.innerHTML=u,u=h.innerText||h.textContent,r.push({CellValue:u||"",RowNumber:e+o,CellNumber:t+l,CellCount:g}),l+=g}}),{Cells:r,EndRow:e+o,EndCol:t+l}},foldPanel:function(e){var t=this,n=t,i=(n.down("[region=north]"),n.down("[region=center]")),r=(n.down("[region=east]"),n.down("[region=south]"));if(0!==r.getHeight()&&0!==i.getHeight()&&(t._southHeight=r.getHeight()),"c"===e)r.setHeight(0===r.getHeight()?t._southHeight:0);else if("s"===e){var o=n.getHeight();r.setHeight(r.getHeight()===o?t._southHeight:o)}}});
Ext.define("Fm.override.data.Connection",function(){var r=Ext.data.Connection.prototype.request;return Ext.data.Connection.prototype.request=void 0,{override:"Ext.data.Connection",request:function(e){e=e||{};var s=this,t=e.scope||window,o=e.callback;e.callback=void 0,e.url=(AppConfig.urlStartWith+e.url).replace("//","/");var a=function(){application.loginOut()},n=window._fmapp_now_mask_view+"",c={NetWorkErrorMsg:"网络错误，请检查您的网络。",ServerErrorMsg:"服务器异常，请联系管理人员。",LoadErrorMsg:"加载出错"},i=function(r,e,s){var i=s.responseJson={ErrCode:null,ErrMsg:null,IsSuccess:!0};if(s.status>=400&&s.status<500||0==s.status)i.ErrMsg=c.NetWorkErrorMsg;else if(s.status>=500)i.ErrMsg=c.ServerErrorMsg;else if(s.responseText){var l=s.responseText.match(/("ErrCode[\s\S]*ErrMsg[\s\S]*),"AttachedObject"/);if(l&&l.length){var u="{"+l[1]+"}";i=Ext.JSON.decode(u)}}else e&&(i.ErrMsg=c.loadErrorMsg);if(i.IsSuccess=!i.ErrMsg,!i.IsSuccess){"1002"===i.ErrCode?Ext.Msg.alert("登录过期",i.ErrMsg,function(){a()}):Fm.msg.error(i.ErrMsg);try{application.hideMask(n)}catch(E){}}o&&o.call(t,r,i.IsSuccess,s)};e.callback=i,e.error||(e.error=function(){application.hideMask(n)}),r.call(s,e)}}}());
Ext.define("Fm.override.data.field.Date",{override:"Ext.data.field.Date",convert:function(e){return e&&Ext.isString(e)?new Date([e.replace(/-/g,"/").replace(/T|Z/g," ")]):this.callParent(arguments)}});
Ext.define("Fm.override.data.validator.Presence",{override:"Ext.data.validator.Presence",config:{message:"必填"},validate:function(e){var t=!(void 0===e||null===e||""===e.toString().trim());return t&&!this.getAllowEmpty()&&(t=!(""===e)),t?!0:this.getMessage()}});
Ext.define("Fm.override.dd.DragSource",{override:"Ext.dd.DragSource",onInvalidDrop:function(t,e,i){this.hideProxy(),delete this.cachedTarget}}),Ext.define("Fm.override.dd.DD",{override:"Ext.dd.DD",configGetFly:function(t){return t.id?t:t[0]},alignElWithMouse:function(t,e,i){var h,d,a,o,r=this.getTargetCoord(e,i),t=this.configGetFly(t),n=t.dom?t:Ext.fly(t,"_dd"),c=n.getSize(),g=Ext.Element;return this.deltaSetXY?(h=this.cachedViewportSize,this.setLocalXY(n,Math.max(0,Math.min(r.x+this.deltaSetXY[0],h.width-c.width)),Math.max(0,Math.min(r.y+this.deltaSetXY[1],h.height-c.height)))):(h=this.cachedViewportSize={width:g.getDocumentWidth(),height:g.getDocumentHeight()},d=[Math.max(0,Math.min(r.x,h.width-c.width)),Math.max(0,Math.min(r.y,h.height-c.height))],n.setXY(d),a=this.getLocalX(n),o=n.getLocalY(),this.deltaSetXY=[a-r.x,o-r.y]),this.cachePosition(r.x,r.y),this.autoScroll(r.x,r.y,t.offsetHeight,t.offsetWidth),r}});
Ext.define("Fm.override.form.CheckboxGroup",{override:"Ext.form.CheckboxGroup",twoWayBindable:["value"],defaultBindProperty:"value",valuePublishEvent:"updatebindvalue",getValue:function(){for(var e,t,u=[],a=this.getBoxes(),n=0;n<a.length;n++)e=a[n],t=e.inputValue,e.getValue()&&u.push(t);return u},checkChange:function(e,t){this.fireEvent("updatebindvalue")},setValue:function(e){if(null!==e&&void 0!==e&&Ext.isArray(e)){var t,u,a,n=this,r=n.getBoxes(),i=(n.values,r.length);return n.batchChanges(function(){for(Ext.suspendLayouts(),t=0;i>t;t++)u=r[t],a=!1,e&&(a=Ext.isArray(e)?Ext.Array.contains(e,u.inputValue):e),u.setValue(a);Ext.resumeLayouts(!0)}),n}}});
Ext.define("Fm.override.form.field.Base",{override:"Ext.form.field.Base",validateValue:function(e){var a=this,r=a.getErrors(e),i=Ext.isEmpty(r);return a.preventMark||(i?a.clearInvalid():(a.bind&&a.bind.value&&a.bind.value.setValue&&a.bind.value.setValue(a.getValue()),a.markInvalid(r))),i}});
Ext.define("Fm.override.form.field.ComboBox",{override:"Ext.form.field.ComboBox",editable:!1,showClearTriggers:!0,emptyText:"全部",singleIsArray:!1,applyTriggers:function(e){var r=this,l=e.picker,i={};l&&!l.cls&&(l.cls=r.triggerCls),r.showClearTriggers&&(i.clear={cls:"cisapp-form-field-clear",renderTpl:'<div id="{triggerId}" class="{baseCls} {baseCls}-{ui} {cls}"></div>',handler:function(){this.clearValue&&this.clearValue(),this.clearTreeChecked&&this.clearTreeChecked(),r.fireEvent("change",r)},scope:"this"});for(var s in e)i[s]=e[s];return r.callParent([i])},getValue:function(){var e=this,r=e.callParent(arguments);return!e.multiSelect&&e.singleIsArray&&r?[r]:r}});
Ext.define("Fm.override.form.field.Date",{override:"Ext.form.field.Date",format:"Y-m-d",formatText:"日期格式要求为: 年-月-日",invalidText:"{0} 是无效的日期 必须符合格式：年-月-日",valuePublishEvent:["select","blur","updatebind"],validateOnChange:!1,isRequirsResetMaxMinValue:!1,initComponent:function(){var t=this;t.callParent();var e=["blur","select","validateforreset"],a=function(e,a){t.validate()};Ext.Array.each(e,function(e){t.on(e,a)}),t.on("specialkey",function(e,a){a.getKey()==a.ENTER&&t.validate()}),t.hasListener("change")?t.onAfter("change",t.autoFormat):t.on("change",t.autoFormat)},checkDate:function(t){return t instanceof Date?!0:t?new Date(t).getDate()==t.toString().substring(t.length-2):!1},autoFormat:function(t,e){var a;if(e){var r=this.checkDate(e);if(r)10===t.rawValue.length&&t.fireEvent("blur",t);else{switch(dateString=e.toString().replace(/-/g,""),dateString.length){case 5:a=dateString.substr(0,4)+"-"+dateString.substr(4,1);break;case 6:a=dateString.substr(0,4)+"-"+dateString.substr(4,2);break;case 7:var a=dateString.substr(0,4)+"-"+dateString.substr(4,2)+"-"+dateString.substr(6,1);break;case 8:a=dateString.substr(0,4)+"-"+dateString.substr(4,2)+"-"+dateString.substr(6,2),t.fireEvent("blur",t);break;default:return}t.setRawValue(a)}}}});
Ext.define("Fm.override.form.field.Number",{override:"Ext.form.field.Number",repeatTriggerClick:!1,decimalPrecision:2,maxValue:9999999999999,initComponent:function(){var e=this;e.callParent(),e.on({change:function(i,r){if("-"!==r){var a=e.parseValue(Ext.Number.constrain(r,i.minValue,i.maxValue));a&&(a=a.toFixed(e.decimalPrecision)),e.setValue(a)}}})}});
Ext.define("Fm.override.form.field.VTypes",{override:"Ext.form.field.VTypes",daterange:function(e,t){var a=t.parseDate(e);if(!a)return!1;if(!t.startDateField||this.dateRangeMax&&a.getTime()==this.dateRangeMax.getTime()){if(t.endDateField){var r=t.up("daterange").down("#"+t.endDateField)||Ext.getCmp(t.endDateField);r.setMinValue(a)}}else{var d=t.up("daterange").down("#"+t.startDateField)||Ext.getCmp(t.startDateField);d.setMaxValue(a),this.dateRangeMax=a}return!0},daterangeText:"开始日期必须小于结束日期",numberrange:function(e,t){var a=parseFloat(e);if(t.startNumberField){var r=t.up("fieldcontainer").down("#"+t.startNumberField)||Ext.getCmp(t.startNumberField);r.maxValue=a}else if(t.endNumberField){var d=t.up("fieldcontainer").down("#"+t.endNumberField)||Ext.getCmp(t.endNumberField);d.minValue=a}return!0}});
Ext.define("Fm.override.form.Label",{override:"Ext.form.Label",clickEvent:"click",onRender:function(){var e=this;e.callParent(arguments),e.el.on({click:e.onClick,scope:e})},doPreventDefault:function(e){e&&(this.preventDefault||this.disabled&&this.getHref())&&e.preventDefault()},onClick:function(e){var t=this;t.doPreventDefault(e),t.fireEvent("click",t,e)===!1||t.destroyed||Ext.callback(t.handler,t.scope,[t,e],0,t)}});
Ext.define("Fm.override.form.Panel",{override:"Ext.form.Panel",isForm:!0,isIgnoreReset:!1});
Ext.define("Fm.override.form.RadioGroup",{override:"Ext.form.RadioGroup",valuePublishEvent:"updatebindvalue",checkChange:function(){this.fireEvent("updatebindvalue")},getValue:function(){for(var e,t,u=null,n=this.getBoxes(),a=0;a<n.length;a++)e=n[a],t=e.inputValue,e.getValue()===!0&&(u=t);return u},setValue:function(e){if(null!==e&&void 0!==e){var t,u=this,n=u.getBoxes();Ext.suspendLayouts();for(var a=0;a<n.length;++a)t=n[a],t.setValue(e===t.inputValue?!0:!1);return Ext.resumeLayouts(!0),u}}});
Ext.define("Fm.override.grid.column.Column",{override:"Ext.grid.column.Column",hideable:!1,menuDisabled:!0,showTip:!1,initComponent:function(){var t=this;if(t.showTip)if(t.renderer&&!t.renderer.$emptyFn){var e=t.renderer;t.renderer=function(t,r,n,o,i,l,u){var a=e(t,r,n,o,i,l,u);return null!==a&&void 0!==a&&null!==r&&(r.tdAttr||(r.tdAttr='data-qtip="'+a+'"')),a}}else t.renderer=function(t,e){return null!==t&&void 0!==t&&null!==e&&(e.tdAttr='data-qtip="'+t+'"'),t};t.callParent()},sort:function(t){var e=this,r=e.up("tablepanel"),n=r.store,o=n.getSorters(),i=e.getSorter();if(Ext.suspendLayouts(),"DESC"===e.sortState)if(o.remove(e.getSortParam()),e.sortState="",0===o.length){var l=Ext.create("Ext.util.Sorter",{sorterFn:function(t,e){return t.internalId>e.internalId?1:-1}});n.sort(l)}else n.setSorters(o.items);else i?(t&&i.setDirection(t),n.sort(i,r.multiColumnSort?"multi":"replace")):n.sort(e.getSortParam(),t,r.multiColumnSort?"multi":"replace");Ext.resumeLayouts(!0)}});
Ext.define("Fm.override.grid.column.RowNumberer",{override:"Ext.grid.column.RowNumberer",align:"center",resizable:!0,width:50});
Ext.define("Ext.grid.column.Widget",{extend:"Ext.grid.column.Column",alias:"widget.widgetcolumn",config:{defaultWidgetUI:{}},ignoreExport:!0,sortable:!1,onWidgetAttach:null,stopSelection:!0,preventUpdate:!0,initComponent:function(){var e,t=this;t.callParent(arguments),e=t.widget,(!e||e.isComponent)&&Ext.raise("column.Widget requires a widget configuration."),t.widget=e=Ext.apply({},e),e.ui||(e.ui=t.getDefaultWidgetUI()[e.xtype]||"default"),t.isFixedSize=Ext.isNumber(e.width)},processEvent:function(e,t,i,d,r,n,a,o){var l;this.stopSelection&&"click"===e&&(l=n.getTarget(t.innerSelector),l&&l!==n.target&&(n.stopSelection=!0))},beforeRender:function(){var e,t=this,i=t.tdCls;t.listenerScopeFn=function(e){return"this"===e?this:t.resolveListenerScope(e)},t.liveWidgets={},t.cachedStyles={},t.freeWidgetStack=[e=t.getFreeWidget()],i=i?i+" ":"",t.tdCls=i+e.getTdCls(),t.setupViewListeners(t.getView()),t.callParent()},afterRender:function(){var e=this.getView();this.callParent(),e&&e.viewReady&&!e.ownerGrid.reconfiguring&&this.onViewRefresh(e,e.getViewRange())},defaultRenderer:Ext.emptyFn,updater:function(e,t,i){this.updateWidget(i)},onResize:function(e){var t,i,d=this,r=d.liveWidgets,n=d.getView();if(!d.isFixedSize&&d.rendered&&n&&n.viewReady&&(i=n.getEl().down(d.getCellInnerSelector()))){e-=parseInt(d.getCachedStyle(i,"padding-left"),10)+parseInt(d.getCachedStyle(i,"padding-right"),10);for(t in r)r[t].setWidth(e)}},onAdded:function(){var e,t=this;t.callParent(arguments),e=t.getView(),e&&(t.setupViewListeners(e),e&&e.viewReady&&t.rendered&&e.getEl().down(t.getCellSelector())&&t.onViewRefresh(e,e.getViewRange()))},onRemoved:function(e){var t,i=this,d=i.liveWidgets,r=i.viewListeners;if(i.rendered&&(i.viewListeners=r&&Ext.destroy(r),!e))for(t in d)d[t].detachFromBody();i.callParent(arguments)},onDestroy:function(){var e,t,i,d,r=this,n=r.liveWidgets,a=r.freeWidgetStack;if(r.rendered){for(e in n)t=n[e],t.$widgetRecord=t.$widgetColumn=null,delete t.getWidgetRecord,delete t.getWidgetColumn,t.destroy();for(i=0,d=a.length;d>i;++i)a[i].destroy()}r.freeWidgetStack=r.liveWidgets=null,r.callParent()},getWidget:function(e){var t,i=this.liveWidgets;return e&&i&&(t=i[e.internalId]),t||null},privates:{getCachedStyle:function(e,t){var i=this.cachedStyles;return i[t]||(i[t]=Ext.fly(e).getStyle(t))},getFreeWidget:function(){var e=this,t=e.freeWidgetStack?e.freeWidgetStack.pop():null;return t||(t=Ext.widget(e.widget),t.resolveListenerScope=e.listenerScopeFn,t.getWidgetRecord=e.widgetRecordDecorator,t.getWidgetColumn=e.widgetColumnDecorator,t.dataIndex=e.dataIndex,t.measurer=e,t.ownerCmp=e.getView(),t.isLayoutChild=e.returnFalse),t},onBeforeRefresh:function(){var e,t=this.liveWidgets;for(e in t)t[e].detachFromBody()},onItemAdd:function(e,t,i){var d,r,n,a,o,l,s,g,c=this,u=c.getView(),f=!!c.onWidgetAttach,h=c.dataIndex,p=c.isFixedSize,m=e.length;if(c.isVisible(!0))for(d=0;m>d;d++)r=e[d],r.isNonData||(n=u.getRowFromItem(i[d]),n&&(a=n.cells[c.getVisibleIndex()].firstChild,p||g||(g=c.lastBox.width-parseInt(c.getCachedStyle(a,"padding-left"),10)-parseInt(c.getCachedStyle(a,"padding-right"),10)),o=c.liveWidgets[r.internalId]=c.getFreeWidget(),o.$widgetColumn=c,o.$widgetRecord=r,Ext.fly(a).empty(),o.defaultBindProperty&&h&&o.setConfig(o.defaultBindProperty,r.get(h)),f&&Ext.callback(c.onWidgetAttach,c.scope,[c,o,r],0,c),l=o.el||o.element,l?(a.appendChild(l.dom),p||o.setWidth(g),o.reattachToBody()):(p||(o.width=g),o.render(a)),s=o.getFocusEl(),s&&(u.actionableMode?s.isTabbable()||s.restoreTabbableState():s.isTabbable()&&s.saveTabbableState())))},onItemRemove:function(e,t,i){var d,r,n,a,o,l,s=this,g=s.liveWidgets;if(s.rendered)for(i=Ext.Array.from(i),a=i.length,o=0;a>o;o++)r=i[o],n=r.getAttribute("data-recordId"),n&&(d=g[n])&&(delete g[n],s.freeWidgetStack.unshift(d),d.$widgetRecord=d.$widgetColumn=null,l=d.getFocusEl(),l&&(l.isTabbable()&&l.saveTabbableState(),l.blur()),d.detachFromBody())},onItemUpdate:function(e,t,i){this.updateWidget(e)},onViewRefresh:function(e,t){var i,d,r,n,a,o,l,s,g,c,u,f=this,h=e.all,p=!!f.onWidgetAttach,m=f.liveWidgets,w=f.dataIndex,v=f.isFixedSize;if(f.isVisible(!0)){for(f.liveWidgets={},Ext.suspendLayouts(),o=h.startIndex,l=0;o<=h.endIndex;o++,l++)s=t[l],s.isNonData||(a=s.internalId,i=e.getRow(h.item(o)).cells[f.getVisibleIndex()].firstChild,d=f.liveWidgets[a]=m[a]||f.getFreeWidget(),d.$widgetRecord=s,d.$widgetColumn=f,delete m[a],c=f.lastBox,c&&!v&&void 0===n&&(n=c.width-parseInt(f.getCachedStyle(i,"padding-left"),10)-parseInt(f.getCachedStyle(i,"padding-right"),10)),d.defaultBindProperty&&w&&d.setConfig(d.defaultBindProperty,t[l].get(w)),p&&Ext.callback(f.onWidgetAttach,f.scope,[f,d,s],0,f),r=d.el||d.element,r?(u=r.dom,u.parentNode!==i&&(Ext.fly(i).empty(),i.appendChild(r.dom)),v||d.setWidth(n),d.reattachToBody()):(v||(d.width=n),Ext.fly(i).empty(),d.render(i)));Ext.resumeLayouts(!0);for(g in m)d=m[g],d.$widgetRecord=d.$widgetColumn=null,f.freeWidgetStack.unshift(d),d.detachFromBody()}},returnFalse:function(){return!1},setupViewListeners:function(e){var t=this;t.viewListeners=e.on({refresh:t.onViewRefresh,itemupdate:t.onItemUpdate,itemadd:t.onItemAdd,itemremove:t.onItemRemove,scope:t,destroyable:!0}),Ext.isIE8&&e.on("beforerefresh",t.onBeforeRefresh,t)},updateWidget:function(e){var t,i=this.dataIndex;this.rendered&&(t=this.liveWidgets[e.internalId],t&&t.defaultBindProperty&&i&&t.setConfig(t.defaultBindProperty,e.get(i)))},widgetRecordDecorator:function(){return this.$widgetRecord},widgetColumnDecorator:function(){return this.$widgetColumn}}}),Ext.define("Fm.override.grid.column.Widget",{override:"Ext.grid.column.Widget",sortable:!0,ignoreExport:!1,setWidgetVal:function(e,t){var i=this.dataIndex;if(e&&this.rendered){if(e.cisBindProperty){Ext.log.warn("此方法(widgetcolumn:cisBindProperty配置)不建议继续使用，替代：onWidgetAttach","warn");var d={};for(var r in e.cisBindProperty){var n=t.get(e.cisBindProperty[r].dataIndex);e.cisBindProperty[r].renderer&&(n=e.cisBindProperty[r].renderer(n,t)),d[r]=n,e.setConfig(d)}}else if(e.defaultBindProperty&&i){var n=t.get(i);e.renderer&&(n=e.renderer(n,t)),e.setConfig(e.defaultBindProperty,n)}e.updateLayout()}},privates:{updateWidget:function(e){{var t;this.dataIndex}this.rendered&&(t=this.liveWidgets[e.internalId],t&&this.setWidgetVal(t,e))},onItemAdd:function(e,t,i){var d,r,n,a,o,l,s,g,c=this,u=c.getView(),f=!!c.onWidgetAttach,h=(c.dataIndex,c.isFixedSize),p=e.length;if(c.isVisible(!0))for(d=0;p>d;d++)r=e[d],r.isNonData||(n=u.getRowFromItem(i[d]),n&&(a=n.cells[c.getVisibleIndex()].firstChild,h||g||(g=c.lastBox.width-parseInt(c.getCachedStyle(a,"padding-left"),10)-parseInt(c.getCachedStyle(a,"padding-right"),10)),o=c.liveWidgets[r.internalId]=c.getFreeWidget(),o.$widgetColumn=c,o.$widgetRecord=r,Ext.fly(a).empty(),o&&this.setWidgetVal(o,r),f&&Ext.callback(c.onWidgetAttach,c.scope,[c,o,r],0,c),l=o.el||o.element,l?(a.appendChild(l.dom),h||o.setWidth(g),o.reattachToBody()):(h||(o.width=g),o.render(a)),s=o.getFocusEl(),s&&(u.actionableMode?s.isTabbable()||s.restoreTabbableState():s.isTabbable()&&s.saveTabbableState())))}}});
Ext.define("Fm.override.grid.View",{override:"Ext.grid.View",enableTextSelection:!0});
!function(){Ext.apply(Ext.Boot,{create:function(r,e,t){var o=t||{};try{r=Ext.urlAppend(r,"_v="+AppConfig.version)}catch(a){}return o.url=r,o.key=e,Ext.Boot.scripts[e]=new Ext.Boot.Entry(o)}}),Ext.apply(Ext.Loader,{loadScript:function(r){var e=Ext.Loader,t="string"==typeof r,o=r instanceof Array,a=!o&&!t,n=a?r.url:r,s=a&&r.onError,i=a&&r.onLoad,l=a&&r.scope,c={url:(AppConfig.urlStartWith+"/"+n).replace("///","/").replace("//","/"),scope:l,onLoad:i,onError:s,_classNames:[]};e.loadScripts(c)},onLoadFailure:function(){var r=Ext.Loader,e=this,t=e.onError;if(r.hasFileLoadError=!0,--r.scriptsLoading,t)t.call(e.userScope,e);else{Ext.Msg.alert("操作失败","网络已断开,请检查您的网络并重试。"),Ext.log.error("[Ext.Loader] Some requested files failed to load.");for(var o=arguments[0].entries,a=0;a<o.length;a++)o[a].error&&(Ext.Boot.scripts[o[a].key]=void 0,Ext.log.error("[Ext.Loader]类: "+e._classNames[a]+" 加载失败,请检查requires或者uses配置路径。"))}r.checkReady()}}),function(){Ext.apply(Ext,{create:function(){try{var r,e=arguments[0],t=typeof e,o=Array.prototype.slice.call(arguments,1),a=Ext.ClassManager,n="undefined"==typeof window;if("function"===t)r=e;else{if("string"!==t&&0===o.length&&(o=[e],(e=e.xclass)||(e=o[0].xtype,e&&(e="widget."+e))),"string"!=typeof e||e.length<1)throw new Error("[Ext.create] Invalid class name or alias '"+e+"' specified, must be a non-empty string");e=a.resolveName(e),r=a.get(e)}if(r||(!n&&Ext.log.warn("[Ext.Loader] Synchronously loading '"+e+"'; consider adding Ext.require('"+e+"') above Ext.onReady"),Ext.syncRequire(e),r=a.get(e)),!r)throw new Error("[Ext.create] Unrecognized class name / alias: "+e);if("function"!=typeof r)throw new Error("[Ext.create] Singleton '"+e+"' cannot be instantiated.");return a.getInstantiator(o.length)(r,o)}catch(s){return Ext.log.error("[Ext.create] 位于Class "+e+" .消息:"+s.message),Ext.log.error(s.stack),application.globalMask.hide(),Ext.create("Ext.container.Container")}}})}(),Ext.apply(Ext.Error,{raise:function(r){r=r||{},Ext.isString(r)&&(r={msg:r});var e,t,o=this,a=o.raise.caller;if(a===Ext.raise&&(a=a.caller),a&&(!r.sourceMethod&&(t=a.$name)&&(r.sourceMethod=t),!r.sourceClass&&(t=a.$owner)&&(t=t.$className)&&(r.sourceClass=t)),o.handle(r)!==!0&&(e=toString.call(r),Ext.log({msg:e,level:"error",dump:r,stack:!0}),AppConfig.isDev)){try{Fm.msg.error(e)}catch(n){}throw new Ext.Error(r)}}})}();
Ext.define("Fm.override.layout.component.Dock",{override:"Ext.layout.component.Dock",handleItemBorders:function(){var e=this,o=e.owner;o.border!==!0&&(o.border=!1),e.callParent(arguments)}});
Ext.define("Fm.override.layout.container.Table",{override:"Ext.layout.container.Table",config:{columns:null},getLayoutItems:function(){var e,i,t=this,n=t.owner,o=[],r=n&&n.items,l=r&&r.items||[],a=l.length;for(i=0;a>i;i++)e=l[i],e.hidden&&"visibility"!==e.hideMode||o.push(e);return o}});
Ext.define("Fm.override.list.Tree",{override:"Ext.list.Tree",privates:{floatItem:function(e,t){var r=this;r.callParent(arguments),e.element.on("mouseout",r.checkForMouseLeave,r)}}});
Ext.define("Fm.override.list.TreeItem",{override:"Ext.list.TreeItem",isSelectionEvent:function(e){var t=this,i=this.getOwner();return i.fireEvent("itemclick",i,t.getNode()),!1}});
Ext.define("Fm.override.panel.Panel",{override:"Ext.panel.Panel",border:!1,frame:!1,closeToolText:"关闭"});
Ext.define("Fm.override.panel.Table",{override:"Ext.panel.Table",setDisabled:function(e){Ext.log.warn("此方法(grid:setDisabled)不建议继续使用，替代：setRowDisabled(records, isDis)"),this.setRowDisabled(e,!0)},setRowDisabled:function(e,t){var i=this,t=(i.getView(),t||!0);Ext.suspendLayouts(),Ext.Array.each(e,function(e){e.set({_isDisabled:t})}),Ext.resumeLayouts(!0)},updateBindSelection:function(e,t){var i=this,n=null;i.ignoreNextSelection||(i.ignoreNextSelection=!0,t.length&&(n="SINGLE"===e.selectionMode?e.getLastSelected():i.getSelection(),i.hasHadSelection=!0),i.hasHadSelection&&i.setSelection(n),i.ignoreNextSelection=!1)},getRowExpander:function(){if(this.plugins&&Ext.isArray(this.plugins)){for(var e=0;e<this.plugins.length;e++)if(this.plugins[e].isRowExpander)return this.plugins[e]}else if(this.plugins&&this.plugins.isRowExpander)return this.plugins},getClickSelectionModel:function(){if(this.plugins&&Ext.isArray(this.plugins)){for(var e=0;e<this.plugins.length;e++)if(this.plugins[e].isClickSelection)return this.plugins[e]}else if(this.plugins&&this.plugins.isClickSelection)return this.plugins},getExportColumns:function(){var e=this,t=e.getColumns(),i=Ext.Array.filter(t,function(e){return!e.isCheckerHd&&!e.ignoreExport});return i},exportAlign:{left:"Left",right:"Right",center:"Center"},getExportData:function(e){var t,i,n,r,s=this,l=s.getExportColumns(),o=l.length,a=[],u=[],g=/<.*>(.*)<\/.*>|<.*\/>/;if(Ext.Array.each(l,function(e){if(!e.isCheckerHd&&!e.ignoreExport){var t=e.exportWidth||e.width;try{t=e.getWidth()}catch(i){}a.push({TitleName:e.text,TitleValue:e.exportIndex||e.dataIndex,TitleWide:Math.ceil(t/7.5),IsRMB:!!e.exportIsRMB,IsCount:!!e.exportIsCount,DataType:e.dataType,Digit:e.digit,CellType:s.exportAlign[e.align]})}}),e)for(var d=0;d<e.length;d++){t=e[d],i={};for(var p=0;o>p;p++){if(n=l[p],r=t.get(n.dataIndex),n.exportRender?r=n.exportRender(r,null,t):n.renderer&&!n.renderer.$emptyFn&&(r=n.renderer(r,null,t)),(null===r||void 0===r)&&(r=""),r=r.toString(),r&&(_v=r.replace(/￥/g,""),_v)){r=_v;var h=r.match(g);h&&(r=h[1])}i[n.exportIndex||n.dataIndex]=r.trim()}u.push(i)}return{titles:a,rows:u}}});
Ext.define("Fm.override.panel.Title",{override:"Ext.panel.Title",onRender:function(){var e=this;e.callParent(arguments),e.el.on({dblclick:e.ondblClick,scope:e})},doPreventDefault:function(e){e&&(this.preventDefault||this.disabled&&this.getHref())&&e.preventDefault()},ondblClick:function(e){var t=this;t.doPreventDefault(e),t.up("tabpanel")&&t.up("tabpanel").fireEvent("tabbardblclick",t,e)!==!1&&!t.destroyed&&Ext.callback(t.handler,t.scope,[t,e],0,t)}});
Ext.define("Fm.override.resizer.Splitter",{override:"Ext.resizer.Splitter",size:5,defaultSplitMin:0,collapseOnDblClick:!1});
Ext.define("Fm.override.selection.CheckboxModel",{override:"Ext.selection.CheckboxModel",onHeaderClick:function(e,l,o){var c,t=this;l===t.column&&"SINGLE"!==t.mode&&(c=l.el.hasCls(Ext.baseCSSPrefix+"grid-hd-checker-on"),c?t.deselectAll():t.selectAll(),o.stopEvent())}});
Ext.define("Fm.override.selection.Model",{override:"Ext.selection.Model",bindCheckedField:null,addSelectItems:function(){var e=this;Ext.suspendLayouts(),e.suspendChanges(),e.selected.clear();var t=[];Ext.Array.each(e.store.getData().items,function(i){i.get(e.bindCheckedField)&&t.push(i)}),e.select(t,!0,!0),e.fireEvent("updateGroupSelect"),e.resumeChanges(),Ext.resumeLayouts(!0)},onStoreLoad:function(){var e=this,t=e.store;e.bindCheckedField&&null!=t&&t.getData().items.length>0&&(Ext.log.warn("此方法(grid的selection插件配置自动选中行)不建议继续使用，替代：Fm.ux.grid.plugin.AutoSelector 插件模式"),e.addSelectItems())},doSelect:function(e,t,i){var r,l=this;if(!l.locked&&null!=e){if("number"==typeof e){if(r=l.store.getAt(e),!r)return;e=[r]}if("SINGLE"===l.selectionMode){if(e.isModel&&(e=[e]),e.length){if(e[0].get("_isDisabled"))return;l.doSingleSelect(e[0],i)}}else{Ext.isArray(e)||(e=[e]);var n=Ext.Array.filter(e,function(e){return!e.get("_isDisabled")});l.doMultiSelect(n,t,i)}}},doDeselect:function(e,t){var i=this;if(i.locked||!i.store)return!1;if("number"==typeof e){if(record=i.store.getAt(e),!record)return!1;e=[record]}else Ext.isArray(e)||(e=[e]);return e=Ext.Array.filter(e,function(e){return!e.get("_isDisabled")}),i.callParent([e,t])},selectAll:function(e){var t=this,i=(t.store.getRange(),t.getSelection().length);this.callParent([!0]),t.destroyed||e||t.maybeFireSelectionChange(t.getSelection().length!==i),this.fireEvent("selectAll",this)},deselectAll:function(e){var t=this,i=t.getSelection(),r=i.length;this.callParent([!0]),t.destroyed||e||t.maybeFireSelectionChange(t.getSelection().length!==r),this.fireEvent("deselectAll",this)}});
Ext.define("Fm.override.toolbar.Toolbar",{override:"Ext.toolbar.Toolbar",defaultButtonUI:"default",dblclickEvent:"dblclick",onRender:function(){var e=this;e.callParent(arguments),e.el.on({dblclick:e.ondblClick,scope:e})},doPreventDefault:function(e){e&&(this.preventDefault||this.disabled&&this.getHref())&&e.preventDefault()},ondblClick:function(e){var t=this;t.doPreventDefault(e),t.fireEvent("dblclick",t,e)===!1||t.destroyed||Ext.callback(t.handler,t.scope,[t,e],0,t)}});
Ext.define("Fm.override.tree.Column",{override:"Ext.tree.Column",cellTpl:['<tpl for="lines">','<div class="{parent.childCls} {parent.elbowCls}-img ','{parent.elbowCls}-<tpl if=".">line<tpl else>empty</tpl>" role="presentation"></div>',"</tpl>",'<div class="{childCls} {elbowCls}-img {elbowCls}','<tpl if="isLast">-end</tpl><tpl if="expandable">-plus {expanderCls}</tpl>" role="presentation"></div>','<tpl if="checked !== null">','<div role="button" {ariaCellCheckboxAttr}',' class="{childCls} {checkboxCls}<tpl if="checked"> {checkboxCls}-checked</tpl>"></div>',"</tpl>",'<tpl if="href">','<a href="{href}" role="link" target="{hrefTarget}" class="{textCls} {childCls}">{value}</a>',"<tpl else>",'<span class="{textCls} {childCls}">{value}</span>',"</tpl>"]});
Ext.define("Fm.override.util.Sorter",{override:"Ext.util.Sorter",sortFn:function(r,t){var e,o,i=this,n=i._transform,a=i._root,f=i._property;return a&&(r=r[a],t=t[a]),e=r[f],o=t[f],n&&(e=n(e),o=n(o)),"string"==typeof e?e.localeCompare(o):e>o?1:o>e?-1:0}});
Ext.define("Fm.override.view.AbstractView",{override:"Ext.view.AbstractView",loadingText:function(){return window.AppConfig?window.AppConfig.maskHtml:"加载中..."}()});
Ext.define("Fm.override.view.Table",{override:"Ext.view.Table",enableTextSelection:!0,disableCls:"x-form-item-default x-item-disabled",rowTpl:["{%",'var dataRowCls = values.recordIndex === -1 ? "" : " '+Ext.baseCSSPrefix+'grid-row";','var disabledCls = values.record.get("_isDisabled") ? "x-form-item-default x-item-disabled":"";',"%}",'<tr class="{[values.rowClasses.join(" ")]} {[disabledCls]} {[dataRowCls]}"',' role="{rowRole}" {rowAttr:attributes}>','<tpl for="columns">{%',"parent.view.renderCell(values, parent.record, parent.recordIndex, parent.rowIndex, xindex - 1, out, parent)","%}","</tpl>","</tr>",{priority:0}],initComponent:function(){var e=this;if(AppConfig.enableGridClickCopy&&e.grid&&!e.grid.notEnabledCopy)if(window.clipboardData)e.on("cellclick",function(e,t){window.clipboardData&&window.clipboardData.setData("Text",Ext.String.trim(t.innerText||t.textContent||""))});else if(window.Clipboard){var t=parseInt(Ext.versions.extjs.major.toString()+Ext.versions.extjs.minor.toString()+Ext.versions.extjs.pad.toString(),10),r=620>t?{text:function(e){return Ext.String.trim(e.innerText||e.textContent||"")}}:{target:function(e){return e}};e.on("refresh",function(t){setTimeout(function(){var t=e.getEl();if(t&&t.dom&&t.dom.querySelectorAll){new Clipboard(t.dom.querySelectorAll(".x-grid-cell-inner"),r)}},300)});var i=function(e,t,i,n){for(var o=0;o<i.length;o++){new Clipboard(i[o].querySelectorAll(".x-grid-cell-inner"),r)}};e.on("itemadd",i),e.on("itemupdate",i)}e.callParent(arguments)}});
Ext.define("Fm.override.window.MessageBox",{override:"Ext.window.MessageBox",prompt:function(t,i,e,o,s,n){return Ext.isString(t)&&(t={prompt:!0,title:t,minWidth:this.minPromptWidth,message:i,buttons:this.OKCANCEL,callback:e,scope:o,multiline:s,value:n,width:360,height:180}),this.show(t)}});
Ext.define("Fm.data.validator.ByteLength",{extend:"Ext.data.validator.Bound",alias:"data.validator.bytelength",type:"bytelength",config:{maxOnlyMessage:"长度不能超过 {0}个字符(一个汉字算两个字符)"},getValue:function(t){var a=String(t);return a.length+(a.match(/[^x00-xff]/g)||[]).length}});
Ext.define("Fm.locale.zh_CN.grid.feature.Grouping",{override:"Ext.grid.feature.Grouping",expandTip:"",collapseTip:""}),Ext.define("Fm.locale.zh_CN.view.AbstractView",{override:"Ext.view.AbstractView",loadingText:"读取中..."}),Ext.define("Fm.locale.zh_CN.form.field.ComboBox",{override:"Ext.form.field.ComboBox"},function(){Ext.apply(Ext.form.field.ComboBox.prototype.defaultListConfig,{loadingText:"读取中..."})}),Ext.define("Fm.locale.zh_CN.data.validator.Email",{override:"Ext.data.validator.Email",config:{message:'该输入项必须是电子邮件地址，格式如： "user@example.com"'}}),Ext.define("Fm.locale.zh_CN.data.validator.Length",{override:"Ext.data.validator.Length",config:{minOnlyMessage:"长度必须大于 {0}",maxOnlyMessage:"长度不能超过 {0}",bothMessage:"长度必须为 {0}到{1}"}}),Ext.define("Fm.locale.zh_CN.panel.Panel",{override:"Ext.panel.Panel",closeToolText:"关闭"});
Ext.define("Fm.ux.button.ImageButton",{extend:"Ext.button.Button",alias:"widget.imagebutton",cls:"",iconAlign:"left",initRenderTpl:Ext.emptyFn,componentLayout:null,autoEl:"img",frame:!1,initComponent:function(){this.scale=null,this.callParent(),this.autoEl={tag:"img",role:"button",hidefocus:"on",unselectable:"on"};var t;this.imageUrl&&(t=(new Image).src=this.imageUrl),this.overImageUrl&&(t=(new Image).src=this.overImageUrl),this.disabledImageUrl&&(t=(new Image).src=this.disabledImageUrl),this.pressedImageUrl&&(t=(new Image).src=this.pressedImageUrl)},getElConfig:function(){return Ext.apply(this.callParent(),{tag:"img",id:this.getId(),src:this.imageUrl,style:this.getStyle()})},getStyle:function(){var t="border:none;cursor:pointer;";return this.style&&(t+=this.style),this.height&&(t+="height:"+this.height+"px;"),this.width&&(t+="width:"+this.width+"px;"),t},onRender:function(t,i){this.imgEl=this.el,Ext.isEmpty(this.imgEl.getAttribute("width"),!1)&&Ext.isEmpty(this.imgEl.getAttribute("height"),!1)||(this.imgEl.dom.removeAttribute("width"),this.imgEl.dom.removeAttribute("height")),this.altText&&this.imgEl.dom.setAttribute("alt",this.altText),this.align&&"notset"!==this.align&&this.imgEl.dom.setAttribute("align",this.align),this.pressed&&this.pressedImageUrl&&(this.imgEl.dom.src=this.pressedImageUrl),this.disabled&&this.setDisabled(!0),void 0!==this.tabIndex&&(this.imgEl.dom.tabIndex=this.tabIndex),this.href&&this.on("click",function(){this.target?window.open(this.href,this.target):window.location=this.href},this),this.callParent(arguments),this.btnEl=this.el},onMenuShow:function(t){this.ignoreNextClick=0,this.pressedImageUrl&&(this.imgEl.dom.src=this.pressedImageUrl),this.fireEvent("menushow",this,this.menu)},onMenuHide:function(t){this.ignoreNextClick=Ext.defer(this.restoreClick,250,this),this.imgEl.dom.src=this.monitoringMouseOver?this.overImageUrl:this.imageUrl,this.fireEvent("menuhide",this,this.menu),this.focus()},getTriggerSize:function(){return 0},toggle:function(t,i,s){return t=void 0===t?!this.pressed:!!t,t!=this.pressed&&(t?(this.pressedImageUrl&&(this.imgEl.dom.src=this.pressedImageUrl),this.pressed=!0):(this.imgEl.dom.src=this.monitoringMouseOver?this.overImageUrl:this.imageUrl,this.pressed=!1),i||this.fireEvent("toggle",this,this.pressed),this.toggleHandler&&!s&&this.toggleHandler.call(this.scope||this,this,t)),this},setText:Ext.emptyFn,setDisabled:function(t){this.disabled=t,this.imgEl&&this.imgEl.dom&&(this.imgEl.dom.disabled=t),t?(this.disabledImageUrl?this.imgEl.dom.src=this.disabledImageUrl:this.imgEl.addCls(this.disabledCls),this.imgEl.setStyle({cursor:"default"})):(this.imgEl.dom.src=this.imageUrl,this.imgEl.setStyle({cursor:"pointer"}),this.imgEl.removeCls(this.disabledCls))},onMouseOver:function(t){if(!this.disabled){var i=t.within(this.el.dom,!0);i||(!this.overImageUrl||this.pressed||this.hasVisibleMenu()||(this.imgEl.dom.src=this.overImageUrl),this.monitoringMouseOver||(Ext.getDoc().on("mouseover",this.monitorMouseOver,this),this.monitoringMouseOver=!0))}this.fireEvent("mouseover",this,t)},monitorMouseOver:function(t){t.target==this.el.dom||t.within(this.el)||(this.monitoringMouseOver&&(Ext.getDoc().un("mouseover",this.monitorMouseOver,this),this.monitoringMouseOver=!1),this.onMouseOut(t))},onMouseEnter:function(t){!this.overImageUrl||this.pressed||this.disabled||this.hasVisibleMenu()||(this.imgEl.dom.src=this.overImageUrl),this.fireEvent("mouseover",this,t)},onMouseOut:function(t){this.disabled||this.pressed||this.hasVisibleMenu()||(this.imgEl.dom.src=this.imageUrl),this.fireEvent("mouseout",this,t)},onMouseDown:function(t){var i=this;Ext.isIE&&i.getFocusEl().focus(),i.disabled||0!==t.button||(i.pressedImageUrl&&(i.imgEl.dom.src=i.pressedImageUrl),Ext.button.Manager.onButtonMousedown(i,t))},onMouseUp:function(t){this.isDestroyed||0!==t.button||this.enableToggle||this.hasVisibleMenu()||(this.imgEl.dom.src=this.overImageUrl&&this.monitoringMouseOver?this.overImageUrl:this.imageUrl)},setImageUrl:function(t){this.imageUrl=t,this.disabled&&!Ext.isEmpty(this.disabledImageUrl,!1)||this.pressed&&!Ext.isEmpty(this.pressedImageUrl,!1)?(new Image).src=t:this.imgEl.dom.src=t},setDisabledImageUrl:function(t){this.disabledImageUrl=t,this.disabled?this.imgEl.dom.src=t:(new Image).src=t},setOverImageUrl:function(t){this.overImageUrl=t,this.disabled&&!Ext.isEmpty(this.disabledImageUrl,!1)||this.pressed&&!Ext.isEmpty(this.pressedImageUrl,!1)?(new Image).src=t:this.imgEl.dom.src=t},setPressedImageUrl:function(t){this.pressedImageUrl=t,this.disabled&&!Ext.isEmpty(this.disabledImageUrl,!1)||!this.pressed?(new Image).src=t:this.imgEl.dom.src=t},setAlign:function(t){this.align=t,this.rendered&&this.imgEl.dom.setAttribute("align",this.align)},setAltText:function(t){this.altText=t,this.rendered&&this.imgEl.dom.setAttribute("altText",this.altText)}});
Ext.define("Fm.ux.button.LinkButton",{extend:"Ext.button.Button",alias:"widget.linkbutton",ui:"button-link",initComponent:function(){this.callParent()}});
Ext.define("Fm.ux.form.CheckField",{extend:"Ext.container.Container",alias:"widget.checkfield",alternateClassName:["Fm.ux.CheckField"],items:[],viewModel:{data:{Checked:!1}},layout:{type:"hbox",align:"right"},initComponent:function(){var e=this;Ext.apply(e,{items:[{xtype:"checkbox",labelAlign:"right",fieldLabel:e.fieldLabel,colspan:1,width:205,labelWidth:180,bind:{value:"{Checked}"}},{xtype:"textfield",margin:"0 60 0 0",colspan:1,width:150,value:e.value,bind:{disabled:"{!Checked}"}}]}),e.callParent()}});
Ext.define("Fm.ux.form.ComboGrid",{extend:"Ext.form.field.ComboBox",alias:["widget.comboxgrid","widget.combogrid"],editable:!1,windowTitle:null,winHeight:500,winWidth:800,showClearTriggers:!0,checkChangeEvents:Ext.isIE&&(!document.documentMode||document.documentMode<=9)?["change","propertychange","keyup"]:["change","keyup","dragdrop"],isHandleAllValue:!0,isValidate:!1,taskType:null,month:null,multiAllValue:[],singleIsArray:!1,isSelectAll:!1,allLength:null,isPopWindow:!1,multiSelect:!1,valueSplitChar:",",valueIsString:!1,initComponent:function(){var e=this;Ext.log.warn("Fm.ux.form.ComboGrid 不建议继续使用，替代：Fm.ux.form.ComboGridField(下拉)、Fm.ux.form.WindowField(弹出)"),e.callParent(arguments)},onTriggerClick:function(e){var t=this;t.isPopWindow?t.onTriggerClickPopWindow():t.readOnly||t.disabled||(t.isExpanded?t.collapse():t.expand())},onFieldMutation:function(e){var t=this,l=e.getKey(),i=l===e.BACKSPACE||l===e.DELETE,a=l===e.CTRL,o=t.inputEl.dom.value,n=o.length;if(!t.readOnly&&(o!==t.lastMutatedValue||i)&&l!==e.TAB){{t.lastMutatedValue}t.lastMutatedValue=o,t.lastKey=l,n||"keyup"===e.type&&e.isSpecialKey()&&!i?n&&("keyup"!==e.type||!e.isSpecialKey()||i||a)?(t.setValue(o),t.fireEvent("change",t)):(n||l&&!i||(t.multiSelect||(t.value=null,t.displayTplData=void 0),t.clearValueOnEmpty&&t.valueCollection.removeAll(),t.collapse(),t.queryFilter&&(t.changingFilters=!0,t.store.removeFilter(t.queryFilter,!0),t.changingFilters=!1)),t.callParent([e])):(t.clearValue(),t.fireEvent("change",t))}},onTriggerClickPopWindow:function(){var e,t,l=this,i=["->"];t=l.multiSelect?{selType:"checkboxmodel",mode:"SIMPLE",allowDeselect:!0}:{mode:"SINGLE",allowDeselect:!0},i.push({text:"选择",width:70,handler:function(e){var t=e.up("window[popWindow=is]"),i=t.down("cisgrid")||t.down("grid"),a=i.getSelection();l.isValidate&&l.setValue(null),l.updateValue(a),l.callbackChecked&&l.callbackChecked(a),t.close()}},{text:"取消",width:70,handler:function(e){var t=e.up("window[popWindow=is]");t.close()}}),e=Ext.create("Ext.window.Window",{title:l.windowTitle||l.fieldLabel,height:l.winHeight,width:l.winWidth,modal:!0,layout:"fit",popWindow:"is",taskType:l.taskType,month:l.month,listeners:{close:function(){l.focus()}},items:[Ext.apply(l.innerGrid,{selModel:t,listeners:{itemdblclick:function(e,t,i,a,o,n){if(!l.multiSelect){var s=[],r=e.up("window[popWindow=is]");s.push(t),l.isValidate&&l.setValue(null),l.updateValue(s),l.callbackChecked&&l.callbackChecked(t),r.close()}},afterrender:function(e,t){e.down("[focusEnable=true]")&&e.down("[focusEnable=true]").focus()}}})],buttons:i}),e.show()},getAllLength:function(){var e,t=this;if(!t.allLength){if(e=t.getStore(),!e||e.isEmptyStore){var l=t.getBind();l&&l.store&&(e=l.store.getValue())}return e.getTotalCount()}return t.allLength},createPicker:function(){var e,t=this;return e=t.picker=t.getGridPicker(),(!t.store||t.store.isEmptyStore)&&(t.store=e.getStore()),(!t.store||t.store.isEmptyStore)&&(t.store=e.getController().getGridStore()),t.pageSize&&e.pagingToolbar.on("beforechange",t.onPageChange,t),e.initialConfig.maxHeight||e.on({beforeshow:t.onBeforePickerShow,scope:t}),e.getSelectionModel().on({beforeselect:t.onBeforeSelect,beforedeselect:t.onBeforeDeselect,scope:t}),e.getNavigationModel().navigateOnSpace=!1,e},getGridPicker:function(){var e=this,t={pickerField:e,hidden:!0,displayField:e.displayField,preserveScrollOnRefresh:!0,pageSize:e.pageSize,selModel:e.pickerSelectionModel,floating:!0,minWidth:e.minPickerWidth,minHeight:e.minPickerHeight,maxHeight:e.maxPickerHeight,autoScroll:!0,listeners:{itemclick:{fn:e.onItemClick}},refresh:function(){}};(e.store||e.store.isEmptyStore)&&(t.store=e.getPickerStore());var l=Ext.apply(e.innerGrid,t);e.originalCollapse=e.collapse,l.listeners.show=e.multiSelect?{fn:function(){e.picker.el.on({mouseover:function(){this.collapse=Ext.emptyFn},mouseout:function(){this.collapse=this.originalCollapse},scope:e})}}:{fn:function(){e.picker.el.on({mousedown:function(){this.collapse=Ext.emptyFn},mouseup:function(){this.collapse=this.originalCollapse},scope:e})}};var i;return i=Ext.ComponentManager.create(Ext.isFunction(l)?l.call():l,"panel")},updateValue:function(e){var t,l,i=this,a=e||i.valueCollection.getRange(),o=a.length,n=[],s=i.displayTplData||(i.displayTplData=[]),r=i.inputEl;for(s.length=0,t=0;o>t;t++)l=a[t],s.push(i.getRecordDisplayData(l)),l!==i.valueNotFoundRecord&&n.push(l.get(i.valueField));i.setHiddenValue(n),i.value=i.multiSelect?n:n[0],Ext.isDefined(i.value)||(i.value=void 0),i.displayTplData=s,r&&i.emptyText&&!Ext.isEmpty(i.value)&&r.removeCls(i.emptyCls),i.setRawValue(i.getDisplayValue()),i.checkChange(),i.refreshEmptyText(),r&&i.typeAhead&&i.hasFocus&&i.selectText(displayValue.length)},updateValue22:function(e){var t,l,i=this,a=i.valueCollection.getRange(),o=a.length,n=[],s=i.displayTplData||(i.displayTplData=[]),r=i.inputEl;for(0==a.length&&e&&(a=e,o=a.length),s.length=0,t=0;o>t;t++)l=a[t],s.push(i.getRecordDisplayData(l)),l!==i.valueNotFoundRecord&&n.push(l.get(i.valueField));i.setHiddenValue(n),i.value=i.multiSelect?n:n[0],Ext.isDefined(i.value)||(i.value=void 0),i.displayTplData=s,r&&i.emptyText&&!Ext.isEmpty(i.value)&&r.removeCls(i.emptyCls),i.setRawValue(i.getDisplayValue()),i.checkChange(),i.applyEmptyText()},doSetValue:function(e,t){this.isPopWindow||this.getPicker();var l,i,a,o,n,s,r,d=this,u=d.getStore(),c=[],p=[],g=d.autoLoadOnValue,h=u.getCount()>0||u.isLoaded(),y=u.hasPendingLoad(),m=g&&!h&&!y,v=d.forceSelection,f=d.pickerSelectionModel,S=(d.displayField===d.valueField,u.isEmptyStore),E=d.lastSelection;if(t&&!d.multiSelect&&Ext.raise("Cannot add values to non multiSelect ComboBox"),y||m||!h||S){if(!e.isModel){if(d.multiSelect&&!d.valueIsString){var x=e;e&&!Ext.isArray(e)&&(x=e.toString().split(d.valueSplitChar)),e=x}if(d.value=t?Ext.Array.from(d.value).concat(e):e,""===e&&(this.displayTplData=[""]),this.displayTplData&&(0===this.displayTplData.length||"string"==typeof this.displayTplData[0])&&"object"!=typeof this.displayTplData[0]){var C=[];C.push(e),this.displayTplData=C}if(d.setHiddenValue(d.value),d.setRawValue(this.displayTplData&&0!==this.displayTplData.length&&"object"!=typeof e?d.getDisplayValue():d.value),d.value&&(this.displayTplData=[],d.inputEl.removeCls(d.emptyCls+"-"+d.ui)),!e.isModel||S)return d}if(m&&!S&&u.load(),!e.isModel||S)return d}for(e=t?Ext.Array.from(d.value).concat(e):Ext.Array.from(e),i=0,a=e.length;a>i;i++)o=e[i],o&&o.isModel||(o=d.store.findRecord(d.valueField,o),o||(o=d.valueCollection.find(d.valueField,r))),o||(v?d.valueNotFoundRecord&&(o=d.valueNotFoundRecord):!o&&e[i]&&(n={},n[d.displayField]=e[i],d.valueField&&d.displayField!==d.valueField&&(n[d.valueField]=e[i]),l=u.getModel(),o=new l(n))),o&&(c.push(o),p.push(o.get(d.valueField)));if(E)if(a=E.length,a===c.length)for(i=0;!s&&a>i;i++)-1===Ext.Array.indexOf(d.lastSelection,c[i])&&(s=!0);else s=!0;else s=c.length;return s?(d.suspendEvent("select"),d.valueCollection.beginUpdate(),c.length?f.select(c,!1):f.deselectAll(),d.valueCollection.endUpdate(),d.resumeEvent("select")):d.updateValue(),d},onValueCollectionEndUpdate:function(){var e=this,t=e.store,l=e.valueCollection.getRange(),i=l[0],a=l.length;e.updateBindSelection(e.pickerSelectionModel,l),e.isSelectionUpdating()||(Ext.suspendLayouts(),e.lastSelection=l,a&&(e.lastSelectedRecords=l),e.updateValue(),a&&(!e.multiSelect&&t.contains(i)||e.collapseOnSelect||!t.getCount())&&(e.updatingValue=!0,e.collapse(),e.updatingValue=!1),Ext.resumeLayouts(!0),a&&!e.suspendCheckChange&&(e.multiSelect||(l=i),e.fireEvent("select",e,l)))},onBindStore:function(e,t){var l,i,a=this,o=a.picker;e&&(e.autoCreated&&(a.queryMode="local",a.valueField=a.displayField="field1",e.expanded||(a.displayField="field2")),Ext.isDefined(a.valueField)||(a.valueField=a.displayField),l={byValue:{rootProperty:"data",unique:!1}},l.byValue.property=a.valueField,e.setExtraKeys(l),a.displayField===a.valueField?e.byText=e.byValue:(l.byText={rootProperty:"data",unique:!1},l.byText.property=a.displayField,e.setExtraKeys(l)),i={rootProperty:"data",extraKeys:{byInternalId:{property:"internalId"},byValue:{property:"",rootProperty:"data"}},listeners:{beginupdate:a.onValueCollectionBeginUpdate,endupdate:a.onValueCollectionEndUpdate,scope:a}},i.extraKeys.byValue.property=a.valueField,a.valueCollection=new Ext.util.Collection(i),a.pickerSelectionModel=a.multiSelect?new Ext.selection.CheckboxModel({mode:"SIMPLE",enableInitialSelection:!1,pruneRemoved:!1,selected:a.valueCollection,store:e}):new Ext.selection.DataViewModel({mode:"SINGLE",enableInitialSelection:!1,pruneRemoved:!1,selected:a.valueCollection,store:e}),t||a.resetToDefault(),o&&(o.setSelectionModel(a.pickerSelectionModel),o.getStore()!==e&&o.bindStore(e)))}});
Ext.define("Fm.ux.form.ComboGridField",{extend:"Ext.form.field.Picker",alias:["widget.combogridfield"],twoWayBindable:["value"],editable:!0,emptyText:"全部",showClearTriggers:!0,multiSelect:!0,isHandleAllValue:!1,multiAllValue:null,valueIsArray:!1,valueIsString:!1,valueSplitChar:",",applyTriggers:function(e){var t=this;return e={clear:{cls:"cisapp-form-field-clear",renderTpl:'<div id="{triggerId}" class="{baseCls} {baseCls}-{ui} {cls}"></div>',handler:"onClearClick",scope:"this",focusOnMousedown:!0},picker:{cls:t.triggerCls,handler:"onTriggerClick",scope:"this",focusOnMousedown:!0}},t.showClearTriggers||delete e.clear,t.callParent([e])},onClearClick:function(e){this.clearValue()},createPicker:function(){var e,t,l,i=this;return i.picker?i.picker:(t=i.multiSelect?{selType:"checkboxmodel",mode:"SIMPLE",allowDeselect:!0}:{mode:"SINGLE",allowDeselect:!1},t.listeners={selectionchange:i.onItemSelect,scope:i},l={id:i.id+"-picker",pickerField:i,floating:!0,hidden:!0,minWidth:i.minPickerWidth,minHeight:i.minPickerHeight,maxHeight:i.maxPickerHeight,selModel:t,listeners:{}},i.originalCollapse=i.collapse,l.listeners.show=i.multiSelect?{fn:function(){i.grid.el.on({mouseover:function(){this.collapse=Ext.emptyFn},mouseout:function(){this.collapse=this.originalCollapse},scope:i})}}:{fn:function(){i.grid.el.on({mousedown:function(){this.collapse=Ext.emptyFn},mouseup:function(){this.collapse=this.originalCollapse},scope:i})}},e=i.picker=i.grid=Ext.ComponentManager.create(Ext.apply(i.innerGrid,l),"treepanel"))},onItemSelect:function(){var e=this,t=e.grid,l=t.getSelectionModel(),i=l.getSelection();e._isSelSet=!0,e.setConvertValue(i),e._isSelSet=!1,e.multiSelect||e.collapse()},clearValue:function(){var e,t=this,l=t.picker;t.setValue(null),t.setRawValue(""),t.lastMutatedValue=null,l&&(e=l.getSelectionModel(),e.deselectAll())},onFieldMutation:function(e){var t=this,l=e.getKey(),i=l===e.BACKSPACE||l===e.DELETE,r=l===e.CTRL,a=t.inputEl.dom.value,n=a.length;t.readOnly||a===t.lastMutatedValue&&!i||l===e.TAB||(t.lastMutatedValue=a,t.lastKey=l,n&&("keyup"!==e.type||!e.isSpecialKey()||i||r)?(t._isInputSet=!0,t.setValue(a),t._isInputSet=!1):t.clearValue())},getStore:function(){var e,t=this,l=t.getPicker(),i=l.getBind();if(i&&i.store&&(e=l.getBind().store.getValue()),!e||e.isEmptyStore){var r=l.getController();r&&r.getGridStore&&(e=r.getGridStore())}return(!e||e.isEmptyStore)&&(e=l?l.getStore():void 0),e},getValue:function(){return this.value},setValue:function(e){var t,l,i=this,r="";if(t=i.getBind(),l=t&&t.value,l&&l.syncing){if(Ext.isEmpty(e)&&Ext.isEmpty(i.value)||e===i.value)return i;if(Ext.isArray(e)&&Ext.isArray(i.value)&&Ext.Array.equals(e,i.value))return i}if(i.value=i.valueToTrueValue(e),i.value&&(r=Ext.isArray(i.value)?i.value.join(","):i.value.toString()),i.setRawValue(r),i.checkChange(),i.refreshEmptyText(),i.isChangeSelect=!i._isSelSet&&!i._isInputSet&&null!==e&&void 0!==e,i.isChangeSelect){{i.getStore()}i.doAutoSelect(),i.isChangeSelect=!1}return i},doAutoSelect:function(){var e=this,t=e.picker,l=t.getSelectionModel(),i=e.getStore(),r=e.value,a=[];if(e.isChangeSelect){var n=function(){e.destroying||e.destroyed||(a=e.findRecordByValue(r),a&&a.length>0&&(l.select(a,!1,!0),e.setRawValue(e.getDisplayText(a))))};!i.isEmptyStore&&i.isLoaded()?n():i.on("load",n,e,{single:!0})}},findRecordByValue:function(e){var t=this,l=this.getAllRecord(),i=e,r=[];return e?(Ext.isArray(e)||(t.multiSelect&&t.valueIsString&&(i=e.split(t.valueSplitChar)),t.multiSelect||(i=[e])),Ext.Array.filter(l,function(e){var l=Ext.Array.findBy(i,function(l){return l==e.get(t.valueField)});l&&r.push(e)}),r):r},getAllRecord:function(){return this.getStore().getDataSource().items},getAllRecordLength:function(){return this.getStore().getCount()},getDisplayText:function(e){var t=this,l="";if(t.multiSelect){tempText=[];for(var i=0;i<e.length;i++)tempText.push(e[i].get(t.displayField));l=tempText.join(",")}else e.length>0&&(l=e[0].get(t.displayField));return l},recordToValue:function(e){var t=this,l=null;if(t.multiSelect){l=[];for(var i=0;i<e.length;i++)l.push(e[i].get(t.valueField));t.isHandleAllValue&&t.getAllRecordLength()===e.length&&(l=t.multiAllValue),t.valueIsString&&Ext.isArray(l)&&(l=l.join(t.valueSplitChar))}else e.length>0&&(l=e[0].get(t.valueField),(t.valueIsArray||t.singleIsArray)&&(l=[l]));return l},valueToTrueValue:function(e){var t=this,l=e;return t.multiSelect&&!t.valueIsString&&e&&Ext.isString(e)&&(l=e.split(t.valueSplitChar)),t.multiSelect&&t.valueIsString&&e&&Ext.isArray(e)&&(l=e.join(t.valueSplitChar)),!t.multiSelect&&(t.valueIsArray||t.singleIsArray)&&e&&Ext.isString(e)&&(l=[e]),t.multiSelect||t.valueIsArray||t.singleIsArray||!e||!Ext.isArray(e)||(l=e.join(t.valueSplitChar)),l||(l=null),l},setConvertValue:function(e){var t=this,l=t.recordToValue(e),i=t.getDisplayText(e);t.setValue(l),t.setRawValue(i),t.callbackChecked&&t.callbackChecked(e)}});
Ext.define("Fm.ux.form.ComboTreeField",{extend:"Fm.ux.form.ComboGridField",alias:["widget.combotreefield"],valueIsContainRoot:!1,createPicker:function(){var e,t,i=this;return t={id:i.id+"-picker",pickerField:i,floating:!0,hidden:!0,hideHeaders:!0,useArrows:!0,rowLines:!0,disableSelection:!0,minWidth:i.minPickerWidth,minHeight:i.minPickerHeight,maxHeight:i.maxPickerHeight,listeners:{itemclick:i.onItemClick,scope:i}},i.multiSelect&&!i.valueIsContainRoot&&(t.viewConfig={getRowClass:function(e,t,i,o){var c="";return e.get("leaf")||(c+="x-fm-tree-root"),c?c:void 0}}),i.originalCollapse=i.collapse,t.listeners.show=i.multiSelect?{fn:function(){i.grid.el.on({mouseover:function(){this.collapse=Ext.emptyFn},mouseout:function(){this.collapse=this.originalCollapse},scope:i})}}:{fn:function(){i.grid.el.on({mousedown:function(){this.collapse=Ext.emptyFn},mouseup:function(){this.collapse=this.originalCollapse},scope:i})}},e=i.picker=i.grid=Ext.ComponentManager.create(Ext.apply(i.innerGrid,t),"treepanel")},onItemClick:function(e,t,i,o,c,n){var l,a=this,d=a.grid,r=Ext.get(c.target);if(a.multiSelect)t.get("leaf")?(r.hasCls("x-tree-checkbox")||t.set("checked",!t.get("checked")),Ext.Array.contains(a.selectModel,"c-p")&&a.checkedParent(t)):r.hasCls("x-tree-checkbox")?(t.get("expanded")||d.expandNode(t),Ext.Array.contains(a.selectModel,"p-c")&&a.checkedChild(t),c.stopEvent()):t.get("expanded")?d.collapseNode(t):d.expandNode(t);else if(!a.valueIsContainRoot&&!t.get("leaf"))return void(t.get("expanded")?d.collapseNode(t):d.expandNode(t));a.multiSelect?(l=d.getChecked(),a.valueIsContainRoot||(l=Ext.Array.filter(l,function(e){return e.get("leaf")}))):l=[t],a._isSelSet=!0,a.setConvertValue(l),a._isSelSet=!1,a.multiSelect||a.collapse()},checkedChild:function(e,t){for(var i=t||e.get("checked"),o=0;o<e.childNodes.length;o++){var c=e.childNodes[o].get("checked");c!=i&&e.childNodes[o].set("checked",!e.childNodes[o].get("checked")),e.childNodes[o].childNodes.length>0&&this.checkedChild(e.childNodes[o])}},checkedParent:function(e){if(e.parentNode){var t=!1;e.parentNode.eachChild(function(e){return e.get("checked")?(t=!0,!1):void 0}),e.parentNode.set("checked",t),e.parentNode.parentNode&&this.checkedParent(e.parentNode)}},clearTreeChecked:function(){var e,t=this,i=t.picker;i&&(e=i.getChecked(),e&&Ext.each(e,function(e){e.set("checked",!1)}))},clearValue:function(){this.setValue(null),this.clearTreeChecked(),this.setRawValue(""),me.lastMutatedValue=null},getAllRecord:function(){var e=this,t=(e.grid,e.getStore()),i=t.getRoot(),o=[],c=function(t){if(t.get("leaf"))o.push(t);else{e.valueIsContainRoot&&o.push(t);for(var i=0;i<t.childNodes.length;i++)c(t.childNodes[i])}};return c(i),o},getAllRecordLength:function(){var e=this,t=e.grid,i=0;return t.getView().node.cascade(function(t){(e.valueIsContainRoot||t.get("leaf"))&&i++}),i},doAutoSelect:function(){var e=this,t=(e.getPicker(),e.getStore()),i=e.getAllRecord(),o=e.value,c=[];if(e.isChangeSelect){var n=function(){e.destroying||e.destroyed||!e.multiSelect||(Ext.Array.each(i,function(e){e.set("checked",!1)}),c=e.findRecordByValue(o),Ext.Array.each(c,function(t){t.set("checked",!0),t.get("leaf")?Ext.Array.contains(e.selectModel,"c-p")&&e.checkedParent(t):Ext.Array.contains(e.selectModel,"p-c")&&e.checkedChild(t)}),e.setRawValue(e.getDisplayText(c)))};t.isEmptyStore?t.on("load",n,e,{single:!0}):n()}}});
Ext.define("Fm.ux.form.ComboTreeGrid",{extend:"Fm.ux.form.ComboGrid",alias:["widget.comboxtreegrid","widget.combotreegrid"],requires:["Ext.tree.Panel"],editable:!1,multiSelect:!0,valueIsContainRoot:!1,selectModel:[],isAutoExpandFirst:!0,isHandleAllValue:!0,multiAllValue:[],initComponent:function(){var e=this;Ext.log.warn("Fm.ux.form.ComboTreeGrid 不建议继续使用，替代：Fm.ux.form.ComboTreeField"),e.multiAllTempValue=e.multiAllValue,e.callParent(arguments)},listeners:{afterrender:function(){var e=this;if(e.fakeStore){var t=e.getForData(e.fakeStore);e.store=t&&1===t.length?Ext.create("Ext.data.TreeStore",{fields:["value","text"],root:{text:t[0].text||"全部",value:-1,expanded:!0,checked:t[0].checked,children:t[0].children}}):Ext.create("Ext.data.TreeStore",{fields:["value","text"],root:{text:"全部",value:-1,expanded:!0,checked:!1,children:t}})}}},getForData:function(e){var t=function(e,l){for(var o=[],i=0,n=0;n<e.length;n++)if(e[n].IsAlloted===!0){if(!(Ext.isArray(e[n].Children)&&e[n].Children.length>0)){var r=[];return Ext.each(e,function(e){if(e&&e.IsAlloted===!0){var t={value:e.Id,text:e.Name,Id:e.Id,leaf:!0,checked:!1};r.push(t)}}),r}o[i]={value:e[n].Id,text:e[n].Name,leaf:e[n].Children.length>0?!1:!0,checked:!1,children:t(e[n].Children,e[n].Name)},i+=1}return o};return t(e)},createPicker:function(){var e,t=this;return e=t.picker=t.getGridPicker(),t.pageSize&&e.pagingToolbar.on("beforechange",t.onPageChange,t),e.initialConfig.maxHeight||e.on({beforeshow:t.onBeforePickerShow,scope:t}),e.getNavigationModel().navigateOnSpace=!1,e},getAllLength:function(){var e,t=this;return t.allLength?t.allLength:(e=t.getStore(),e&&"ext-empty-store"!==e.storeId||(e=t.getBind().store.getValue()),t.getTreeStoreLen(e))},getTreeStoreLen:function(e){var t=this,l=0,o=e.getRootNode(),i=function(e){if(e.get("leaf")!==!0){t.valueIsContainRoot&&l++;for(var o=0;o<e.childNodes.length;o++)i(e.childNodes[o])}else l++};return i(o),l},getGridPicker:function(){var e=this,t=Ext.apply(e.innerGrid,{pickerField:e,hidden:!0,store:e.store,displayField:e.displayField,pageSize:e.pageSize,selModel:e.pickerSelectionModel,floating:!0,minWidth:e.minPickerWidth,minHeight:e.minPickerHeight,maxHeight:e.maxPickerHeight,autoScroll:!0,allowDeselect:!1,listeners:{checkchange:{fn:e.onSelectItem,scope:e},render:function(){if(e.isAutoExpandFirst){var t;if(this.store.rootVisible)t=this.store.root;else{var l=this.store.data.item;l&&1===l.length&&(t=this.store.data.item[0])}t&&t.isExpanded()===!1&&t.expand()}}},hideHeaders:!0,useArrows:!0,columns:[{xtype:"treecolumn",flex:1,notAutoWidth:!0,dataIndex:e.displayField,renderer:function(e,t){return t&&(t.tdAttr='data-qtip="'+e+'"'),e}}],refresh:function(){}});e.originalCollapse=e.collapse,t.listeners.show={fn:function(){e.picker.el.on({mouseover:function(){this.collapse=Ext.emptyFn},mouseout:function(){this.collapse=this.originalCollapse},scope:e})}};var l=Ext.ComponentManager.create(Ext.isFunction(t)?t.call():t,"panel");return l},checkedNode:function(e,t){e.set("checked",t),this.selectNode(e,t)},selectNodeRecord:function(e,t){t?(e.get("checked")===!0||e.get("checked")===!1)&&e.set("checked",!0):(e.get("checked")===!0||e.get("checked")===!1)&&e.set("checked",!1)},selectNode:function(e,t){var l=this,o=l.pickerSelectionModel;(l.valueIsContainRoot||e.isLeaf())&&(l.selectNodeRecord(e,t),t?o.select(e,!0,!0):o.deselect(e,!0))},checkedChild:function(e,t){for(var l=t||e.get("checked"),o=0;o<e.childNodes.length;o++){var i=e.childNodes[o].get("checked");i!=l&&this.checkedNode(e.childNodes[o],l),e.childNodes[o].childNodes.length>0&&this.checkedChild(e.childNodes[o])}},checkedParent:function(e){if(e.parentNode){var t=!1;e.parentNode.eachChild(function(e){return e.get("checked")?(t=!0,!1):void 0}),this.checkedNode(e.parentNode,t),e.parentNode.parentNode&&this.checkedParent(e.parentNode)}},onSelectItem:function(e,t,l){{var o=this;o.picker,o.pickerSelectionModel}Ext.Array.contains(o.selectModel,"p-c")&&o.checkedChild(e),Ext.Array.contains(o.selectModel,"c-p")&&o.checkedParent(e),this.selectNode(e,t)},clearTreeChecked:function(){var e,t=this,l=t.picker;l&&(e=l.getChecked(),e&&(Ext.each(e,function(e){e.set("checked",!1)}),t.pickerSelectionModel.deselectAll()))},getTreeStoreAllData:function(){var e=this,t=[],l=e.getStore(),o=l.getRootNode(),i=function(l){if(l.isLeaf())t.push(l);else{e.valueIsContainRoot&&t.push(l);for(var o=0;o<l.childNodes.length;o++)i(l.childNodes[o])}};return i(o),t},onBindStore:function(e,t){var l,o,i=this,n=i.picker;e&&(e.autoCreated&&(i.queryMode="local",i.valueField=i.displayField="field1",e.expanded||(i.displayField="field2")),Ext.isDefined(i.valueField)||(i.valueField=i.displayField),l={byValue:{rootProperty:"data",unique:!1}},l.byValue.property=i.valueField,e.setExtraKeys(l),i.displayField===i.valueField?e.byText=e.byValue:(l.byText={rootProperty:"data",unique:!1},l.byText.property=i.displayField,e.setExtraKeys(l)),o={rootProperty:"data",extraKeys:{byInternalId:{property:"internalId"},byValue:{property:"",rootProperty:"data"}},listeners:{beginupdate:i.onValueCollectionBeginUpdate,endupdate:i.onValueCollectionEndUpdate,scope:i}},o.extraKeys.byValue.property=i.valueField,i.valueCollection=new Ext.util.Collection(o),i.pickerSelectionModel=i.multiSelect?new Ext.selection.Model({mode:"SIMPLE",enableInitialSelection:!1,checkOnly:!0,selected:i.valueCollection,store:e}):new Ext.selection.DataViewModel({mode:"SINGLE",enableInitialSelection:!1,pruneRemoved:!1,selected:i.valueCollection,store:e}),t||i.resetToDefault(),n&&n.getStore()!==e&&n.bindStore(e))},doAutoSelect:function(){},getRecordByValue:function(e,t){var l=this,o=null;if(!e||!e.length)return o;for(var i=0;i<e.length;i++){if(e[i].get(l.valueField)==t)return e[i];if(e[i].childNodes&&(o=l.getRecordByValue(e[i].childNodes,t),null!=o))return o}return o},findRecordByValue:function(e){var t=this.getRecordByValue(this.store.data.items,e),l=!1;return t&&(l=t[0]||t),l},doSetValue:function(e,t){var l,o,i,n,r,a,d=this,c=d.getStore(),s=c.getModel(),u=[],h=[],f=d.autoLoadOnValue,p=c.getCount()>0||c.isLoaded(),g=c.hasPendingLoad(),v=f&&!p&&!g,x=d.forceSelection,m=(d.pickerSelectionModel,d.displayField===d.valueField),k=c.isEmptyStore,y=d.lastSelection;if(t&&!d.multiSelect&&Ext.raise("Cannot add values to non multiSelect ComboBox"),(g||v||!p||k)&&(e.isModel||(d.value=t?Ext.Array.from(d.value).concat(e):e,d.setHiddenValue(d.value),d.setRawValue(m?e:"")),v&&!k&&c.load(),!e.isModel||k))return d;for(e=t?Ext.Array.from(d.value).concat(e):Ext.Array.from(e),l=0,o=e.length;o>l;l++)i=e[l],i&&i.isModel||(i=d.findRecordByValue(a=i),i||(i=d.valueCollection.find(d.valueField,a))),i||(x?d.valueNotFoundRecord&&(i=d.valueNotFoundRecord):!i&&e[l]&&(n={},n[d.displayField]=e[l],d.valueField&&d.displayField!==d.valueField&&(n[d.valueField]=e[l]),i=new s(n))),i&&(u.push(i),h.push(i.get(d.valueField)));if(y)if(o=y.length,o===u.length)for(l=0;!r&&o>l;l++)-1===Ext.Array.indexOf(d.lastSelection,u[l])&&(r=!0);else r=!0;else r=u.length;if(r){if(!d.picker){d.getPicker()}if(d.suspendEvent("select"),d.valueCollection.beginUpdate(),u.length)for(var l=0;l<u.length;l++)d.onSelectItem(u[l],!0);else d.onSelectItem(c.getRoot(),!1);d.valueCollection.endUpdate(),d.resumeEvent("select")}else d.updateValue();return d}});
Ext.define("Fm.ux.form.DateTimePicker",{extend:"Ext.picker.Date",requires:["Ext.form.field.Number"],alias:"widget.datetimepicker",hideOnSelect:!1,todayText:"现在",okText:"确定",okTip:"确定选择时间",beforeDestroy:function(){var e=this;e.rendered&&Ext.destroy(e.TimeContainer),e.callParent()},initEvents:function(){var e=this,t=(e.pickerField,Ext.Date),a=t.DAY;e.keyNavConfig=Ext.apply(e.keyNavConfig,{down:function(i){e.update(t.add(e.activeDate,a,7))},pageDown:function(t){e.showNextMonth()},space:function(e){var t=this;return t.TimeContainer?(t.TimeContainer.down("combo[itemId=hours]").focus(),!1):void 0},tab:function(){return!1}}),e.callParent()},beforeRender:function(){var e=this,t=(Ext.Date.format(new Date,e.format),function(e){return Ext.create("Ext.data.Store",{fields:["Text","Value"],data:function(){for(var t=[],a=0;e>a;a++){var i=a.toString();1===i.length&&(i="0"+i),t.push({Text:i,Value:a})}return t}()})}),a={};e.pickerField&&(a=e.pickerField),e.TimeContainer=Ext.create("Ext.container.Container",{scope:e,ownerCt:e,ownerLayout:e.getComponentLayout(),layout:"column",ariaRole:"presentation",padding:"0 0 0 15",defaults:{xtype:"combo",editable:!1,enableKeyEvents:!0,displayField:"Text",valueField:"Value",showClearTriggers:!1,width:40},items:[{value:null==a.lastValue?(new Date).getHours():Ext.Date.format(e.pickerField.lastValue,"H"),listeners:{keydown:function(e,t,a){t.getKey()==Ext.event.Event.SPACE&&(e.next().next().focus(),t.stopEvent())}},store:t(24),itemId:"hours",name:"time"},{xtype:"label",text:":",width:6},{value:null==a.lastValue?(new Date).getMinutes():Ext.Date.format(e.pickerField.lastValue,"i"),store:t(60),listeners:{keydown:function(e,t,a){t.getKey()==Ext.event.Event.SPACE&&(e.next().next().focus(),t.stopEvent())}},itemId:"minutes",name:"time"},{xtype:"label",text:":",width:6},{value:null==a.lastValue?(new Date).getSeconds():Ext.Date.format(e.pickerField.lastValue,"s"),store:t(60),listeners:{keydown:function(e,t,a){t.getKey()==Ext.event.Event.SPACE&&(e.next().focus(),t.stopEvent())}},itemId:"seconds",name:"time"},{ui:"default-toolbar",xtype:"button",text:"确认",width:45,handler:e.selectTime,scope:e,name:"time"}]}),e.callParent()},setValue:function(e){return Ext.isDate(e)||(e=Ext.Date.parse(e||new Date,this.format)),this.value=e,this.update(this.value)},getTimeSp:function(){var e=this;if(e.TimeContainer){var t=60*parseInt(e.TimeContainer.down("combo[itemId=hours]").getValue(),10)*60,a=60*parseInt(e.TimeContainer.down("combo[itemId=minutes]").getValue(),10),i=parseInt(e.TimeContainer.down("combo[itemId=seconds]").getValue(),10);return t+a+i}return 0},handleTabKey:function(e){var t=this,a=t.getSelectedDate(t.activeDate),i=t.handler;t.disabled||!a.dateValue||Ext.fly(a.parentNode).hasCls(t.disabledCellCls)?t.fireEventArgs("tabout",[t]):(t.setValue(Ext.Date.add(new Date(a.dateValue),Ext.Date.SECOND,t.getTimeSp())),t.fireEvent("select",t,t.value),i&&Ext.callback(i,t.scope,[t,t.value],null,t,t),t.pickerField&&t.pickerField.isEditorComponent&&e.preventDefault(),t.onSelect())},handleDateClick:function(e,t){var a=this,i=a.handler;e.stopEvent(),a.disabled||!t.dateValue||Ext.fly(t.parentNode).hasCls(a.disabledCellCls)||(a.setValue(Ext.Date.add(new Date(t.dateValue),Ext.Date.SECOND,a.getTimeSp())),i&&Ext.callback(i,a.scope,[a,a.value],null,a,a),a.onSelect())},selectedUpdate:function(e){var t=this,a=e.getTime();t.callParent([Ext.Date.clearTime(new Date(a))]),t.TimeContainer&&(t.TimeContainer.down("combo[itemId=hours]").setValue(e.getHours()),t.TimeContainer.down("combo[itemId=minutes]").setValue(e.getMinutes()),t.TimeContainer.down("combo[itemId=seconds]").setValue(e.getSeconds()))},selectToday:function(){var e=this,t=e.todayBtn,a=e.handler;return t&&!t.disabled&&(e.setValue(new Date),e.fireEvent("select",e,e.value),a&&Ext.callback(a,e.scope,[e,e.value],null,e,e),e.onSelect()),e},selectTime:function(e,t){if(t.getKey()==Ext.event.Event.SPACE)return void this.focus();var a=this,i=a.handler,n=a.activeDate,r=Ext.Date.add(Ext.Date.clearTime(new Date(n)),Ext.Date.SECOND,a.getTimeSp());return a.setValue(r),a.fireEvent("select",a,a.value),i&&Ext.callback(i,a.scope,[a,a.value],null,a,a),a.onSelect(),a},renderTpl:['<div id="{id}-innerEl" data-ref="innerEl" role="presentation">','<div class="{baseCls}-header">','<div id="{id}-prevEl" data-ref="prevEl" class="{baseCls}-prev {baseCls}-arrow" role="presentation" title="{prevText}"></div>','<div id="{id}-middleBtnEl" data-ref="middleBtnEl" class="{baseCls}-month" role="heading">{%this.renderMonthBtn(values, out)%}</div>','<div id="{id}-nextEl" data-ref="nextEl" class="{baseCls}-next {baseCls}-arrow" role="presentation" title="{nextText}"></div>',"</div>",'<table role="grid" id="{id}-eventEl" data-ref="eventEl" class="{baseCls}-inner" cellspacing="0" tabindex="0" aria-readonly="true">',"<thead>",'<tr role="row">','<tpl for="dayNames">','<th role="columnheader" class="{parent.baseCls}-column-header" aria-label="{.}">','<div role="presentation" class="{parent.baseCls}-column-header-inner">{.:this.firstInitial}</div>',"</th>","</tpl>","</tr>","</thead>","<tbody>",'<tr role="row">','<tpl for="days">',"{#:this.isEndOfWeek}",'<td role="gridcell">','<div hidefocus="on" class="{parent.baseCls}-date"></div>',"</td>","</tpl>","</tr>","</tbody>","</table>",'<div id="{id}-timeContainer" data-ref="footerEl" class="{baseCls}-footer">{%this.renderTimeField(values, out)%}</div>','<tpl if="showToday">','<div id="{id}-footerEl" data-ref="footerEl" role="presentation" class="{baseCls}-footer">{%this.renderTodayBtn(values, out)%}</div>',"</tpl>",'<div id="{id}-todayText" class="'+Ext.baseCSSPrefix+'hidden-clip">{todayText}.</div>','<div id="{id}-ariaMinText" class="'+Ext.baseCSSPrefix+'hidden-clip">{ariaMinText}.</div>','<div id="{id}-ariaMaxText" class="'+Ext.baseCSSPrefix+'hidden-clip">{ariaMaxText}.</div>','<div id="{id}-ariaDisabledDaysText" class="'+Ext.baseCSSPrefix+'hidden-clip">{ariaDisabledDaysText}.</div>','<div id="{id}-ariaDisabledDatesText" class="'+Ext.baseCSSPrefix+'hidden-clip">{ariaDisabledDatesText}.</div>',"</div>",{firstInitial:function(e){return Ext.picker.Date.prototype.getDayInitial(e)},isEndOfWeek:function(e){e--;var t=e%7===0&&0!==e;return t?'</tr><tr role="row">':""},renderTodayBtn:function(e,t){Ext.DomHelper.generateMarkup(e.$comp.todayBtn.getRenderTree(),t)},renderMonthBtn:function(e,t){Ext.DomHelper.generateMarkup(e.$comp.monthBtn.getRenderTree(),t)},renderTimeField:function(e,t){Ext.DomHelper.generateMarkup(e.$comp.TimeContainer.getRenderTree(),t)}}],privates:{finishRenderChildren:function(){var e=this;e.callParent(),e.TimeContainer.finishRender()}}}),Ext.define("Fm.ux.form.DateTimeField",{extend:"Ext.form.field.Date",alias:"widget.datetimefield",requires:["Ext.form.field.Date"],format:"Y-m-d H:i:s",createPicker:function(){var e,t=this,a=Ext.String.format;return e={pickerField:t,floating:!0,preventRefocus:!1,hidden:!0,minDate:t.minValue,maxDate:t.maxValue,disabledDatesRE:t.disabledDatesRE,disabledDatesText:t.disabledDatesText,ariaDisabledDatesText:t.ariaDisabledDatesText,disabledDays:t.disabledDays,disabledDaysText:t.disabledDaysText,ariaDisabledDaysText:t.ariaDisabledDaysText,format:t.format,showToday:!1,startDay:t.startDay,minText:a(t.minText,t.formatDate(t.minValue)),ariaMinText:a(t.ariaMinText,t.formatDate(t.minValue,t.ariaFormat)),maxText:a(t.maxText,t.formatDate(t.maxValue)),ariaMaxText:a(t.ariaMaxText,t.formatDate(t.maxValue,t.ariaFormat)),listeners:{scope:t,select:t.onSelect},keyNavConfig:{esc:function(){t.inputEl.focus(),t.collapse()}}},t.originalCollapse=t.collapse,e.listeners.show={fn:function(){this.picker.el.on({mousedown:function(){this.collapse=Ext.emptyFn},mouseup:function(){this.collapse=this.originalCollapse},scope:this})}},t.picker=new Fm.ux.form.DateTimePicker(e),t.picker}});
Ext.define("Fm.ux.Year",{extend:"Ext.picker.Month",alias:"widget.Year",isYearPicker:!0,totalYears:12,renderTpl:['<div id="{id}-bodyEl" data-ref="bodyEl" class="{baseCls}-body">','<div id="{id}-monthEl" data-ref="monthEl" class="{baseCls}-months" style="display:none">','<tpl for="months">','<div class="{parent.baseCls}-item {parent.baseCls}-month">','<a style="{parent.monthStyle}" role="button" hidefocus="on" class="{parent.baseCls}-item-inner">{.}</a>',"</div>","</tpl>","</div>",'<div id="{id}-yearEl" data-ref="yearEl" class="{baseCls}-years" style="width:100%">','<div class="{baseCls}-yearnav">','<div class="{baseCls}-yearnav-button-ct">','<a id="{id}-prevEl" data-ref="prevEl" class="{baseCls}-yearnav-button {baseCls}-yearnav-prev" hidefocus="on" role="button"></a>',"</div>",'<div class="{baseCls}-yearnav-button-ct">','<a id="{id}-nextEl" data-ref="nextEl" class="{baseCls}-yearnav-button {baseCls}-yearnav-next" hidefocus="on" role="button"></a>',"</div>","</div>",'<tpl for="years">','<div class="{parent.baseCls}-item {parent.baseCls}-year">','<a hidefocus="on" class="{parent.baseCls}-item-inner" role="button">{.}</a>',"</div>","</tpl>","</div>",'<div class="'+Ext.baseCSSPrefix+'clear"></div>','<tpl if="showButtons">','<div class="{baseCls}-buttons">{%',"var me=values.$comp, okBtn=me.okBtn, cancelBtn=me.cancelBtn;","okBtn.ownerLayout = cancelBtn.ownerLayout = me.componentLayout;","okBtn.ownerCt = cancelBtn.ownerCt = me;","Ext.DomHelper.generateMarkup(okBtn.getRenderTree(), out);","Ext.DomHelper.generateMarkup(cancelBtn.getRenderTree(), out);","%}</div>","</tpl>","</div>"],okText:"确定",cancelText:"取消",width:210,onYearClick:function(e,t){var a=this;a.value[1]=a.activeYear+a.years.indexOf(e),a.updateBody(),a.fireEvent("year"+(t?"dbl":"")+"click",a,a.value),a.fireEvent("select",a,a.value)},getYears:function(){for(var e=this,t=e.activeYear,a=t+12,n=t,s=[];a>n;++n)s.push(n,++n);return s}}),Ext.define("Fm.ux.form.DateYearField",{extend:"Ext.form.field.Date",alias:"widget.dateyearfield",requires:["Fm.ux.Year"],format:"Y",formatText:"日期格式要求为年份",createPicker:function(){{var e,t=this;Ext.String.format}return e={ownerCmp:t,floating:!0,hidden:!0,small:!0,listeners:{scope:t,cancelclick:t.collapse,okclick:t.onYearSelect,yeardblclick:t.onYearSelect},keyNavConfig:{esc:function(){t.collapse()}}},t.originalCollapse=t.collapse,e.listeners.show={fn:function(){this.picker.el.on({mousedown:function(){this.collapse=Ext.emptyFn},mouseup:function(){this.collapse=this.originalCollapse},scope:this})}},t.pickerOptions&&Ext.apply(e,t.pickerOptions,t.monthPickerOptions||{}),Ext.create("Fm.ux.Year",e)},onYearSelect:function(e,t){var a=this,n=t[0],s=t[1],l=new Date(s,n,1);l.getMonth()!==n&&(l=new Date(s,n,1).getLastDateOfMonth()),a.setValue(l),a.fireEvent("select",a,l),a.collapse()}});
Ext.define("Fm.ux.form.FileUpload",{extend:"Ext.form.field.File",alias:["widget.fileupload"],alternateClassName:["Ext.form.FileUploadField","Ext.ux.form.FileUploadField","Ext.form.File"],requires:["Ext.form.field.FileButton","Ext.form.trigger.Component"],needArrowKeys:!1,auto:null,multiple:!1,compressMode:!1,uploader:null,progressBar:null,fileName:null,AllFiles:[],dateSeparate:!0,filePrevious:[],onRender:function(){var e=this;e.callParent(arguments),e.rendWebUpload(e.button.id)},setProgressBar:function(e){var t=this;t.progressBar=e},startUpload:function(e){var t=this,r=t.uploader;e="function"==typeof e?{callback:e}:Ext.apply({},e),r&&r.upload(),Ext.apply(t,e)},stopUpload:function(){var e=this,t=e.uploader;t&&t.stop(!0)},retryUpload:function(){var e=this,t=e.uploader;t&&t.retry()},removeFile:function(){var e=this,t=e.uploader;e.setTextContent(),t&&(Ext.Array.each(e.filePrevious,function(e){t.removeFile(e,!0)}),t.reset())},cancelFile:function(){var e=this,t=e.uploader;t&&t.isInProgress()&&t.cancelFile(t.getFiles("progress"))},getFiles:function(){var e=this,t=e.uploader;return t?t.getFiles("inited"):void 0},getFileName:function(){var e=this;return e.fileName},setFileName:function(e){var t=this,r=t.uploader;t.fileName=e,r.option("formData",{fileName:e})},setTextContent:function(e){var t=this,r="";Ext.Array.each(e,function(e){r=r+","+e.name}),r.length>0&&(r=r.substring(1)),t.setRawValue(r),t.fireEvent("fileChange",r)},rendWebUpload:function(e){var t,r,o=this,a=o.dateSeparate,i=!0,l=1048576;o.progressBar?o.progressBar.hide():i=!1,WebUploader.Uploader.register({"before-send":"checkchunk"},{checkchunk:function(e){var r=(e.blob.getSource(),this.owner,WebUploader.Deferred());return Ext.Ajax.request({url:"fmshared/file/chunkcheck",method:"post",params:{guid:t,chunk:e.chunk,fileName:e.file.name},success:function(e){var t=Ext.util.JSON.decode(e.responseText);t.isSuccess?r.reject():r.resolve()}}),r.promise()}});var s=WebUploader.create({auto:o.auto,swf:AppConfig.urlStartWith+"lib/webuploader/Uploader.swf",server:AppConfig.urlStartWith+"fmshared/file/upload",chunkSize:l,chunked:!0,chunkRetry:1,threads:1,fileSingleSizeLimit:o.fileSingleSizeLimit,resize:!1,duplicate:!0,formData:{savePath:o.savePath,compressMode:o.compressMode,chunkSize:l},pick:{multiple:o.multiple,id:"#"+e},accept:{extensions:o.extensions}});o.uploader=s,s.on("error",function(e){Fm.msg.info("F_DUPLICATE"===e?"文件重复添加":"Q_TYPE_DENIED"===e?"文件类型选择出错，请重试":"F_EXCEED_SIZE"===e?"文件过大，请压缩后再进行上传":"出错"+e)}),s.on("uploadProgress",function(e,t){var r,a=Math.floor(100*t);o.progressBar&&(o.progressBar.show(),r=100===a?1:t,o.progressBar.setValue(r,""+e.name+"　正在处理文件..."))}),s.on("filesQueued",function(e){if(o.setTextContent(e),o.filePrevious&&Ext.Array.each(o.filePrevious,function(e){s.removeFile(e.id)}),o.filePrevious=e,t=Fm.Common.Util.Guid().replace(/\s/g,""),a){var i=Fm.Common.Util.getNowDate();r=Ext.util.Format.date(i,"Y-m-d"),s.option("formData",{guid:t,datePath:r})}else s.option("formData",{guid:t})}),s.on("uploadSuccess",function(e,t){s.removeFile(e),i&&o.progressBar.hide(),Ext.Ajax.request({url:"fmshared/file/UploadSuccess",async:!1,method:"post",params:{fileName:t.name,businessPath:o.savePath,datePath:r,compressMode:o.compressMode},success:function(e){var t=Ext.util.JSON.decode(e.responseText);t.IsSuccess?o.AllFiles=t.Result.reduce(function(e,t){return e.push(t),e},o.AllFiles):Fm.msg.info("附件上传失败")}})}),s.on("uploadFinished",function(){o.setTextContent(),s.reset(),o.filePrevious=[],o.fireEvent("uploadSuccess",o.AllFiles),o.callback&&(o.callback(o.AllFiles),o.AllFiles=[])}),s.on("uploadError",function(e){o.setTextContent(),s.removeFile(e,!0),o.callback&&o.callback(null),Fm.msg.info("附件上传失败")})},onDestroy:function(){var e=this;e.uploader.destroy(),e.callParent()}});
Ext.define("Fm.ux.form.MonthDate",{extend:"Ext.form.field.Date",alias:"widget.monthdatefield",requires:["Ext.picker.Month"],alternateClassName:["Ext.form.MonthDateField","Ext.form.MonthDate"],format:"Y-m",createPicker:function(){{var e,t,n=this;Ext.String.format}return n.okText&&(t=t||{},t.okText=n.okText),n.cancelText&&(t=t||{},t.cancelText=n.cancelText),e={ownerCmp:n,floating:!0,hidden:!0,small:!0,listeners:{scope:n,cancelclick:n.collapse,okclick:n.onMonthSelect,yeardblclick:n.onMonthSelect,monthdblclick:n.onMonthSelect},keyNavConfig:{esc:function(){n.collapse()}}},n.originalCollapse=n.collapse,e.listeners.show={fn:function(){this.picker.el.on({mousedown:function(){this.collapse=Ext.emptyFn},mouseup:function(){this.collapse=this.originalCollapse},scope:this})}},n.pickerOptions&&Ext.apply(e,n.pickerOptions,t||{}),Ext.create("Ext.picker.Month",e)},onMonthSelect:function(e,t){var n=this,o=t[0],l=t[1],c=new Date(l,o,1);c.getMonth()!==o&&(c=new Date(l,o,1).getLastDateOfMonth()),n.setValue(c),n.fireEvent("select",n,c),n.collapse()}});
Ext.define("Fm.ux.form.MultiSelect",{extend:"Ext.form.FieldContainer",mixins:["Ext.util.StoreHolder","Ext.form.field.Field"],alternateClassName:["Ext.ux.Multiselect","Fm.ux.MultiSelect"],alias:["widget.multiselectfield","widget.multiselect"],requires:["Ext.panel.Panel","Ext.view.BoundList","Ext.layout.container.Fit","Ext.data.StoreManager"],uses:["Ext.view.DragZone","Ext.view.DropZone"],layout:"anchor",publishes:["value","selection","validators","store"],twoWayBindable:["value","selection","store"],defaultBindProperty:"value",config:{validationField:null,validation:null,selection:null},selectionMode:"item",ddReorder:!1,appendOnly:!1,displayField:"text",allowBlank:!0,minSelections:0,maxSelections:Number.MAX_VALUE,blankText:"为必选项",minSelectionsText:"至少需要选择 {0} 项",maxSelectionsText:"最多选择 {0} 项",delimiter:",",dragText:"{0} Item{1}",ignoreSelectChange:0,multiSelect:!0,initComponent:function(){var e=this;e.items=e.setupItems(),e.bindStore(e.store||e.getBind().store.getValue(),!0),e.store.autoCreated&&(e.valueField=e.displayField="field1",e.store.expanded||(e.displayField="field2")),Ext.isDefined(e.valueField)||(e.valueField=e.displayField),e.callParent(),e.initField()},setupItems:function(){var e=this;e.selectionModel=new Ext.selection.DataViewModel({mode:e.multiSelect?"SIMPLE":"SINGLE",allowDeselect:!1});var t=function(e){return'<div class="x-boundlist-item-cis-item"><i class="x-boundlist-item-cis-checker"></i><span <tpl if="_rowclass">class="{_rowclass}"</tpl>>{'+e+"}</span></div>"},i=null;return"checkbox"===e.selectionMode?(i='<tpl for="."><li role="option" unselectable="on" class="x-boundlist-item-cis">'+t(e.displayField)+"</li></tpl>",e.listConfig||(e.listConfig={}),e.listConfig.itemCls="x-boundlist-item-cis-item"):i='<tpl for="."><li role="option" unselectable="on" class="'+Ext.baseCSSPrefix+'boundlist-item  <tpl if="_rowclass">{_rowclass}</tpl>">{'+e.displayField+"}</li></tpl>",e.boundList=Ext.create("Ext.view.BoundList",Ext.apply({anchor:"none 100%",border:1,selectionModel:e.selectionModel,store:e.store,displayField:e.displayField,disabled:e.disabled,tpl:i,onContainerClick:function(e){return!1}},e.listConfig)),e.boundList.getSelectionModel().on("selectionchange",e.onSelectChange,e),e.boundList.pickerField=e,e.title?(e.boundList.border=!1,{border:!0,anchor:"none 100%",layout:"anchor",title:e.title,tbar:e.tbar,items:e.boundList}):e.boundList},onSelectChange:function(e,t){this.ignoreSelectChange||this.setValue(t)},getSelected:function(){return this.boundList.getSelectionModel().getSelection()},isEqual:function(e,t){var i,l=Ext.Array.from,n=0;if(e=l(e),t=l(t),i=e.length,i!==t.length)return!1;for(;i>n;n++)if(t[n]!==e[n])return!1;return!0},afterRender:function(){var e,t=this;t.callParent(),t.selectOnRender&&(e=t.getRecordsForValue(t.value),e.length&&(++t.ignoreSelectChange,t.boundList.getSelectionModel().select(e),--t.ignoreSelectChange),delete t.toSelect),!t.ddReorder||t.dragGroup||t.dropGroup||(t.dragGroup=t.dropGroup="MultiselectDD-"+Ext.id()),(t.draggable||t.dragGroup)&&(t.dragZone=Ext.create("Ext.view.DragZone",{view:t.boundList,ddGroup:t.dragGroup,dragText:t.dragText})),(t.droppable||t.dropGroup)&&(t.dropZone=Ext.create("Ext.view.DropZone",{view:t.boundList,ddGroup:t.dropGroup,handleNodeDrop:function(e,i,l){var n,r=this.view,o=r.getStore(),a=e.records;e.view.store.remove(a),n=o.indexOf(i),"after"===l&&n++,o.insert(n,a),r.getSelectionModel().select(a),t.fireEvent("drop",t,a)}}))},isValid:function(){var e=this,t=e.disabled,i=e.forceValidation||!t;return i?e.validateValue(e.value):t},validateValue:function(e){var t=this,i=t.getErrors(e),l=Ext.isEmpty(i);return t.preventMark||(l?t.clearInvalid():t.markInvalid(i),t.boundList[l?"removeCls":"addCls"](["x-form-trigger-wrap-default","x-form-trigger-wrap-invalid"])),l},markInvalid:function(e){var t=this,i=t.getActiveError();t.setActiveErrors(Ext.Array.from(e)),i!==t.getActiveError()&&t.updateLayout()},clearInvalid:function(){var e=this,t=e.hasActiveError();e.unsetActiveError(),t&&e.updateLayout()},getSubmitData:function(){var e,t=this,i=null;return t.disabled||!t.submitValue||t.isFileUpload()||(e=t.getSubmitValue(),null!==e&&(i={},i[t.getName()]=e)),i},getSubmitValue:function(){var e=this,t=e.delimiter,i=e.getValue();return Ext.isString(t)?i.join(t):i},getValue:function(){return this.value||[]},getRecordsForValue:function(e){var t,i,l,n=this,r=[],o=n.store.getRange(),a=n.valueField,s=0,d=o.length;for(l=e.length;l>s;++s)for(i=0;d>i;++i)t=o[i],t.get(a)==e[s]&&r.push(t);return r},setupValue:function(e){var t,i,l,n=this.delimiter,r=this.valueField,o=0;if(Ext.isDefined(e)){for(n&&Ext.isString(e)?e=e.split(n):Ext.isArray(e)||(e=[e]),i=e.length;i>o;++o)l=e[o],l&&l.isModel&&(e[o]=l.get(r));t=Ext.Array.unique(e)}else t=[];return t},setValue:function(e){var t=this,i=t.boundList.getSelectionModel(),l=t.store;return l.getCount()?(e=t.setupValue(e),t.mixins.field.setValue.call(t,e),void(t.rendered?(++t.ignoreSelectChange,i.deselectAll(),e.length&&i.select(t.getRecordsForValue(e),!1,!0),--t.ignoreSelectChange):t.selectOnRender=!0)):void l.on({load:Ext.Function.bind(t.setValue,t,[e]),single:!0})},clearValue:function(){this.setValue([])},onEnable:function(){var e=this.boundList;this.callParent(),e&&e.enable()},onDisable:function(){var e=this.boundList;this.callParent(),e&&e.disable()},getErrors:function(e){var t,i=this,l=Ext.String.format,n=[];return e=Ext.Array.from(e||i.getValue()),t=e.length,!i.allowBlank&&1>t&&n.push(i.blankText),t<i.minSelections&&n.push(l(i.minSelectionsText,i.minSelections)),t>i.maxSelections&&n.push(l(i.maxSelectionsText,i.maxSelections)),n},onDestroy:function(){var e=this;e.bindStore(null),Ext.destroy(e.dragZone,e.dropZone),e.callParent()},onBindStore:function(e){var t=this.boundList;t&&t.bindStore(e)}});
Ext.define("Fm.ux.form.UEditor",{extend:"Ext.form.field.TextArea",alias:["widget.ueditor"],fieldSubTpl:['<textarea id="{id}-ue" autocomplete="off">\n','<tpl if="value">{[Ext.util.Format.htmlEncode(values.value)]}</tpl>',"</textarea>",'<textarea id="{id}" data-ref="inputEl" style="display:none" ','<tpl if="name"> name="{name}"</tpl>',' autocomplete="off">\n','<tpl if="value">{[Ext.util.Format.htmlEncode(values.value)]}</tpl>',"</textarea>",{disableFormats:!0}],width:700,config:{ueditorConfig:{}},initComponent:function(){var e=this;e.callParent(arguments)},afterRender:function(){var e=this;if(e.callParent(arguments),e.ue)e.ue.setContent(e.getValue());else{e.ue=UE.getEditor(e.getInputId()+"-ue",Ext.apply(e.ueditorConfig,{initialFrameHeight:e.height||"300px",initialFrameWidth:"100%",imageActionName:"uploadimage",imageFieldName:"upfile",imageAllowFiles:[".png",".jpg",".jpeg",".gif",".bmp"],imageCompressEnable:!1,imageInsertAlign:"none",imageUrlPrefix:"",fileActionName:"uploadfile",fileFieldName:"upfile",fileUrlPrefix:"",fileAllowFiles:[".png",".jpg",".jpeg",".gif",".bmp",".rar",".zip",".tar",".gz",".7z",".doc",".docx",".xls",".xlsx",".ppt",".pptx",".pdf",".txt"]})),e.ue.ready(function(){e.UEditorIsReady=!0});var t=e.up("window");if(t&&"hide"==t.closeAction)t.on("beforehide",function(){e.onDestroy()});else{var i=e.up("panel");i&&"hide"==i.closeAction&&i.on("beforehide",function(){e.onDestroy()})}}},setValue:function(e){var t=this;return t.UEditorIsReady?t.ue.insertHtml(e):t.setRawValue(t.valueToRaw(e)),t.callParent(arguments),t},getRawValue:function(){var e=this;e.UEditorIsReady&&(document.getElementById(e.getInputId()).innerText=e.ue.getContent());var t=e.callParent();return t===e.emptyText&&e.valueContainsPlaceholder&&(t=""),t},onDestroy:function(){var e=this;if(e.rendered)try{e.ue.destroy(),delete e.ue}catch(t){}e.callParent()}});
Ext.define("Fm.ux.form.WindowField",{extend:"Fm.ux.form.ComboGridField",alias:"widget.windowfield",windowTitle:null,triggerCls:"x-cis-window-trigger-default",winHeight:500,winWidth:800,onTriggerClick:function(e){var t,i=this;t=i.getWindow(),t.show()},autoSelect:!0,getWindow:function(){var e,t,i=this;t=i.multiSelect?{selType:"checkboxmodel",mode:"SIMPLE",allowDeselect:!0}:{mode:"SINGLE",allowDeselect:!1};var l={selModel:t};i.multiSelect||(l.listeners={itemdblclick:{fn:i.onItemSelect},scope:i});var n=i.picker=i.grid=Ext.ComponentManager.create(Ext.apply(i.innerGrid,l),"grid");return e=i.win=Ext.create("Ext.window.Window",{pickerField:i,title:i.windowTitle||i.fieldLabel,height:i.winHeight,width:i.winWidth,modal:!0,layout:"fit",popWindow:"is",items:[n],buttons:["->",{text:"选择",width:70,listeners:{click:{fn:i.onItemSelect},scope:i}},{text:"取消",width:70,handler:function(e){var t=e.up("window[popWindow=is]");t.close()}}],listeners:{close:function(){i.focus()},show:i.onAfterShow,scope:i}})},onAfterShow:function(){var e=this;e.autoSelect&&(e.isChangeSelect=!0,e.doAutoSelect())},onItemSelect:function(){var e=this,t=e.grid,i=t.getSelectionModel(),l=i.getSelection();e.setConvertValue(l),e.win.close(),e.focus()},clearValue:function(){{var e=this;e.picker}e.setValue(null),e.setRawValue(""),e.lastMutatedValue=null},getValue:function(){return this.value},setValue:function(e){var t=this,i="";return t.value=t.valueToTrueValue(e),t.value&&(i=Ext.isArray(t.value)?t.value.join(","):t.value.toString()),t.setRawValue(i),t.checkChange(),t.refreshEmptyText(),t}});
Ext.define("Fm.ux.toolbar.CisPagingToolBar",{extend:"Ext.toolbar.Paging",xtype:"cispagingtoolbar",alternateClassName:["Fm.ux.CisPagingToolBar","Fm.ux.toolbar.CisPagingToolBar"],cls:"cis-pagingtoolbar-panel",padding:0,displayInfo:!0,displayMsg:"显示{0}-{1}&nbsp;共{2}条",emptyMsg:"没有数据",beforePageText:"第",afterPageText:"页&nbsp;共{0}页",firstText:"首页",prevText:"上一页",nextText:"下一页",lastText:"最后一页",refreshText:"刷新",pageSizes:"10,50,100,500,1000,3000",getPagingItems:function(){var e=this,t={scope:e,blur:e.onPagingBlur};t[Ext.supports.SpecialKeyDownRepeat?"keydown":"keypress"]=e.onPagingKeyDown;for(var a=e.pageSizes.split(","),i=[],r=0;r<a.length;r++)a[r]&&(i[i.length]={text:a[r].toString(),value:a[r]});var s=Ext.create("Ext.data.Store",{fields:["text","value"],data:i});return["每页",{itemId:"pageSizes",xtype:"combo",store:s,queryMode:"local",displayField:"text",valueField:"value",width:65,editable:!1,showClearTriggers:!1,value:e.store.getPageSize(),listeners:{change:function(t,a){e.store.setPageSize(a),e._notFireChange||e.moveFirst()}}},"条","-",{itemId:"first",tooltip:e.firstText,overflowText:e.firstText,iconCls:Ext.baseCSSPrefix+"tbar-page-first",disabled:!0,handler:e.moveFirst,scope:e},{itemId:"prev",tooltip:e.prevText,overflowText:e.prevText,iconCls:Ext.baseCSSPrefix+"tbar-page-prev",disabled:!0,handler:e.movePrevious,scope:e},"-",e.beforePageText,{xtype:"numberfield",itemId:"inputItem",name:"inputItem",cls:Ext.baseCSSPrefix+"tbar-page-number",allowDecimals:!1,minValue:1,hideTrigger:!0,enableKeyEvents:!0,keyNavEnabled:!1,selectOnFocus:!0,submitValue:!1,isFormField:!1,width:e.inputItemWidth,margin:"-1 2 3 2",listeners:t},{xtype:"tbtext",itemId:"afterTextItem",text:Ext.String.format(e.afterPageText,1)},"-",{itemId:"next",tooltip:e.nextText,overflowText:e.nextText,iconCls:Ext.baseCSSPrefix+"tbar-page-next",disabled:!0,handler:e.moveNext,scope:e},{itemId:"last",tooltip:e.lastText,overflowText:e.lastText,iconCls:Ext.baseCSSPrefix+"tbar-page-last",disabled:!0,handler:e.moveLast,scope:e},"-",{itemId:"refresh",tooltip:e.refreshText,overflowText:e.refreshText,iconCls:Ext.baseCSSPrefix+"tbar-loading",disabled:e.store.isLoading(),handler:e.doRefresh,scope:e}]},initComponent:function(){var e=this;e.store.on({beforeUpdatePageInfo:{fn:e.beforeUpdatePageInfo,scope:e},updatePageInfo:{fn:e.updatePageInfo,scope:e}}),e.callParent()},beforeUpdatePageInfo:function(){var e=this;e.mask("正在更新分页信息...")},updatePageInfo:function(){var e=this;e.unmask(),e.updateBarInfo()},onLoad:function(){var e,t,a,i,r,s,o,n=this;if(r=n.store.getCount(),s=0===r)t=0,a=0,i=Ext.String.format(n.afterPageText,0);else{if(e=n.getPageData(),t=e.currentPage,a=e.pageCount,t>a)return;i=Ext.String.format(n.afterPageText,isNaN(a)?1:a)}Ext.suspendLayouts(),o=n.child("#afterTextItem"),o&&o.setText(i),o=n.getInputItem(),o&&o.setDisabled(s).setValue(t),o=n.child("#pageSizes"),o&&(n._notFireChange=!0,o.setValue(n.store.getPageSize()),n._notFireChange=!1),n.setChildDisabled("#first",1===t||s),n.setChildDisabled("#prev",1===t||s),n.setChildDisabled("#next",t===a||s),n.setChildDisabled("#last",t===a||s),n.setChildDisabled("#refresh",!1),n.setChildDisabled("#go",s),n.updateInfo(),Ext.resumeLayouts(!0),n.calledInternal||n.fireEvent("change",n,e||n.emptyPageData)},onPagingBlur:function(e){var t,a=this,i=this.getInputItem(),r=a.getPageData();i&&(t=a.readPageFromInput(r),t!==!1&&(t=Math.min(Math.max(1,t),r.pageCount),t!==r.currentPage&&a.fireEvent("beforechange",a,t)!==!1&&a.store.loadPage(t)))}});
Ext.define("Fm.ux.grid.feature.Grouping",{extend:"Ext.grid.feature.Grouping",alias:"feature.cisgrouping",checkCls:Ext.baseCSSPrefix+"grid-group-checked",groupHeaderTpl:"{columnName}: {name}",checkSelector:Ext.baseCSSPrefix+"grid-group-checked-select",isShowCheck:!0,init:function(e){var t=this;t.isShowCheck&&(t.groupHeaderTpl=['<i class="{checkedCls} '+t.checkSelector+'" data-groupName-check="{name:htmlEncode}"></i>'+t.groupHeaderTpl]),t.callParent(arguments),t.isShowCheck&&(e.on({select:t.groupCheckedChange,deselect:t.groupDeCheckedChange,scope:t}),e.getSelectionModel().on({selectAll:t.groupCheckedAllChange,deselectAll:t.groupDeCheckedAllChange,updateGroupSelect:t.groupFristCheckedChange,scope:t}))},getGridStore:function(){return this.view.getStore()||this.view.selModel.store},groupFristCheckedChange:function(){for(var e=this,t=e.getGridStore(),r=t.getGroups().items,o=0;o<r.length;o++)e.doUpdateGroupCheckedHead(r[o].getGroupKey(),null)},groupCheckedChange:function(e,t){var r=this,o=r.getGridStore().getGrouper().getGroupString(t);r.doUpdateGroupCheckedHead(o,null)},groupCheckedAllChange:function(e){for(var t=this,r=this.getGridStore(),o=r.getGroups().items,c=0;c<o.length;c++)t.doUpdateGroupCheckedHead(o[c].getGroupKey(),!0)},groupDeCheckedChange:function(e,t){var r=this,o=r.getGridStore().getGrouper().getGroupString(t);r.doUpdateGroupCheckedHead(o,!1)},groupDeCheckedAllChange:function(e){for(var t=this,r=this.getGridStore(),o=r.getGroups().items,c=0;c<o.length;c++)t.doUpdateGroupCheckedHead(o[c].getGroupKey(),!1)},doUpdateGroupCheckedHead:function(e,t){var r,o,c=this;null===t&&(t=!0,r=c.getGroup(e),o=c.grid.getSelectionModel(),Ext.each(r.items,function(e){return o.isSelected(e)?void 0:(t=!1,!1)})),c.getCache()[e].isCheckedSub=t,this.view.ownerGrid.getView().refreshView()},doSetGroupChecked:function(e,t){var r=this;r.grid.mask("......"),setTimeout(function(){Ext.suspendLayouts();var o=r.grid.getSelectionModel(),c=o.getSelection().length;if(o.suspendChanges(),t)o.select(r.getGroup(e).items,!0,!0);else{var i=r.getGroup(e).items;if(i.length>100){var a=Ext.Array.difference(o.getSelection(),r.getGroup(e).items);o.deselectAll(!0),o.select(a,!1,!0),r.groupFristCheckedChange()}else o.deselect(r.getGroup(e).items,!0)}o.resumeChanges(),o.destroyed||o.maybeFireSelectionChange(o.getSelection().length!==c),r.doUpdateGroupCheckedHead(e,t),Ext.resumeLayouts(!0),r.grid.unmask()},10)},onGroupClick:function(e,t,r,o){var c,i=this,a=i.getCache();i.isShowCheck?(c=Ext.get(o.target),c.hasCls(i.checkSelector)?(i.doSetGroupChecked(r,!a[r].isCheckedSub),o.stopEvent()):i.callParent(arguments)):i.callParent(arguments)},setupRowData:function(e,t,r){var o=this,c=o.refreshData,i=o.groupRenderInfo;if(this.callParent(arguments),c.doGrouping&&r.isFirstRow){var a=o.getCache()[r.groupName];a.isCheckedSub?(r.metaGroupCache&&(r.metaGroupCache.checkedCls=o.checkCls),i&&(i.checkedCls=o.checkCls)):(r.metaGroupCache&&(r.metaGroupCache.checkedCls=o.checkCls+"-no"),i&&(i.checkedCls=o.checkCls+"-no"))}}});
Ext.define("Fm.ux.grid.plugin.AutoSelector",{extend:"Ext.plugin.Abstract",alias:["plugin.fmgridautoselector"],config:{store:null,bindCheckedField:null},init:function(e){e.isXType("tablepanel")||Ext.raise("The fmgridautoselector plugin is designed only for grids and trees");var t=this;t.grid=e,t.watchGrid(),e.on({reconfigure:t.watchGrid,scope:t})},destroy:function(){this.setStore(null),this.grid=null,this.callParent()},ensureSelection:function(){var e=this,t=e.grid,i=t.getStore();if(e.bindCheckedField&&i.getCount()){var n=[];if(Ext.Array.each(i.getData().items,function(t){t.get(e.bindCheckedField)&&n.push(t)}),n&&n.length){var s=t.getSelectionModel();Ext.suspendLayouts(),s.suspendChanges(),s.select(n,!0,!0),s.resumeChanges(),s.fireEvent("updateGroupSelect"),Ext.resumeLayouts(!0)}}},watchGrid:function(){this.setStore(this.grid.getStore()),this.ensureSelection()},updateStore:function(e){var t=this;Ext.destroy(t.storeListeners),t.storeListeners=e&&e.on({load:t.ensureSelection,destroyable:!0,scope:t})}});
Ext.define("Fm.ux.grid.plugin.CisRowExpander",{extend:"Ext.plugin.Abstract",lockableScope:"normal",requires:["Ext.grid.feature.RowBody"],alias:"plugin.cisrowexpander",columnWidth:24,mixins:{observable:"Ext.util.Observable"},autoExpandFirstRow:!0,singleExpand:!0,isRowExpander:!0,rowBodyTpl:null,lockedTpl:null,expandOnEnter:!1,expandOnClick:!0,closeOnDblClick:!0,selectRowOnExpand:!1,headerWidth:24,bodyBefore:!1,hiddenColumn:!1,rowBodyTrSelector:"."+Ext.baseCSSPrefix+"grid-rowbody-tr",rowBodyHiddenCls:Ext.baseCSSPrefix+"grid-row-body-hidden",rowCollapsedCls:Ext.baseCSSPrefix+"grid-row-collapsed",swallowBodyEvents:!0,addCollapsedCls:{fn:function(e,t,o){var n=this.rowExpander;n.recordsExpanded[t.record.internalId]||t.itemClasses.push(n.rowCollapsedCls),this.nextTpl.applyOut(t,e,o)},syncRowHeights:function(e,t){this.rowExpander.syncRowHeights(e,t)},priority:2e4},constructor:function(e){Ext.log.warn("表格插件 Fm.ux.grid.plugin.CisRowExpander 不建议继续使用，替代：Fm.ux.grid.plugin.CisRowWidget"),this.callParent(arguments),this.mixins.observable.constructor.call(this),this.fitCmpWidth=Ext.Function.createDelayed(this.fitCmpWidth,1)},setCmp:function(e){var t,o=this;this.callParent(arguments),this.recordsExpanded={},this.preventsExpanding={},this.bodyContent={},this.rowBodyTpl||(this.rowBodyTpl=""),Ext.isEmpty(this.rowBodyTpl)||!this.loader&&!this.component||(this.cmpBodyTpl=this.rowBodyTpl instanceof Ext.XTemplate?this.rowBodyTpl:Ext.create("Ext.XTemplate",this.rowBodyTpl),this.rowBodyTpl=""),this.rowBodyTpl=this.rowBodyTpl instanceof Ext.XTemplate?this.rowBodyTpl:Ext.create("Ext.XTemplate",this.rowBodyTpl),t=o.getFeatureConfig(e),e.features=e.features?Ext.Array.push(t,e.features):t,this.componentsCache=[],this.outerComponentsCache=[],this.component&&this.singleExpand===!1&&(this.componentCfg=this.component,delete this.component),this.component&&!this.component.initialConfig&&(this.component.monitorResize=!0,this.componentCfg=this.component,this.component=Ext.ComponentManager.create(Ext.isFunction(this.component)?this.component.call({expander:this}):this.component,"panel"),this.component.on({render:function(){var t=this;o.swallowRow(t),Ext.each(t.query("textfield,textarea"),function(t){t.on({focus:function(t,o,n,i){e.getStore().suspendEvents()},blur:function(t){e.getStore().resumeEvents()}})})}}))},getFeatureConfig:function(e){var t=this,o=[],n={ftype:"rowbody",rowExpander:t,bodyBefore:t.bodyBefore,recordsExpanded:this.recordsExpanded,rowBodyHiddenCls:this.rowBodyHiddenCls,rowCollapsedCls:this.rowCollapsedCls,setupRowData:this.getRowBodyFeatureData,setup:this.setup,expander:this};return o.push(Ext.apply({lockableScope:"normal",getRowBodyContents:t.getRowBodyContentsFn(t.rowBodyTpl)},n)),e.enableLocking&&o.push(Ext.apply({lockableScope:"locked",getRowBodyContents:t.lockedTpl?t.getRowBodyContentsFn(t.lockedTpl):function(){return""}},n)),o},getRowBodyContentsFn:function(e){var t=this;return function(o){return e.owner=t,e.applyTemplate(o.record.getData())||this.rowExpander.bodyContent[o.record.internalId]}},getExpanded:function(){var e=this.grid.store,t=[];return(e.store||e).each(function(e,o){this.recordsExpanded[e.internalId]&&t.push(e)},this),t},init:function(e){e.lockable&&(e=e.normalGrid);var t,o=this,n=e.ownerLockable;this.callParent(arguments),this.grid=e,o.view=e.getView(),o.bindView(o.view),o.view.addRowTpl(o.addCollapsedCls).rowExpander=o,n?(o.addExpander(n.lockedGrid.headerCt.items.getCount()?n.lockedGrid:e),t=n.lockedGrid.getView(),o.bindView(t),t.addRowTpl(o.addCollapsedCls).rowExpander=o,n.syncRowHeight=!0,n.mon(n,{processcolumns:o.onLockableProcessColumns,lockcolumn:o.onColumnLock,unlockcolumn:o.onColumnUnlock,scope:o}),o.viewListeners=view.on({itemadd:Ext.Function.createAnimationFrame(n.syncRowHeights,n)})):(o.addExpander(e),e.on("beforereconfigure",o.beforeReconfigure,o)),e.headerCt.on("columnhide",this.updateComponentsWidth,this,{delay:20,buffer:20}),e.headerCt.on("columnshow",this.updateComponentsWidth,this,{delay:20,buffer:20}),o.expands=[]},updateComponentsWidth:function(){var e,t,o,n=this.grid,i=n.store.store||n.store,r=this.componentsCache.length;try{if(this.component&&this.component.record&&this.recordsExpanded[this.component.record.internalId]){var s=Ext.get(n.view.getNode(i.getByInternalId(this.component.record.internalId)));s&&s.down&&(t=s.down("div.x-grid-rowbody"),this.component.setWidth(t.getWidth()-t.getPadding("lr")-(this.scrollOffset||0)))}if(this.componentsCache&&r>0)for(e=0;r>e;e++)o=this.componentsCache[e],this.recordsExpanded[o.id]&&(t=Ext.get(n.view.getNode(i.getByInternalId(o.id))).down("div.x-grid-rowbody"),o.cmp.setWidth(t.getWidth()-t.getPadding("lr")-(this.scrollOffset||0)))}catch(d){}},beforeReconfigure:function(e,t,o,n,i){var r=this;r.viewListeners&&r.viewListeners.destroy(),o&&(r.expanderColumn=new Ext.grid.Column(r.getHeaderConfig()),o.unshift(r.expanderColumn))},onLockableProcessColumns:function(e,t,o){this.addExpander(t.length?e.lockedGrid:e.normalGrid)},addExpander:function(e){var t=this,o=t.getHeaderConfig();t.expandOnClick||(e.isLocked&&e.ownerLockable.shrinkWrapLocked&&(e.width+=o.width),t.expanderColumn=e.headerCt.insert(0,o),e.getSelectionModel().injectCheckbox=1)},getRowBodyFeatureData:function(e,t,o){var n=this;n.self.prototype.setupRowData.apply(n,arguments),o.rowBody=n.getRowBodyContents(o),o.rowBodyCls=n.recordsExpanded[e.internalId]?"":n.rowBodyHiddenCls},setup:function(e,t){var o=this,n=o.grid.ownerLockable;o.self.prototype.setup.apply(o,arguments),n&&-1!==Ext.Array.indexOf(o.grid.columnManager.getColumns(),o.rowExpander.expanderColumn)&&(t.rowBodyColspan-=1)},bindView:function(e){if(e.stopEventFn=this.stopEventFn,e.on("beforerefresh",function(){this.preventsExpanding={}},this),this.expandOnEnter&&e.on("itemkeydown",this.onKeyDown,this),this.closeOnDblClick&&e.on("itemdblclick",this.onDblClick,this),this.expandOnClick&&e.on("itemclick",this.onClick,this),this.autoExpandFirstRow){e.ownerCt.on("expandfirstrow",this.onExpandFirstRow,this),e.on("refresh",function(){this.fireEvent("expandfirstrow",this)},e.ownerCt)}e.on("itemmousedown",function(e,t,o,n,i){return!i.getTarget("div.x-grid-rowbody",e.el)},this),(this.componentCfg&&this.singleExpand===!1||this.loader)&&(e.on("beforerefresh",this.mayRemoveComponents,this),e.on("beforeitemupdate",this.mayRemoveComponent,this),e.on("beforeitemremove",this.removeComponent,this),e.on("refresh",this.restoreComponents,this),e.on("itemupdate",this.restoreSingleComponent,this),e.on("itemadd",this.onExpandMemRows,this)),this.component&&(e.on("beforerefresh",this.moveComponent,this),e.on("beforeitemupdate",this.moveComponent,this),e.on("beforeitemremove",this.moveComponent,this),e.on("refresh",this.restoreComponent,this),e.on("itemupdate",this.restoreComponent,this),e.on("itemremove",this.moveComponent,this),e.on("itemadd",this.restoreComponent,this),e.ownerCt.on("show",this.restoreComponent,this))},moveComponent:function(){if(this.componentInsideGrid){var e=this.component.getEl(),t=Ext.getBody();e.addCls("x-hidden"),t.dom.appendChild(e.dom),this.componentInsideGrid=!1}},removeComponent:function(e,t,o){for(var n=0,i=this.componentsCache.length;i>n;n++)if(this.componentsCache[n].id==t.internalId){try{var r=this.componentsCache[n].cmp;r.destroy(),Ext.Array.remove(this.componentsCache,this.componentsCache[n])}catch(s){}break}},mayRemoveComponent:function(e,t,o){if(this.invalidateComponentsOnRefresh)return void this.removeComponents(e,t,o);for(var n,i,r,s=0,d=this.componentsCache.length;d>s;s++)if(n=this.componentsCache[s],n.id==t.internalId){i=n.cmp.getEl(),r=Ext.getBody(),i.addCls("x-hidden"),r.dom.appendChild(i.dom),this.outerComponentsCache.push(n),Ext.Array.remove(this.componentsCache,n);break}},mayRemoveComponents:function(){if(this.invalidateComponentsOnRefresh)return void this.removeComponents();for(var e,t,o=Ext.getBody(),n=0,i=this.componentsCache.length;i>n;n++)e=this.componentsCache[n].cmp,t=e.getEl(),t.addCls("x-hidden"),o.dom.appendChild(t.dom);this.outerComponentsCache=this.componentsCache,this.componentsCache=[]},removeComponents:function(e){for(var t=0,o=this.componentsCache.length;o>t;t++)try{var n=this.componentsCache[t].cmp;n.destroy()}catch(i){}if(this.componentsCache=[],e&&this.outerComponentsCache){for(var t=0,o=this.outerComponentsCache.length;o>t;t++)try{var n=this.outerComponentsCache[t].cmp;n.destroy()}catch(i){}this.outerComponentsCache=[]}},restoreComponent:function(){if(this.component.rendered!==!1){var e=this.grid;Ext.each(e.getView().getViewRange(),function(t,o){if(!t.isCollapsedPlaceholder&&this.recordsExpanded[t.internalId]){{var n=e.view.getNode(t,!1),i=Ext.get(n),r=i.down("div.x-grid-rowbody");this.getComponent(t,r)}return r.appendChild(this.component.getEl()),this.component.removeCls("x-hidden"),this.componentInsideGrid=!0,!1}},this),e.view.refreshSize(!0),this.fitCmpWidth(this.component)}},onRowCmpLoad:function(e,t,o){var n=e.paramsFnScope.expander,i=n.grid,r=e.getTarget();i.view.refreshSize(!0),n.fitCmpWidth(r)},createComponent:function(e,t){var o,n,i,r;return this.loader?(n=!("html"==this.loader.renderer||"data"==this.loader.renderer),i={record:e,expander:this,el:t,grid:this.grid},r=Ext.isFunction(this.loader)?this.loader.call(i):Ext.clone(this.loader),r.paramsFnScope=i,r.success=this.onRowCmpLoad,o=Ext.create(n?"Ext.container.Container":"Ext.Component",{loader:r,layout:"anchor",defaults:{anchor:"100%"},tpl:Ext.isEmpty(this.cmpBodyTpl)?void 0:this.cmpBodyTpl instanceof Ext.XTemplate?this.cmpBodyTpl:Ext.create("Ext.XTemplate",this.cmpBodyTpl)})):o=Ext.ComponentManager.create(Ext.isFunction(this.componentCfg)?this.componentCfg.call({record:e,expander:this}):Ext.clone(this.componentCfg),"panel"),this.componentMargin&&(o.margin=this.componentMargin),o.ownerCt=this.grid,o.record=e,o.width=t.getWidth()-(this.scrollOffset||0),o.render(t),o.addCls("x-row-expander-control"),this.componentsCache.push({id:e.internalId,cmp:o}),o},restoreSingleComponent:function(e,t,o){var n=this.grid;if(!e.isCollapsedPlaceholder&&this.recordsExpanded[e.internalId]){var i=n.view.getNode(e,!1),r=Ext.get(i),s=(r.down(this.rowBodyTrSelector),r.down("div.x-grid-rowbody")),d=this.getComponent(e,s);d||(d=this.createComponent(e,s)),n.view.refreshSize(!0),this.fitCmpWidth(d)}},restoreComponents:function(){var e=this.grid,t=[];Ext.each(e.getView().getViewRange(),function(o,n){if(!o.isCollapsedPlaceholder&&this.recordsExpanded[o.internalId]){var i=e.view.getNode(o,!1),r=Ext.get(i),s=(r.down(this.rowBodyTrSelector),r.down("div.x-grid-rowbody")),d=this.getComponent(o,s);d||(d=this.createComponent(o,s)),t.push(d)}},this),this.removeOuterOrphans(),e.view.viewReady&&e.view.refreshSize(!0),Ext.each(t,function(e){this.fitCmpWidth(e)},this)},removeOuterOrphans:function(){if(this.outerComponentsCache&&this.outerComponentsCache.length>0)for(var e,t,o,n=this.outerComponentsCache.length,i=this.grid.store.store||this.grid.store,r=i.data.items,s=r.length,d=0;n>d;){for(o=this.outerComponentsCache[d],t=!1,e=0;s>e;e++)if(r[e].internalId==o.id){t=!0;break}if(t)d++;else{try{o.cmp.destroy()}catch(h){}Ext.Array.remove(this.outerComponentsCache,o),n--}}},swallowRow:function(e){this.swallowBodyEvents&&e.getEl().swallowEvent(["click","mousedown","mousemove","mouseup","dblclick","contextmenu","mouseover","mouseout"],!1)},onKeyDown:function(e,t,o,n,i){if(i.getKey()===i.ENTER)for(var r=e.store.store||e.store,s=e.getSelectionModel().getSelection(),d=s.length,h=0;d>h;h++)this.preventsExpanding[s[h].internalId]||(n=r.indexOf(s[h]),this.toggleRow(n,s[h]))},beforeExpand:function(e,t,o,n){return this.fireEvent("beforeexpand",this,e,t,o,n)!==!1?((this.singleExpand||this.component)&&this.collapseAll(),!0):!1},expandAll:function(){if(!this.singleExpand&&!this.component){var e=0,t=this.view.getViewRange(),o=this.grid.store.store||this.grid.store,n=t.length;for(e;n>e;e++)this.toggleRow(o.indexOf(t[e]),t[e],!0)}},collapseAll:function(){try{var e=0,t=this.view.getViewRange(),o=this.grid.store.store||this.grid.store,n=t.length;for(e;n>e;e++)this.toggleRow(o.indexOf(t[e]),t[e],!1);this.recordsExpanded={},this.grid.view.rowBodyFeature.recordsExpanded=this.recordsExpanded}catch(i){}},collapseRow:function(e){this.toggleRow(e,this.view.getRecord(this.view.getNode(e)),!1)},expandRow:function(e){try{if(!Ext.get(e.offsetParent).hasCls(this.rowCollapsedCls))return;this.toggleRow(e,this.view.getRecord(this.view.getNode(e)),!0)}catch(t){}},toggleRow:function(e,t,o){if(!t.isCollapsedPlaceholder){var n,i=this,r=this.view,s=r.bufferedRenderer,d=r.getScrollable(),h=r,a=this.view.getNode(t,!1),l=Ext.get(a);try{l.down(this.rowBodyTrSelector)}catch(c){return}var p,m,g=l.down(this.rowBodyTrSelector),C=l.down("div.x-grid-rowbody"),u=Ext.isDefined(o),f=l.hasCls(i.rowCollapsedCls),w=f?"removeCls":"addCls",x=this.grid,E=f?2:1,v=i.grid.ownerLockable;e=(x.store.store||x.store).indexOf(t),Ext.suspendLayouts(),!u||u&&o===!0?this.beforeExpand(t,g,a,e)&&(l.removeCls(this.rowCollapsedCls),g.removeCls(this.rowBodyHiddenCls),this.recordsExpanded[t.internalId]=!0,this.component?(this.recreateComponent&&(this.component.destroy(),this.component=Ext.ComponentManager.create(Ext.isFunction(this.componentCfg)?this.componentCfg.call({record:t,expander:this}):this.componentCfg,"panel")),this.component.rendered?(C.appendChild(this.component.getEl()),this.component.show(),this.component.setWidth(C.getWidth()-(this.scrollOffset||0))):(this.component.width=C.getWidth()-(this.scrollOffset||0),this.component.render(C)),this.component.addCls("x-row-expander-control"),this.component.removeCls("x-hidden"),this.componentInsideGrid=!0,p=this.component):(this.componentCfg||this.loader)&&(p=this.getComponent(t,C),p?p.show():p=this.createComponent(t,C)),p&&(p.record=t,this.fitCmpWidth(p)),this.expands.push(t),this.fireEvent("expand",this,t,p,g,a,e)):(!l.hasCls(this.rowCollapsedCls)&&!u||u&&o===!1&&!l.hasCls(this.rowCollapsedCls))&&this.fireEvent("beforecollapse",this,t,g,a,e)!==!1&&(this.component&&this.component.rendered?this.component.hide():(this.componentCfg||this.loader)&&(p=this.getComponent(t,C),p&&p.rendered&&p.hide()),l.addCls(this.rowCollapsedCls),g.addCls(this.rowBodyHiddenCls),this.recordsExpanded[t.internalId]=!1,Ext.Array.remove(this.expands,t),this.fireEvent("collapse",this,t,p,g,a,e)),i.grid.ownerLockable&&(h=v.getView(),v.lockedGrid.isVisible()&&(r=v.view.lockedGrid.view,n=Ext.fly(r.getNode(e)),n&&(n[w](i.rowCollapsedCls),g=n.down(i.rowBodyTrSelector,!0),Ext.fly(g)[w](i.rowBodyHiddenCls)))),i.expanderColumn&&(m=Ext.fly(r.getRow(e)).down(i.expanderColumn.getCellSelector(),!0),m&&(m.rowSpan=E)),h.fireEvent(f?"expandbody":"collapsebody",a,t,g),(r.getSizeModel().height.shrinkWrap||v)&&r.refreshSize(!0),d&&(s?s.refreshSize():d.refresh(!0)),Ext.resumeLayouts(!0)}},onDblClick:function(e,t,o,n,i){this.preventsExpanding[t.internalId]||i.getTarget(this.rowBodyTrSelector,e.el)||this.isExpanded(o)&&this.collapseRow(o)},onClick:function(e,t,o,n,i){var r,s=this,d=s.grid;return d.getSelectionModel&&(r=d.getSelectionModel()),r&&r.checkOnly&&i.position.colIdx===r.injectCheckbox?!1:void(this.isExpanded(o)||this.preventsExpanding[t.internalId]||i.getTarget(this.rowBodyTrSelector,e.el)||(this.collapseAll(),this.toggleRow(n,t)))},onExpandMemRows:function(e){for(var t,o=this,n=o.grid.view,i=0;i<this.expands.length;i++){var r=n.getNode(this.expands[i],!1);t=Ext.get(r),t&&setTimeout(function(){o.expandRow(t)},100)}},onExpandFirstRow:function(e){var t=this,o=e.view,n=o.getRow(0),i=e.getStore().getAt(0);n&&(t.recordsExpanded[i.internalId]=!0,t.collapseAll(),setTimeout(function(){if(Ext.get(n))try{t.expandRow(n)}catch(e){}},100))},renderer:Ext.emptyFn,syncRowHeights:function(e,t){var o,n,i=this,r=Ext.fly(e).down(i.rowBodyTrSelector),s=Ext.fly(t).down(i.rowBodyTrSelector);s.isVisible()?(o=r.getHeight())!==(n=s.getHeight())&&(o>n?s.setHeight(o):r.setHeight(n)):r.dom.style.height=s.dom.style.height=""},onColumnUnlock:function(e,t){var o,n=this;e=n.grid.ownerLockable,o=e.lockedGrid.visibleColumnManager.getColumns(),1===o.length&&(o[0]===n.expanderColumn?(e.unlock(n.expanderColumn),n.grid=e.normalGrid):e.lock(n.expanderColumn,0))},onColumnLock:function(e,t){var o,n,i=this;e=i.grid.ownerLockable,o=e.lockedGrid.visibleColumnManager.getColumns(),1===o.length&&(i.grid=n=e.lockedGrid,n.headerCt.insert(0,i.expanderColumn))},getHeaderConfig:function(){var e=this,t=e.grid.ownerLockable;return{width:e.headerWidth,isExpanderColumn:!0,lockable:!1,sortable:!1,resizable:!1,draggable:!1,hideable:!1,menuDisabled:!0,hidden:this.hiddenColumn,tdCls:Ext.baseCSSPrefix+"grid-cell-special",innerCls:Ext.baseCSSPrefix+"grid-cell-inner-row-expander",preinitScope:e,preinitFn:function(e){this.expanderColumn=e},renderer:function(t,o,n){var i=e.renderer.apply(this,arguments);return i===!1?(i="&#160;",e.preventsExpanding[n.internalId]=!0):i===!0&&(i=null),e.recordsExpanded[n.internalId]&&(o.tdAttr+=' rowspan="2"'),i?i:'<div class="'+Ext.baseCSSPrefix+'grid-row-expander" role="presentation"></div>'},processEvent:function(t,o,n,i,r,s,d){return s.getTarget("."+Ext.baseCSSPrefix+"grid-row-expander")&&"click"===t?(e.toggleRow(i,d),e.selectRowOnExpand):void 0},isLocked:function(){return t&&(t.lockedGrid.isVisible()||this.locked)},editRenderer:function(){return"&#160;"}}},isCollapsed:function(e){return"number"==typeof e&&(e=this.view.getNode(e)),Ext.fly(e).hasCls(this.rowCollapsedCls)},isExpanded:function(e){return"number"==typeof e&&(e=this.view.getNode(e)),!Ext.fly(e).hasCls(this.rowCollapsedCls)},getComponent:function(e,t){var o,n,i,r;if(this.componentsCache)for(o=0,n=this.componentsCache.length;n>o;o++)if(i=this.componentsCache[o],i.id==e.internalId)return t&&i.cmp.setWidth(t.getWidth()-(this.scrollOffset||0)),i.cmp;if(this.outerComponentsCache)for(o=0,n=this.outerComponentsCache.length;n>o;o++)if(this.outerComponentsCache[o].id==e.internalId)return i=this.outerComponentsCache[o],r=i.cmp,t&&(t.appendChild(r.getEl()),r.removeCls("x-hidden"),r.setWidth(t.getWidth()-(this.scrollOffset||0)),Ext.Array.remove(this.outerComponentsCache,i),this.componentsCache.push(i)),r;return null},destroy:function(){this.component&&Ext.isFunction(this.component.destroy)&&this.component.destroy(),this.componentsCache&&this.removeComponents(!0)},fitCmpWidth:function(e){if(e&&e.record&&this.recordsExpanded[e.record.internalId]){var t=Ext.get(this.grid.view.getNode((this.grid.store.store||this.grid.store).getByInternalId(e.record.internalId)));if(t){var o=t.down("div.x-grid-rowbody");e.setWidth(o.getWidth()-o.getPadding("lr")-(this.scrollOffset||0))}}}});
Ext.define("Fm.ux.grid.plugin.CisRowWidget",{extend:"Ext.grid.plugin.RowWidget",alias:"plugin.cisrowwidget",mixins:{observable:"Ext.util.Observable"},autoExpandFirstRow:!0,singleExpand:!0,isRowExpander:!0,expandOnEnter:!1,expandOnClick:!0,closeOnDblClick:!0,constructor:function(e){this.callParent(arguments),this.mixins.observable.constructor.call(this)},bindView:function(e){var t=this,o={};t.viewListeners=e.on({refresh:t.onViewRefresh,itemadd:t.onItemAdd,scope:t,destroyable:!0}),t.expandOnClick&&e.on("itemclick",t.onClick,t),t.closeOnDblClick&&e.on("itemdblclick",t.onDblClick,t),t.grid.lockable&&(o.itemadd=t.onItemAdd),t.autoExpandFirstRow&&(e.ownerCt.on("expandfirstrow",t.onExpandFirstRow,t),e.on("refresh",function(){this.fireEvent("expandfirstrow",this)},e.ownerCt)),Ext.override(e,t.viewOverrides)},isExpanded:function(e){var t=this;return t.recordsExpanded[e.internalId]||!Ext.fly((t.normalView||t.view).getNode(e)).hasCls(t.rowCollapsedCls)},collapseAll:function(){Ext.suspendLayouts(),this._doCollapseAll(),Ext.resumeLayouts(!0)},_doCollapseAll:function(){var e=0,t=this.view.getViewRange(),o=(this.grid.store.store||this.grid.store,t.length);for(e;o>e;e++)this.isExpanded(t[e])&&this.toggleRow(t[e],t[e]);this.recordsExpanded={},this.grid.view.rowBodyFeature.recordsExpanded=this.recordsExpanded},onClick:function(e,t,o,i,n){var d,s=this,l=s.grid;return l.getSelectionModel&&(d=l.getSelectionModel()),d&&d.checkOnly&&n.position.colIdx===d.injectCheckbox?!1:(Ext.suspendLayouts(),s.singleExpand&&s._doCollapseAll(),s.isExpanded(t)||s.toggleRow(i,t),void Ext.resumeLayouts(!0))},onDblClick:function(e,t,o,i,n){this.isExpanded(t)&&this.toggleRow(i,t)},onExpandFirstRow:function(e){var t=this,o=e.getStore().getAt(0);o&&setTimeout(function(){Ext.suspendLayouts(),t.singleExpand&&t._doCollapseAll(),Ext.fly((t.normalView||t.view).getNode(o))&&(t.isExpanded(o)||t.toggleRow(0,o)),Ext.resumeLayouts(!0)},500)},addExpander:function(e){var t=this,o=e.getSelectionModel(),i=o.injectCheckbox;t.expandOnClick||(t.expanderColumn=e.headerCt.insert(0,t.getHeaderConfig()),(0===i||"first"===i)&&(i=1),o.injectCheckbox=i)},privates:{toggleRow:function(e,t){var o,i,n=this,d=n.normalView||n.view,s=d.getNode(e),l=Ext.fly(s),r=l.down(n.rowBodyTrSelector,!0),a=l.hasCls(n.rowCollapsedCls),c=a?"removeCls":"addCls",x=n.grid.lockable&&n.grid;l[c](n.rowCollapsedCls),Ext.fly(r)[c](n.rowBodyHiddenCls),Ext.suspendLayouts(),a?(n.recordsExpanded[t.internalId]=!0,i=n.addWidget(d,t)):(delete n.recordsExpanded[t.internalId],i=n.getWidget(d,t)),x&&x.lockedGrid.isVisible()&&(d=n.lockedView,o=Ext.fly(d.getNode(e)),o&&(o[c](n.rowCollapsedCls),r=o.down(n.rowBodyTrSelector,!0),Ext.fly(r)[c](n.rowBodyHiddenCls),i=a&&n.lockedWidget?[i,n.addWidget(d,t)]:[i,n.getWidget(d,t)]),x.syncRowHeightOnNextLayout=!0),n.component=i,n.fireEvent(a?"expand":"collapse",this,t,i,r,s,e),d.updateLayout(),Ext.resumeLayouts(!0),n.scrollIntoViewOnExpand&&a&&n.grid.ensureVisible(e)}}});
Ext.define("Fm.ux.override.grid.Panel",{override:"Ext.grid.Panel",config:{clickSelection:null},publishes:["selection","clickSelection"],twoWayBindable:["selection","clickSelection"]}),Ext.define("Fm.ux.grid.plugin.ClickSelection",{extend:"Ext.plugin.Abstract",alias:"plugin.clickselection",isClickSelection:!0,allowDeSelect:!1,singleClick:!1,init:function(e){if(!e.isLocked&&!e.ClickSelection){var t=this;t.grid=e,t.store=e.getStore(),t.clickSelection=this.grid.getClickSelection(),t.grid.getView().on("refresh",this.deSelect,t),t.grid.on("beforeitemclick",this._updateClickSelection,t),t.grid.lastSelectRecordId=null;var i=t.grid.getView().getRowClass;this.grid.getView().getRowClass=function(){},this.grid.getView().getRowClass=function(e,l,c,o){var r=i(e,l,c,o)||"";return t.grid.lastSelectRecordId&&e.getId()===t.grid.lastSelectRecordId&&(r+=" x-grid-record-click"),r}}},destroy:function(){this.grid&&!this.grid.lockable&&(this.grid.getView().un("refresh",this.deSelect),this.grid.un("itemclick",this._updateClickSelection))},_updateClickSelection:function(e,t,i,l,c){if(t.get("_isDisabled"))return!1;var o,r,d=this,s=d.grid,n=s.getStore().store||s.getStore();return d.singleClick&&s.lastSelectRecordId===t.getId()?!1:(s.getSelectionModel&&(o=s.getSelectionModel()),o&&o.checkOnly&&c.position.colIdx===o.injectCheckbox?!1:(d.allowDeSelect&&s.lastSelectRecordId===t.getId()?(s.lastSelectRecordId=null,s.setClickSelection(null)):(null!==s.lastSelectRecordId&&(r=n.getById(s.lastSelectRecordId)),s.lastSelectRecordId=t.getId(),s.setClickSelection(t)),r&&r.set("_rowclassclick",!r.get("_rowclassclick")),t.set("_rowclassclick",!t.get("_rowclassclick")),!0))},deSelect:function(){this._clearClickSelection()},_clearClickSelection:function(){var e=this,t=e.grid,i=t.getStore();try{if(t.lastSelectRecordId){if(i&&!i.isEmptyStore){var l=i.getById(t.lastSelectRecordId);if(l){var c=t.getView().getRow(l);c&&Ext.get(c).removeCls("x-grid-record-click")}}t.lastSelectRecordId=null}}catch(o){}t.setClickSelection&&t.setClickSelection(null)}});
Ext.define("Fm.ux.grid.plugin.SubTable",{extend:"Ext.grid.plugin.RowExpander",alias:"plugin.subtable",rowBodyTpl:['<div class="x-grid-subtable-con">',"{%","this.owner.renderTable(out, values);","%}","<div>"],autoExpandFirstRow:!0,autoExpandAllRow:!1,pageSize:10,sumColumns:[],sumFormat:"",init:function(e){Ext.log.warn("表格插件 Fm.ux.grid.plugin.SubTable 不建议继续使用，替代：Fm.ux.grid.plugin.CisRowWidget");var t,n,a,r,o=this,i=o.columns;if(o.callParent(arguments),t=e.getView(),o.autoExpandFirstRow&&!o.autoExpandAllRow&&(t.ownerCt.on("expandfirstrow",o.onExpandFirstRow,o),t.on("refresh",function(){t.ownerCt.fireEvent("expandfirstrow",e)},t.ownerCt)),o.autoExpandAllRow&&(t.ownerCt.on("expandalltrow",o.onExpandAllRow,o),t.on("refresh",function(){t.ownerCt.fireEvent("expandalltrow",e)},t.ownerCt)),t.on({expandbody:function(e,t,n){o.swallowEvent(e.id),t._isrendersubpage||(t._isrendersubpage=!0,o.rendPageByRecord(e.id,t,o))}}),e.on("beforeitemdblclick",function(e,t,n,a,r){return Ext.get(r.target).up(".x-grid-subtable-con")?(r.stopEvent(),!1):void 0}),o.columns=[],i)for(a=0,n=i.length;n>a;++a)r=Ext.apply({preventRegister:!0},i[a]),r.xtype=r.xtype||"gridcolumn",o.columns.push(Ext.widget(r))},onExpandFirstRow:function(e){var t,n=this,a=e.view,r=a.getRow(0);r&&setTimeout(function(){if(Ext.get(r))try{t=e.getStore().getAt(0),n.expandRow(0,t)}catch(a){}},150)},onExpandAllRow:function(e){var t,n,a=this,r=e.view,o=e.getStore();setTimeout(function(){for(var i=0;i<o.data.length;i++)if(t=r.getRow(i),Ext.get(t))try{n=e.getStore().getAt(i),a.expandRow(i,n)}catch(s){}},150)},expandRow:function(e,t){var n=this,a=n.view,r=a.getNode(e),o=Ext.fly(r),i=o.hasCls(n.rowCollapsedCls);i&&n.toggleRow(e,t)},destroy:function(){var e,t,n=this.columns;if(n)for(t=0,e=n.length;e>t;++t)n[t].destroy();this.columns=null,this.callParent()},getRowBodyFeatureData:function(e,t,n){this.callParent(arguments),n.rowBodyCls+=" "+Ext.baseCSSPrefix+"grid-subtable-row"},getTableHtml:function(e,t){var n,a,r,o,i,s=this,l=s.columns,u=l.length,g=s.getAssociatedRecords(e),d=g.length,c=[],p=s.pageSize,t=t||1,h=p*(t-1),m=p*t;for(m>d&&(m=d),c.push("<tr>"),o=0;u>o;o++)a=l[o],c.push('<th style="white-space: nowrap;"><div'+(null!=a.width?' style="display:block;width:'+a.width+'px"':"")+">",l[o].text,"</div></th>");c.push("</tr>");for(var r=h;m>r;r++){for(n=g[r],c.push("<tr>"),o=0;u>o;o++)a=l[o],i=n[a.dataIndex],a.renderer&&a.renderer.call&&(i=a.renderer.call(a.scope||s,i,{},n)),c.push(a.autoExpand?'<td class="sub_table_inner_cell x-text-nowrap" ':'<td class="sub_table_inner_cell x-text-break" '),a.align&&c.push(' style="text-align:'+a.align+';"'),c.push(">",i,"</td>");c.push("</tr>")}return c.join("")},swallowEvent:function(e){var t=Ext.get(e);if(t&&t.el){t.el.swallowEvent(["mousedown","mousemove","mouseup","contextmenu","mouseover","mouseout"],!1),rowBody=t.down("tr.x-grid-subtable-row"),rowBody&&rowBody.el&&rowBody.el.swallowEvent(["click","mousedown","mousemove","mouseup","dblclick","contextmenu","mouseover","mouseout"],!1);{new Clipboard(t.el.dom.querySelectorAll(".sub_table_inner_cell"),{text:function(e){return Ext.String.trim(e.innerText||e.textContent||"")}})}}},rendPageByRecord:function(e,t,n){var a=n||this,r=a.getAssociatedRecords(t);if(a.swallowEvent(e),r.length/a.pageSize<=1)return!0;var o=new fei.pageBar({nowPage:t._subtablepagenum||1,totalSize:r.length,pageSize:a.pageSize,callback:function(r){t._subtablepagenum=r,a.pageRenderTable(e,t,n),a.rendPageByRecord(e,t,n)}});o.render("subPage_"+e+t.getId())},pageRenderTable:function(e,t,n){var a=this,r=e+t.getId(),o=a.getTableHtml(t,t._subtablepagenum||1);document.getElementById("subPage_table_"+r).innerHTML=o},renderTable:function(e,t){var n,a=this,r=a.getAssociatedRecords(t.record),o=t.rowId+t.record.getId();if(n=a.getTableHtml(t.record,1),e.push('<table class="x-grid-subtable" id="subPage_table_'+o+'" cellpadding="2" cellspacing="0">'),e.push(n),a.sumColumns&&a.sumColumns.length>0){for(var i=a.getSums(t),s=a.sumFormat,l=0;l<a.sumColumns.length;l++){var u=i[a.sumColumns[l]],g=Ext.Array.filter(a.columns,function(e){return e.dataIndex===a.sumColumns[l]})[0];g&&g.renderer&&(u=g.renderer(u)),s=s.replace("{"+a.sumColumns[l]+"}",u)}e.push('<tr><td colspan="'+a.columns.length+'">'+s+"</td></tr>")}e.push("</table>"),r.length/a.pageSize>1&&e.push('<div class="page" id="subPage_'+o+'"></div>')},getSums:function(e){for(var t,n=this,a=n.getAssociatedRecords(e.record),r={},o=0;o<n.sumColumns.length;o++)r[n.sumColumns[o]]=0;for(var o=0;o<a.length;o++){t=a[o];for(var i=0;i<n.sumColumns.length;i++)r[n.sumColumns[i]]+=parseFloat(t[n.sumColumns[i]],10)||0}return r},getRowBodyContentsFn:function(e){var t=this;return function(n){return e.owner=t,e.applyTemplate(n)}},getAssociatedRecords:function(e){return e.get(this.association)},getExportColumns:function(){var e=this,t=e.columns,n=Ext.Array.filter(t,function(e){return!e.isCheckerHd&&!e.ignoreExport});return n},exportAlign:{left:"Left",right:"Right",center:"Center"},getExportData:function(e){var t,n,a,r,o=this,i=o.getExportColumns(),s=i.length,l=[],u=[],g=/<.*>(.*)<\/.*>|<.*\/>/;Ext.Array.each(i,function(e){if(!e.isCheckerHd&&!e.ignoreExport){var t=e.exportWidth||e.width;try{t=e.getWidth()}catch(n){}l.push({TitleName:e.text,TitleValue:e.exportIndex||e.dataIndex,TitleWide:Math.ceil(t/7.5),IsRMB:!!e.exportIsRMB,IsCount:!!e.exportIsCount,CellType:o.exportAlign[e.align]})}});for(var d=0;d<e.length;d++){t=e[d],n={};for(var c=0;s>c;c++){if(a=i[c],r=t.get(a.dataIndex),a.exportRender?r=a.exportRender(r,null,t):a.renderer&&(r=a.renderer(r,null,t)),(null===r||void 0===r)&&(r=""),r=r.toString(),r&&(_v=r.replace(/￥/g,""),_v)){r=_v;var p=r.match(g);p&&(r=p[1])}n[a.exportIndex||a.dataIndex]=r.trim()}u.push(n)}return{titles:l,rows:u}}}),fei={},fei.pageBar=function(e){this.nowPage=1,this.totalSize=100,this.pageSize=10,this.pageNumBarLength=2,this.isSyncPageSize=!0,this.callback=function(e){alert(e)};for(var t in e)this[t]=e[t]},fei.pageBar.prototype.render=function(e){this.container=document.getElementById(e),this.container.innerHTML="",this.nowPage=parseInt(this.nowPage,10),this.totalSize=parseInt(this.totalSize,10),this.pageSize=parseInt(this.pageSize,10),this.pageNumBarLength=parseInt(this.pageNumBarLength,10),this.totalPage=Math.ceil(this.totalSize/this.pageSize)<1?1:Math.ceil(this.totalSize/this.pageSize),this.nowPage<1&&(this.nowPage=1),this.isSyncPageSize&&this._appendSyncPageSize(),this._appendPageNumBar()},fei.pageBar.prototype._appendSyncPageSize=function(){var e=this,t=document.createElement("label");t.innerHTML="每页 "+e.pageSize+" 条&nbsp;共 "+e.totalSize+" 条&nbsp;&nbsp;",e.container.appendChild(t)},fei.pageBar.prototype._appendPageNumBar=function(){var e=this.nowPage-this.pageNumBarLength;if(2>e&&(e=2),this._getPageNumText(1,"1",!0),e>2){var t=document.createElement("label");t.innerHTML="...",this.container.appendChild(t)}for(e;e<this.nowPage;e++)this._getPageNumText(e,e,!0);var n=this.nowPage+this.pageNumBarLength;n>this.totalPage-1&&(n=this.totalPage-1);var a=this.nowPage;for(2>a&&(a=2),a;n>=a;a++)this._getPageNumText(a,a,!0);if(n<this.totalPage-1){var t=document.createElement("label");t.innerHTML="...",this.container.appendChild(t)}this.totalPage>1&&this._getPageNumText(this.totalPage,this.totalPage,!0)},fei.pageBar.prototype._getPageNumText=function(e,t,n){var a=this;if(e==a.nowPage){var r=document.createElement("span");r.innerHTML=t,a.container.appendChild(r)}else{var o=document.createElement("a");o.href="javascript:void(0)";var i=function(){a.callback.call(window,e)};o.addEventListener?o.addEventListener("click",i,!1):o.attachEvent?o.attachEvent("onclick",i):o.onclick=i,o.innerHTML=t,this.container.appendChild(o)}};
Ext.define("Fm.ux.DateRange",{extend:"Ext.form.FieldContainer",alias:"widget.daterange",requires:["Ext.form.field.Date"],fieldLabel:"日期范围",width:330,labelWidth:60,layout:"column",labelAlign:"right",defaults:{width:120,labelWidth:60,xtype:"datefield",labelAlign:"right"},addTnterval:Ext.Date.MONTH,addValue:1,addModel:["s-e"],disableLD:!1,isValidateMoreThen:!0,initComponent:function(){var e,t,a=this,i=(new Date).getTime();if(Ext.apply(a.items[0],{width:95,itemId:"startdt"+i,endDateField:"enddt"+i,vtype:"daterange",validateOnChange:!1,isRequirsResetMaxMinValue:!0}),Ext.apply(a.items[1],{width:100,itemId:"enddt"+i,vtype:"daterange",fieldLabel:"-",errorfieldLabel:"结束日期",labelWidth:5,labelSeparator:"",labelAlign:"right",style:{marginLeft:"3px;"},isRequirsResetMaxMinValue:!0}),a.callParent(),e=a.items.items[0],t=a.items.items[1],Ext.Array.contains(a.addModel,"s-e")){var d=function(e){if(!a.disableLD){var i=e.getValue();if(i&&Ext.isDate(i)){var d=Ext.Date.add(i,a.addTnterval,a.addValue);a.addTnterval===Ext.Date.MONTH?(t.setValue(Ext.Date.add(d,Ext.Date.DAY,-1)),t.fireEvent("updatebind",Ext.Date.add(d,Ext.Date.DAY,-1))):(t.setValue(d),t.fireEvent("updatebind",d))}}};setTimeout(function(){e.on("blur",d),e.on("select",d)},500)}if(Ext.Array.contains(a.addModel,"e-s")){var d=function(t){if(!a.disableLD){var i=t.getValue();if(i&&Ext.isDate(i)){var d=Ext.Date.add(i,a.addTnterval,-1*a.addValue);e.setValue(d),e.fireEvent("updatebind",d)}}};setTimeout(function(){t.on("blur",d),t.on("select",d)},500)}},checkDate:function(e){return e instanceof Date?!0:e?new Date(e).getDate()==e.toString().substring(e.length-2):!1},autoFormat:function(e,t){var a,i=e.up("daterange");if(t){var d=i.checkDate(t);if(d)10===e.rawValue.length&&e.fireEvent("blur",e);else{switch(dateString=t.toString().replace(/-/g,""),dateString.length){case 5:a=dateString.substr(0,4)+"-"+dateString.substr(4,1);break;case 6:a=dateString.substr(0,4)+"-"+dateString.substr(4,2);break;case 7:var a=dateString.substr(0,4)+"-"+dateString.substr(4,2)+"-"+dateString.substr(6,1);break;case 8:a=dateString.substr(0,4)+"-"+dateString.substr(4,2)+"-"+dateString.substr(6,2),e.fireEvent("blur",e);break;default:return}e.setRawValue(a)}}}});
Ext.define("Fm.ux.IFrame",{extend:"Ext.Component",alias:"widget.uxiframe",loadMask:AppConfig.maskHtml,src:"about:blank",renderTpl:['<iframe src="{src}" id="{id}-iframeEl" data-ref="iframeEl" name="{frameName}" width="100%" height="100%" frameborder="0"></iframe>'],childEls:["iframeEl"],initComponent:function(){var e=this;e.callParent(),e.frameName=e.frameName||e.id+"-frame"},onRender:function(){var e=this;e.callParent(),e.htmlContent&&e.setHtmlContent(e.htmlContent),e.onKeyDown(e.getDoc())},setHtmlContent:function(e){var t=this,n=t.getDoc();if(n){n.open(),n.write(e),n.close();var r=n.createElement("link");r.rel="stylesheet",r.type="text/css",r.href=(AppConfig.UrlStartWith||"")+"FmContent/lib/ueditor/themes/ueditor.iframe.css",n.getElementsByTagName("head")[0].appendChild(r)}t.onKeyDown(n)},onKeyDown:function(e){var t=this;e.onkeydown||(e.onkeydown=function(e){if(27===e.keyCode){var n=t.up("window");n.close()}})},initEvents:function(){var e=this;e.callParent(),e.iframeEl.on("load",e.onLoad,e)},initRenderData:function(){return Ext.apply(this.callParent(),{src:this.src,frameName:this.frameName})},getBody:function(){var e=this.getDoc();return e.body||e.documentElement},getDoc:function(){try{return this.getWin().document}catch(e){return null}},getWin:function(){var e=this,t=e.frameName,n=Ext.isIE?e.iframeEl.dom.contentWindow:window.frames[t];return n},getFrame:function(){var e=this;return e.iframeEl.dom},beforeDestroy:function(){this.cleanupListeners(!0),this.callParent()},cleanupListeners:function(e){var t,n;if(this.rendered)try{if(t=this.getDoc(),t&&(Ext.get(t).un(this._docListeners),e))for(n in t)t.hasOwnProperty&&t.hasOwnProperty(n)&&delete t[n]}catch(r){}},onLoad:function(){var e=this,t=e.getDoc(),n=e.onRelayedEvent;if(t){try{Ext.get(t).on(e._docListeners={mousedown:n,mousemove:n,mouseup:n,click:n,dblclick:n,scope:e})}catch(r){}Ext.get(this.getWin()).on("beforeunload",e.cleanupListeners,e),this.el.unmask(),this.fireEvent("load",this)}else e.src&&(this.el.unmask(),this.fireEvent("error",this))},onRelayedEvent:function(e){var t=this.iframeEl,n=t.getTrueXY(),r=e.getXY(),i=e.getTrueXY();e.xy=[n[0]+i[0],n[1]+i[1]],e.injectEvent(t),e.xy=r},load:function(e){var t=this,n=t.loadMask,r=t.getFrame();t.fireEvent("beforeload",t,e)!==!1&&(n&&t.el&&t.el.mask(n),r.src=t.src=e||t.src)}});
Ext.define("Fm.ux.ImageView",{extend:"Ext.panel.Panel",requires:["Fm.ux.IFrame"],alias:"widget.imageview",imageIndex:0,imageList:[],layout:"fit",loadingMsg:"加载中...",initComponent:function(){var e=this;e.items=[{xtype:"uxiframe",src:AppConfig.urlStartWith+"FmContent/lib/feiimageview/viewpanel.html?v=1&imageList="+encodeURIComponent(Ext.JSON.encode(e.imageList))+"&index="+e.imageIndex,listeners:{load:function(i){e.image=i.getWin()._fImagePanel.image},error:function(){}}}],e.callParent()},getImage:function(){return this.image}});
Ext.define("Fm.ux.MindMap",{extend:"Ext.container.Container",alias:["widget.mindmap"],twoWayBindable:["jmData"],defaultBindProperty:"jmData",publishes:["jmDataChange"],config:{jmData:[]},jmOptions:{},onRender:function(){var t=this;t.callParent(),t.toolTip=Ext.create("Ext.menu.Menu",{items:[{xtype:"container",minWidth:100,minHeight:50,padding:5,style:{color:"#555"},html:"tooltip"}]}),t.showJm()},showJm:function(){var t,e,n=this,a=n.getId()+"-innerCt";if(n.jmData&&!(n.jmData.length<1)){t={meta:{name:n.getId(),author:"mjl",version:"1.0"},format:"node_array",data:n.jmData},e=Ext.apply({editable:!1,theme:"greensea",container:a,support_html:!0,default_event_handle:{enable_mousedown_handle:!0,enable_click_handle:!0,enable_dblclick_handle:!1},view:{line_color:["#ff0000","#00ff08","#0014ff","#ffa500","#683489","#136987","#456852"]}},n.jmOptions);var o=n.jm=new jsMind(e);o.show(t);var i=n.getEl(),d=i.query("jmnode");i.on("contextmenu",function(t){t.stopEvent()});for(var m=0;m<d.length;m++){var l=Ext.get(d[m]);l.on("contextmenu",function(t){n.fireEvent("contextMenu",n.jm.get_selected_node(),t)}),l.on("click",function(t){n.fireEvent("nodeClick",n.jm.get_selected_node(),t)}),l.on("mouseover",function(t,e){var a=n.jm.view.get_binded_nodeid(e),o=n.jm.get_node(a);o.data.toolTip?(n.toolTip.down("container").setConfig({html:o.data.toolTip}),n.toolTip.showAt(t.getPoint())):n.toolTip.down("container").setConfig({html:""})}),l.on("mouseout",function(t,e){n.toolTip.hide()})}}},setJmData:function(t){var e=this;e.jmData=t,e.rendered&&e.showJm()},getJmData:function(){var t=this,e=t.jm.get_data("node_array");return t.jmData=e.data,t.jmData}});
Ext.define("Fm.ux.TabCloseMenu",{extend:"Ext.plugin.Abstract",alias:"plugin.tabclosemenu",mixins:{observable:"Ext.util.Observable"},closeTabText:"Close Tab",showCloseOthers:!0,closeOthersTabsText:"Close Other Tabs",showCloseAll:!0,closeAllTabsText:"Close All Tabs",extraItemsHead:null,extraItemsTail:null,constructor:function(e){this.callParent([e]),this.mixins.observable.constructor.call(this,e)},init:function(e){this.tabPanel=e,this.tabBar=e.down("tabbar"),this.mon(this.tabPanel,{scope:this,afterlayout:this.onAfterLayout,single:!0})},onAfterLayout:function(){this.mon(this.tabBar.el,{scope:this,contextmenu:this.onContextMenu,delegate:".x-tab"})},destroy:function(){this.callParent(),Ext.destroy(this.menu)},onContextMenu:function(e,t){var s=this,o=s.createMenu(),l=!0,n=!0,a=s.tabBar.getChildByElement(t),i=s.tabBar.items.indexOf(a);s.item=s.tabPanel.getComponent(i),o.child("#close").setDisabled(!s.item.closable),(s.showCloseAll||s.showCloseOthers)&&(s.tabPanel.items.each(function(e){return e.closable&&(l=!1,e!==s.item)?(n=!1,!1):!0}),s.showCloseAll&&o.child("#closeAll").setDisabled(l),s.showCloseOthers&&o.child("#closeOthers").setDisabled(n)),e.preventDefault(),s.fireEvent("beforemenu",o,s.item,s),o.showAt(e.getXY())},createMenu:function(){var e=this;if(!e.menu){var t=[{itemId:"close",text:e.closeTabText,scope:e,handler:e.onClose}];(e.showCloseAll||e.showCloseOthers)&&t.push("-"),e.showCloseOthers&&t.push({itemId:"closeOthers",text:e.closeOthersTabsText,scope:e,handler:e.onCloseOthers}),e.showCloseAll&&t.push({itemId:"closeAll",text:e.closeAllTabsText,scope:e,handler:e.onCloseAll}),e.extraItemsHead&&(t=e.extraItemsHead.concat(t)),e.extraItemsTail&&(t=t.concat(e.extraItemsTail)),e.menu=Ext.create("Ext.menu.Menu",{items:t,listeners:{hide:e.onHideMenu,scope:e}})}return e.menu},onHideMenu:function(){var e=this;e.fireEvent("aftermenu",e.menu,e)},onClose:function(){this.tabPanel.remove(this.item)},onCloseOthers:function(){this.doClose(!0)},onCloseAll:function(){this.doClose(!1)},doClose:function(e){var t=[];this.tabPanel.items.each(function(s){s.closable&&(e&&s===this.item||t.push(s))},this),Ext.suspendLayouts(),Ext.Array.forEach(t,function(e){this.tabPanel.remove(e)},this),Ext.resumeLayouts(!0)}});
window._fmapp_now_mask_view="";var app,application;Ext.define("Fm.base.Application",{extend:"Ext.app.Application",enabled:!0,alternateClassName:["Fm.BaseApp"],requires:["Ext.window.Toast","Ext.window.MessageBox"],launch:function(){Ext.tip.QuickTipManager.init(),app=application=this,app.globalMask=new Ext.LoadMask({msg:AppConfig.maskHtml,style:{backgroundColor:"rgba(255, 255, 255, 0.5);",zIndex:"90000000"},border:!1,target:app.getMainView()}),document.getElementById("start_main").style.display="none"},mask:null,masks:{},showMask:function(a,o){var t=application,e=t.getMainView().down(a+"[maskParam="+o+"]"),n=(a||"")+(o||"");if(e||(e=t.getMainView().down(a)),window._fmapp_now_mask_view=n,n?e&&(t.masks[n]||(t.masks[n]=new Ext.LoadMask({msg:AppConfig.maskHtml,style:{backgroundColor:"rgba(255, 255, 255, 0.5);"},border:!1,target:e})),t.masks[n].show()):t.globalMask.show(),!a){Ext.log.error("[showMask] 需要传入view参数.");try{{a.exception}}catch(i){Ext.log.error(i.stack)}}},hideMask:function(a,o){var t=application,e=(a||"")+(o||"");if(e?t.masks[e]&&(Ext.destroy(t.masks[e]),t.masks[e]=void 0):t.globalMask.hide(),!a){Ext.log.error("[showMask] 需要传入view参数.");try{{a.exception}}catch(n){Ext.log.error(n.stack)}}},loginOut:function(a){application.showMask();var o=function(){return t=window.location.pathname.toLowerCase(),t.substr(0,AppConfig.urlStartWith.length)===AppConfig.urlStartWith&&(t=t.substr(0,AppConfig.urlStartWith.length)),"/"===t.substr(t.length-1,1)&&(t=t.substr(t.length-1,1)),t.length?"/"!==t.substr(0,1)&&(t="/"+t):t="_default",t},t=o(),e=Fm.Server.Config.AppNameInfo[t]||Fm.Server.Config.AppNameInfo._default,n=Fm.Server.Config.AppIcoInfo[t]||Fm.Server.Config.AppIcoInfo._default;window.location=AppConfig.loginOutUrl+"?url="+escape(window.location.href)+"&name="+escape(e)+"&logo="+escape(window.location.origin+AppConfig.urlStartWith+n)},addBookmark:function(a,o,t,e){var n=application.getMainView(),i=n.down("sysuser_userbookmark");i.getController().addBookmark(a,o,t,e)},addTestPage:function(a){this._mainView.getController().addTabForTest(a)}});
Ext.define("Fm.base.Grid",{extend:"Ext.grid.Panel",alias:"widget.cisgrid",requires:["Fm.ux.CisPagingToolBar"],isPage:!0,pageSizes:null,loadMask:!1,multiColumnSort:!0,initComponent:function(){var t,e,s,a=this;if(a.isPage)try{try{s=a.store||a.getBind().store.getValue()}catch(i){}(!s||s.isEmptyStore)&&a.config.bind&&a.config.bind.store&&(e=Ext.String.trim(a.config.bind.store).replace("{","").replace("}",""),t=a.getViewModel(),s=t.getStore(e)),a.buttons&&a.buttons.length>0?(Ext.apply(this,{dockedItems:{xtype:"panel",dock:"bottom",items:[new Fm.ux.CisPagingToolBar({displayInfo:!0,displayMsg:"显示{0}-{1}&nbsp;共{2}条",store:s,pageSizes:a.pageSizes||"10,50,100,500,1000,3000"})],buttons:a.buttons}}),a.buttons=void 0):Ext.apply(this,{bbar:new Fm.ux.CisPagingToolBar({displayInfo:!0,displayMsg:"显示{0}-{1}&nbsp;共{2}条",store:s,pageSizes:a.pageSizes||"10,50,100,500,1000,3000"})})}catch(i){Ext.log.error(i.stack)}a.viewConfig=Ext.apply({loadMask:a.loadMask,getRowClass:function(t,e,s,a){var i="";return(t._rowclass||t.data._rowclass)&&(i+=t._rowclass||t.data._rowclass),i?i:void 0}},a.viewConfig),a.callParent(arguments)}});
Ext.define("Fm.base.GridController",{extend:"Ext.app.ViewController",alias:"controller.cisgrid",operationView:"",autoLoad:!1,init:function(){var e=this,t=e.getView().xtype,r={};r[t]={afterrender:e.selfRender},r[t+" cispagingtoolbar"]={beforechange:e.beforePageChange},e.control(r,e),e.callParent(arguments),e.initSelfEvents()},getGridStore:function(){var e,t,r=this;return r.__gridStore||(e=this.getView(),t=e.getStore(),t.isEmptyStore&&(t=e.getBind().store.getValue()),r.__gridStore=t),r.__gridStore},initSelfEvents:function(){var e=this,t=e.getGridStore();e.dataChanged&&t.on("datachanged",e.dataChanged,e),e.dataLoaded&&t.on("load",e.dataLoaded,e)},selfRender:function(){var e=this,t=e.getGridStore();e.autoLoad&&!t.autoLoad&&e.refresh()},doFilter:function(e){var t,r,a=this,i=a.getView(),n=a.getGridStore(),l=Ext.clone(e.filterConfig),o=e.id+"_filter";if(i.filterArray||(i.filterArray={}),r=i.filterArray,n.clearFilter(!1),!(n.getDataSource().items.length<0)){t=a.getFilter(l,e.getValue()),r[o]=t;var s=[];for(var u in r)r[u]&&s.push(r[u]);var f;s.length>0&&(f=n.filter(s)),e.filterCallBack&&e.filterCallBack.call(e,a.getView(),n)}},filter:function(e){var t=this;t.doFilter(e)},isFilter:function(e,t,r){var a=!1;if(r&&"list"===r)t&&(Ext.isArray(t)||(t=t.split(",")),t.length>0&&(a=!0));else switch(e){case"string":t=(t||"").toString(),t&&(a=!0);break;case"date":t&&(t=Date.parse(t),t&&(a=!0));break;case"number":t=parseFloat(t),isNaN(t)||(a=!0);break;case"int":t=parseInt(t,10),isNaN(t)||(a=!0)}return a},getFilterValue:function(e,t){switch(e){case"string":t=0===t?"0":(t||"").toString();break;case"date":t=Date.parse(t);break;case"number":t=parseFloat(t);break;case"int":t=parseInt(t,10)}return t},getFilterListValue:function(e,t){var r=this;if(t){Ext.isArray(t)||(t=t.split(","));for(var a=[],i=0;i<t.length;i++)"int"===e||"number"===e?(t||0===t)&&a.push(r.getFilterValue(e,t[i])):t&&a.push(r.getFilterValue(e,t[i]));if(a.length>0)return a}return null},getFilter:function(e,t){var r,a=this;if(e.type&&"filter"===e.type)return e.filter._cmpValue=t,e.filter;Ext.isArray(e)||(e=[e]);var i=Ext.Array.filter(e,function(e){return a.isFilter(e.type,t,e.valueType)});if(i.length>1){for(var n=[],l=!1,o=0;o<i.length;o++)if("list"===i[o].valueType){var s=a.getFilterListValue(i[o].type,t);l=s.length>1,1===s.length&&(s=s[0],delete i[o].valueType),n.push(s)}else n.push(a.getFilterValue(i[o].type,t));r=l?{filterFn:function(e){for(var t=0;t<i.length;t++)if("list"===i[t].valueType){if(Ext.Array.findBy(n[t],function(r){return Fm.Common.Util.comp(i[t].operator,a.getFilterValue(i[t].type,e.data[i[t].property]),r)}))return!0}else if(Fm.Common.Util.comp(i[t].operator,a.getFilterValue(i[t].type,e.data[i[t].property]),n[t]))return!0;return!1}}:{filterFn:function(e){for(var t=0;t<i.length;t++)if(Fm.Common.Util.comp(i[t].operator,a.getFilterValue(i[t].type,e.data[i[t].property]),n[t]))return!0;return!1}}}else if(1===i.length){var u=i[0],l=!1;if("list"===u.valueType){var s=a.getFilterListValue(u.type,t);l=s.length>1,1===s.length&&(s=s[0],delete u.valueType),t=s}else t=a.getFilterValue(u.type,t);r=l?{filterFn:function(e){return Ext.Array.findBy(t,function(t){return Fm.Common.Util.comp(u.operator,a.getFilterValue(u.type,e.data[u.property]),t)})?!0:void 0}}:{filterFn:function(e){return Fm.Common.Util.comp(u.operator,a.getFilterValue(u.type,e.data[u.property]),t)}}}return r},getRefreshParams:function(){return{}},beforePageChange:function(){var e=this;return e.getGridStore().isRequiresPage=!1,e.addParams()},addParams:function(){var e=this.getRefreshParams();return e!==!1?(this.getGridStore().outParams=e,!0):!1},refresh:function(){this.getGridStore().isRequiresPage=!0,this.refreshByParams()},refreshByParams:function(e){var t=this,r=t.addParams();r!==!1&&setTimeout(function(){t.getGridStore().loadPage(1,e)},10)}});
Ext.define("Fm.base.MainController",{extend:"Ext.app.ViewController",requires:["Ext.window.MessageBox"],mainRender:function(){var e=this;Ext.History.init(),Ext.History.on("change",function(t){var i=t;i||(i=0),e.openNewTab(i)});var t=Ext.History.getToken();if(t&&"0"!==t.toString()||(t=AppConfig.defaultMenuId),t)var i=setInterval(function(){application&&(clearInterval(i),e.openNewTab(t))},30)},deSelectMenuById:function(e){var t=this,i=t.getView().down("treelist");e&&i.getItem(e).updateSelected(!1)},selectMenuById:function(e){var t,i=this,a=i.getView().down("treelist"),n=a.getStore();t=n.getAt(n.findBy(function(t){return t.get("Id")==e})),t&&(a.getItem(t).updateSelected(!0),i.lastSelectedRecord=t)},tabChange:function(e,t){var i,a=this,n=a.getView();if(null!==t.menuId&&void 0!==t.menuId){var r=t.menuId;Ext.History.add(r);try{var i=n.down("container[msgarea=msgarea]");i.removeAll(!0),t.msgItems&&i.add(t.msgItems)}catch(s){}return!1}},toggleMenu:function(e){var t=this,i=t.getView().down("treelist"),a=i.ownerCt;void 0===t.pressed&&(t.pressed=AppConfig.Design.Menu.Pressed),Ext.suspendLayouts(),i.setMicro(!t.pressed),t.pressed?(a.setWidth(AppConfig.Design.Menu.MaxWidth),e.setIconCls("fa fa-angle-left")):(a.setWidth(AppConfig.Design.Menu.MinWidth),e.setIconCls("fa fa-angle-right")),Cookie.set(AppConfig.cookieStartWith+"main-left-panel-micro",!t.pressed,365),t.pressed=!t.pressed,Ext.isIE8&&this.repaintList(i,!t.pressed),Ext.GlobalEvents.fireEvent("resize"),Ext.resumeLayouts(!0)},mainResize:function(){return Ext.util.CSS.removeStyleSheet("x-treelist-item-floated-height"),Ext.util.CSS.createStyleSheet(".x-treelist-nav .x-treelist-item-floated .x-treelist-container{max-height:"+(this.getView().getHeight()-36)+"px;overflow-y:auto;}","x-treelist-item-floated-height"),!0},openNewTab:function(e,t){var i,a,n=this,r=n.getView(),s=r.down(n.xtypeStartWith+"-maintab"),o=r.down(n.xtypeStartWith+"-mainleft").down("treelist"),l=o.getStore();if(n.deSelectMenuById(n.lastSelectedRecord),"0"===e.toString())return s.setActiveTab(Ext.getCmp("main_tab_0")),!1;if(i=Ext.Array.findBy(Fm.Server.Menus,function(t){return t.Id.toString()===e.toString()}),!i)return!1;0!==i.ParentId&&(a=l.getAt(l.findBy(function(e){return e.get("Id")==i.ParentId})),a&&o.getItem(a).expand()),n.selectMenuById(e);var c="main_tab_"+i.Id,d=Ext.getCmp(c);try{d?(s.setActiveTab(d),t&&d[t.event]&&d[t.event].call(d,t.params)):(application.globalMask.show(),setTimeout(function(){try{d=Ext.create(i.MenuView,{id:c,menuId:e,closable:!0,iconCls:i.iconCls,closeAction:"destroy",autoDestroy:!0,title:i.Name,cls:"cis-panel-default",frame:!1,border:!1,maskParam:(i.ViewParams||{}).maskParam,viewParams:i.ViewParams,listeners:{afterrender:function(e){application.globalMask.hide(),t&&d[t.event]&&d[t.event].call(d,t.params)}}})}catch(a){Ext.log.error(a.stack)}d&&(s.add(d),s.setActiveTab(d))},10))}catch(g){Ext.log.error(g.stack)}},repaintList:function(e,t){e.getStore().getRoot().cascadeBy(function(i){var a,n;a=e.getItem(i),a&&a.isTreeListItem&&(t?(n=a.getToolElement(),n&&n.isVisible(!0)&&n.syncRepaint()):a.element.isVisible(!0)&&(a.iconElement.syncRepaint(),a.expanderElement.syncRepaint()))})},addTabForTest:function(e){var t=this,i=t.getView(),a=i.down(t.xtypeStartWith+"-maintab"),n="main_tab_"+e.replace(/./g,"-"),r=Ext.getCmp(n);try{r?a.setActiveTab(r):(application.globalMask.show(),setTimeout(function(){try{r=Ext.create(e,{id:n,closable:!0,closeAction:"destroy",autoDestroy:!0,title:e,cls:"cis-panel-default",frame:!1,border:!1,isTest:!0})}catch(t){Ext.log.error(t.stack)}r&&(a.add(r),a.setActiveTab(r))},10),application.globalMask.hide())}catch(s){Ext.log.error(s.stack)}}});
Ext.define("Fm.base.Model",{extend:"Ext.data.Model"});
Ext.define("Fm.base.SearchForm",{extend:"Ext.form.Panel",alias:"widget.base_searchform",modelValidation:!0,bodyCls:"cis-searh-panel",configKey:"",searchHandler:"refresh",solutionConfig:[{index:0,solutionKey:1,conWidth:800,minWidth:0,maxWidth:999},{index:1,solutionKey:2,conWidth:1e3,minWidth:1e3,maxWidth:1199},{index:2,solutionKey:3,conWidth:1200,minWidth:1200,maxWidth:1e4}],layout:{type:"hbox",pack:"start",align:"stretch"},getSolutionInfo:function(t){var e=this,o=(!!e.record,t||Ext.getCmp("ViewPortCoreTab").getWidth());return Ext.Array.findBy(e.solutionConfig,function(t){return o>=t.minWidth&&o<=t.maxWidth})},initComponent:function(){var t=this,e=!!t.record,o=t.getSolutionInfo();if(t._layouting=!0,t.record)t._setLayoutConfig(t.record),t.layoutConfig=t.record;else{t.layoutConfigs=t.configs?t.configs:appFactory.Config.getFormItems(t.configKey);for(var i=0;i<t.layoutConfigs.length;i++)t._setLayoutConfig(t.layoutConfigs[i]);t.layoutConfig=t.layoutConfigs[o.index]}t.height=t.layoutConfig.minHeight,t.items=[{xtype:"panel",selfType:"itemsContainer",layout:{type:"table",columns:t.layoutConfig.col,itemCls:"x_seachform_item"},width:t.layoutConfig.width,padding:3,defaults:{margin:"3 0",width:186,labelAlign:"right",labelWidth:66},items:t.layoutConfig.items,dockedItems:[{dock:"right",xtype:"toolbar",layout:{type:"hbox",align:"middle"},width:130,padding:"5 0 0 0",style:{zIndex:0},cls:"cis-searh-panel",items:[{margin:"0 0 0 5",width:70,xtype:"button",text:"检索",listeners:{click:t.searchHandler},disabled:e,optype:"search"},{width:22,margin:"0 0 0 5",xtype:"button",hidden:!t.layoutConfig.isShowToggleBtn,iconCls:"fa fa-arrow-down cis-searchform-expand-btn",optype:"toggle",style:{backgroundColor:"#368ecc"},listeners:{click:t._toggleHeight,scope:t}}]}]},{xtype:"container",flex:1}],t.callParent(arguments),e||AppConfig.Design.FixedResolution||(t.on("resize",t._updateLayout,t),t.on("afterlayout",function(){t._layouting=!1},t))},_toggleHeight:function(){var t=this,e=!!t.record;e||AppConfig.Design.FixedResolution||t.un("resize",t._updateLayout,t);var o,i=t.layoutConfig,n=t.down("panel[selfType=itemsContainer]").getLayout(),a=i.minHeight,s=n.table.getHeight()+6;a>s&&(a=s),o=t.getHeight()!==a,Ext.suspendLayouts(),t.setHeight(o?a:s),t.down("button[optype=toggle]").setIconCls(o?"fa fa-arrow-down cis-searchform-expand-btn":"fa fa-arrow-up cis-searchform-expand-btn"),Ext.resumeLayouts(!0),e||AppConfig.Design.FixedResolution||t.on("resize",t._updateLayout,t)},_updateLayout:function(){if(!this._layouting&&this.configKey){this._layouting=!0;var t=this,e=t.down("panel[selfType=itemsContainer]"),o=e.getLayout(),i=t.getSolutionInfo(t.getWidth());if(t.layoutConfig.resolution!==i.solutionKey){t.layoutConfig=t.layoutConfigs[i.index],Ext.suspendLayouts(),o.setColumns(t.layoutConfig.col),Ext.Array.each(Ext.Array.filter(e.items.items,function(t){return"container"===t.xtype}),function(t){e.remove(t)}),e.setWidth(i.conWidth),t.setHeight(t.layoutConfig.minHeight);var n=t.down("button[optype=toggle]");n.setHidden(!t.layoutConfig.isShowToggleBtn),Ext.resumeLayouts(!0)}}},_setLayoutConfig:function(t){var e=this,o=!!e.record,i=0;Ext.Array.each(t.items,function(e,n){var a=e.colspan||1;(i+1)%t.col===0&&(a=1),i+=a;var s=o&&e.items?e.items[0]:e,l=(s.fieldLabel||"").toString(),r=l.trim().length+(l.match(/[^x00-xff]/g)||[]).length;r>8&&(s.labelWidth=66+6*(r-8)),e.labelPad=0,e.maxHeight=25;var g=function(t){t.listeners||(t.listeners={}),t.listeners.specialkey=function(t,e){if(e.getKey()==e.ENTER){t.up("base_searchform").down("button[optype=search]").fireEvent("click")}},t.labelPad=0};e.items&&e.items.length>0?Ext.Array.each(e.items,function(t){t.margin=0,g(t)}):g(e)});var n=Math.ceil(i/t.col);t.minHeight=t.row*(o?31:30)+(o?7:6),t.width=Ext.Array.findBy(e.solutionConfig,function(e){return e.solutionKey===t.resolution}).conWidth,t.isShowToggleBtn=n>t.row}});
Ext.define("Fm.base.Store",{extend:"Ext.data.Store",outParams:{},pageSize:Fm.Server.Config.PageRowCount||10,autoLoad:!1,isRequiresPage:!0,latestTotalCount:0,proxy:{type:"ajax",actionMethods:{create:"POST",read:"POST",update:"POST",destroy:"POST"},reader:{type:"json",rootProperty:"Result",successProperty:"IsSuccess",messageProperty:"ErrMsg",totalProperty:"TotalCount"},limitParam:"PageSize",pageParam:"PageNum",startParam:"StartIndex",timeout:AppConfig.ajaxTimeOut},listeners:{beforeload:function(t,a,e){var o=this;if(o.lastTotalCount=t.totalCount,o.isRequiresPage)o.outParams.TotalCount=0;else try{o.outParams.TotalCount=t.totalCount||0}catch(r){}Ext.apply(t.proxy.extraParams,o.outParams),setTimeout(function(){var a=t.getProxy();if(a){var e=a.api.readTotalCount;e&&(o.isRequiresPage?(t.fireEvent("beforeUpdatePageInfo"),Ext.Ajax.request({url:e,method:"post",callback:function(a,e,r){if(e){var s=Ext.JSON.decode(r.responseText);t.totalCount=s.Result,t.latestTotalCount=s.Result,o.updateTotalCount(),t.fireEvent("updatePageInfo")}},params:t.proxy.extraParams})):t.totalCount=o.lastTotalCount)}},1e3)},load:function(t){var a=this,e=t.getProxy().api.readTotalCount;e&&a.updateTotalCount()}},clearAll:function(t){this.outParams={},this.proxy.extraParams={},this.removeAll(t||!1)},updateTotalCount:function(){var t=this;t.totalCount=t.latestTotalCount}});
Ext.ns("Fm").msg={show:function(n,r){setTimeout(function(){Ext.toast({title:r,html:n,closable:!0,align:"br",frame:!1,slideInDuration:300,minHeight:80,width:400,minWidth:400})},50)},info:function(n,r){Fm.msg.show("<span>"+(n||"")+"</span>",r||"提示")},notify:function(n,r){Fm.msg.show("<span>"+(n||"")+"</span>",r||"通知")},warn:function(n,r){Fm.msg.show('<span style="color:rgb(246, 252, 5)">'+(n||"")+"</span>",r||"警告")},error:function(n,r){n&&Fm.msg.show('<span style="color:#ff0000">'+(n||"")+"</span>",r||"错误")},devError:function(n){AppConfig.isDev&&!AppConfig.isCompile&&Ext.log.error(n)}},Ext.ns("Fm").Array={eachSync:function(n,r,t,o){var e=n.length,i=o||200,a=0,f=Math.ceil(e/i),s=!1;if(1>e)return void(t&&t());if(i>=e){for(var u=0;e>u;u++){var c=r(n[u],u);if(c===!1)break}return void(t&&t())}var l=function(t){for(var o=t*i,a=t===f-1?e:o+i,u=o;a>u;u++){var c=r(n[u],u);if(s||c===!1){s=!0;break}}},h=function(n){return function(){l(n),a++}};if(Ext&&Ext.Deferred){for(var v=[],u=0;f>u;u++)v.push(h(u));Ext.Deferred.parallel(v).then(t||function(){})}else{for(var u=0;f>u;u++)setTimeout(h(u),5*u);var m=setInterval(function(){a===f&&0!=a&&(clearInterval(m),t&&t())},50)}},group:function(n,r){var t={};return Ext.Array.forEach(n,function(n){t[n[r]]?t[n[r]].push(n):t[n[r]]=[n]}),t},tier:function(n,r,t,o,e,i,a){var f=function(o){for(var s=[],u=0;u<n.length;u++){var c=n.shift();o[r]===c[t]?(s.push(c),u--):n.push(c)}for(var u=0;u<s.length;u++)f(s[u]),a&&a(s[u])===!1&&(s=Ext.Array.removeAt(s,u),u--);i&&(o.checked=o[i]),s.length>0?o.children=s:e&&(o.leaf=!0)};return f(o),o}};
function fmDataFactory(t){this.nsStartWith=t.nsStartWith}function fmUiFactory(t){this.nsStartWith=t.nsStartWith}function fmCommonFactory(t){return{Data:new fmDataFactory({nsStartWith:(t.appName||AppConfig.appName)+".Server.Datas"}),Config:new fmUiFactory({nsStartWith:(t.appName||AppConfig.appName)+".Config"})}}fmDataFactory.prototype.getDatas=function(t,r){return Ext.ns(this.nsStartWith)[t]},fmDataFactory.prototype.getDataStore=function(t,r,e){var n=this,o=n.getDatas(t);o||(Fm.msg.devError("[fmDataFactory-getDataStore]"+n.nsStartWith+": "+t+" 不存在。"),o=[]);var a=[];r&&(a=e||[{Value:-1,Text:"全部"}]),a=Ext.Array.push(a,Ext.Array.filter(o,function(t){return t.IsAlloted===!0}));var i=Ext.create("Ext.data.Store",{fields:["Value","Text"],data:a});return i},fmDataFactory.prototype.getAllDataStore=function(t,r,e){var n=this,o=n.getDatas(t);o||(Fm.msg.devError("[fmDataFactory-getAllDataStore]"+n.nsStartWith+": "+t+" 不存在。"),o=[]);var a=[];r&&(a=e||[{Value:-1,Text:"全部"}]),a=Ext.Array.push(a,o);var i=Ext.create("Ext.data.Store",{fields:["Value","Text"],data:a});return i},fmDataFactory.prototype.judgePrivilege=function(t){return Ext.log.warn("此方法(appFactory.Data.judgePrivilege)不建议继续使用，替代：fmService.Sys.isPermission(key)"),null!=Ext.Array.findBy(this.getDatas("Privileges"),function(r){return r.Value===t&&r.IsAlloted})},fmUiFactory.prototype.getAllItems=function(t){var r=this,e=Ext.ns(t);return"function"!=typeof e&&(e=Ext.ns(t)),"function"!=typeof e&&(e=Ext.ns(r.nsStartWith+"."+t)),"function"==typeof e?(e=e(),1===AppConfig.isDev&&"string"!=typeof e&&Ext.Array.forEach(e,function(r){Ext.Array.filter(e,function(t){return r.configIndex==t.configIndex}).length>1&&Fm.msg.devError(t+":出现重复configIndex，值为："+r.configIndex),r.header||r.text||r.configName||r.fieldLabel||Fm.msg.devError(t+":configIndex为"+r.configIndex+"的配置项缺少名称(configName)")}),e):(Fm.msg.devError("配置信息出现异常！请检查拼写"),[])},fmUiFactory.prototype.getConfigs=function(t){var r=Ext.ns("Fm.ViewConfig");if(r[t])return r[t]();var e=t;return this.nsStartWith&&(e=this.nsStartWith+"."+t),r[e]?r[e]():null},fmUiFactory.prototype.getShowItems=function(t){return this.getGridItems(t)},fmUiFactory.prototype.getGridItems=function(t){var r=this,e=r.getAllItems(t),n=r.getConfigs(t),o=[];if(n)for(var a=0;a<n.length;a++){var i=Ext.Array.findBy(e,function(t,r){return t.configIndex==n[a].index});i&&(r.handlerGridConfig(i,n[a]),o.push(i))}else Ext.Array.forEach(e,function(t){t.configHidden||o.push(t)});return o},fmUiFactory.prototype.getFormItems=function(t){var r=this,e=r.getAllItems(t),n=r.getConfigs(t),o=[],a=[];return n?Ext.Array.forEach(n,function(t){var n={resolution:t.resolution,col:t.col,row:t.row,items:[]};Ext.Array.forEach(t.items,function(t){var o=Ext.Array.findBy(e,function(r){return r.configIndex==t.index});-1===t.index?o=r.getFormEmptyItem(t.colspan):o||(o=r.getFormEmptyItem(t.colspan)),n.items.push(o)}),a.push(n)}):(Ext.Array.forEach(e,function(t){t.configHidden||o.push(t)}),a=[{resolution:1,col:3,row:Math.ceil(o.length/3)>3?3:Math.ceil(o.length/3),items:o},{resolution:2,col:4,row:o.length>4?2:1,items:o},{resolution:3,col:5,row:o.length>5?2:1,items:o}]),a},fmUiFactory.prototype.getFormEmptyItem=function(t){return t=t||1,{xtype:"fieldcontainer",style:{backgroundColor:"transparent"},colspan:t,configIndex:-1,height:20,width:180*t}},fmUiFactory.prototype.handlerGridConfig=function(t,r){if(r.width&&(t.width=r.width,t.flex=void 0),r.exportIsCount&&(t.exportIsCount=r.exportIsCount),r.datatype)switch(r.datatype){case"Money":t.renderer=Fm.Common.Util.moneyRender("f00"),t.align="right";break;case"Date":t.renderer=Fm.Common.Util.dateTextRender()}};var appFactory=fmCommonFactory({appName:null});
function FmUtil(){}FmUtil.prototype.dateRender=function(t,r){var e=this,t=t||"Y-m-d";return function(n){var o;if(!n)return"";if(Ext.isDate(n))o=n;else{var o=e.convertISOStrToDate(n);if(!Ext.isDate(o))return""}var i=Ext.Date.format(o,t);return r?"<span style='color:#"+r+"'>"+i+"</span>":i}},FmUtil.prototype.dateMonthRender=function(){return this.dateRender("Y-m")},FmUtil.prototype.dateTimeRender=function(){return this.dateRender("Y-m-d H:i:s")},FmUtil.prototype.dateTextRender=function(){return this.dateRender("Y-m-d H:i:s")},FmUtil.prototype.dateTransfer=function(t){return this.convertISOStrToDate(t)},FmUtil.prototype.linkRender=function(t){return t?"<a href='"+t+"' target='_blank'>"+t+"</a>":""},FmUtil.prototype.booleanRender=function(t,r,e){return t&&"0"!==t?"是":"否"},FmUtil.prototype.colorRender=function(t){return function(r){return r?"<span style='color:#"+t+"'>"+r+"</span>":""}},FmUtil.prototype.convertISOStrToDate=function(t){return t?new Date(t.replace(/-/g,"/").replace(/T|Z/g," ").trim()):null},FmUtil.prototype.moneyRender=function(t,r){for(var e=r||parseInt(Fm.Server.Config.MoneyAccuracy,10)||2,n="0.",o=0;e>o;o++)n+="0";return t?function(r){return r=Ext.util.Format.round(r,e),"<span style='color:#"+t+"'>￥"+Ext.util.Format.number(r,n)+"</span>"}:function(t){return t=Ext.util.Format.round(t,e),"￥"+Ext.util.Format.number(t,n)}},FmUtil.prototype.moneyForAllowNullRender=function(t,r){for(var e=r||parseInt(Fm.Server.Config.MoneyAccuracy,10)||2,n="0.",o=0;e>o;o++)n+="0";return t?function(r){return null===r||void 0===r||0===r?"":(r=Ext.util.Format.round(r,e),"<span style='color:#"+t+"'>￥"+Ext.util.Format.number(r,n)+"</span>")}:function(t){return null===t||void 0===t||0===t?"":(t=Ext.util.Format.round(t,e),"￥"+Ext.util.Format.number(t,n))}},FmUtil.prototype.percentRender=function(){for(var t=parseInt(Fm.Server.Config.MoneyAccuracy,10)||2,r="0.",e=0;t>e;e++)r+="0";return function(t){return t=100*t,Ext.util.Format.number(t,r)+"%"}},FmUtil.prototype.dataTextRender=function(t){return function(r){if(void 0!==r&&null!==r&&""!==r){var e=Ext.Array.findBy(t,function(t,e){return t.Value==r});if(e)return e.Text}return""}},FmUtil.prototype.columnPanelBuild=function(t){var r={xtype:"container",layout:"column",defaults:{xtype:"textfield",margin:"5 0 0 0",labelAlign:"right",labelWidth:80,columnWidth:.5},items:t};return r},FmUtil.prototype.comp=function(t,r,e){switch(t){case">":return r>e;case">=":return r>=e;case"<":return e>r;case"=":case"===":return r===e;case"==":return r==e;case"<=":return e>=r;case"like":return r&&r.toLowerCase().indexOf(e.toLowerCase())>-1;case"ClikeL":return e&&e.toLowerCase().indexOf(r.toLowerCase())>-1;case"!empty":return!(!r||!r.toLowerCase());default:return!0}},FmUtil.prototype.containString=function(t,r){for(var e=0,n=0;e<t.length;e++)if(t[e]===r[n]){if(n++,n===r.length)return!0}else n=0;return!1},FmUtil.prototype.getFormErrorMsg=function(t){return errors=Ext.Array.findBy(t.getForm().monitor.items.items,function(t,r,e){return t.wasValid===!1}),errors?(errors.errorfieldLabel||errors.fieldLabel||"输入错误")+":"+errors.activeErrors.join(","):null},FmUtil.prototype.Guid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxx xxxxxx".replace(/[xy]/g,function(t){var r=16*Math.random()|0,e="x"===t?r:3&r|8;return e.toString(16)})},FmUtil.prototype.downLoadFile=function(t){var r=Ext.apply({method:"post"},t),e="down-file-form-kdkjgjkdagjfkdgh",n=Ext.fly(e);n||(n=Ext.getBody().createChild({tag:"form",id:e,name:e,method:"POST",style:"display:none"})),Ext.Ajax.request({url:r.url,form:n,isUpload:!0,params:r.data})},FmUtil.prototype.getNowDate=function(){var t=Date.parse(Fm.Server.Config.NowDate.replace(/-/g,"/")),r=Fm.Config.clientDate.getTime(),e=(new Date).getTime();return new Date(e+(t-r))},FmUtil.prototype.getNowDateStr=function(t){var t=t||"Y-m-d H:i:s";return this.dateRender(t)(this.getNowDate())},FmUtil.prototype.numberRender=function(t){for(var r=parseInt(Fm.Server.Config.NumberAccuracy,10)||0,e="0.",n=0;r>n;n++)e+="0";return t?function(r){return"<span style='color:#"+t+"'>"+Ext.util.Format.number(r,e)+"</span>"}:function(t){return Ext.util.Format.number(t,e)}},FmUtil.prototype.getTips=function(){return Fm.log.warn("Util.getTips过期，替代：列属性配置：showTip:true"),function(t,r,e){return null!==r&&(r.tdAttr='data-qtip="'+t+'"'),t}},FmUtil.prototype.stringToZipAsync=function(t){var r=new JSZip;return r.file("param.txt",t),r.generateAsync({type:"base64",compression:"DEFLATE",compressionOptions:{level:9}})};var fmUtil=Ext.ns("Fm.Common").Util=new FmUtil;
Ext.ns("FmApp.Common").Core={Shared:{getMenuData:function(){var e=Fm.Server.Menus,r=function(t,a){for(var n=Ext.Array.filter(e,function(e,r){return e.ParentId===t&&"_"!==e.Name}),i=0;i<n.length;i++){var u=n[i];a||(u.iconCls=u.Icon&&""!=Ext.String.trim(u.Icon)?u.Icon:"fa fa-chevron-right"),u.ViewParams&&"string"==typeof u.ViewParams&&(u.ViewParams=Ext.JSON.decode(u.ViewParams)),u.text=u.Name;var o=r(u.Id,!0);o.length>0?u.children=o:u.leaf=!0}return n};return r(0)},getForData:function(e){var r=function(e,t){if(e){for(var a=[],n=0;n<e.length;n++){if(!Ext.isArray(e[n].Value)){for(var i=[],u=0;u<e.length;u++)i[u]={GroupRuleBit:t+"|"+e[u].RuleBit,RuleBit:e[u].RuleBit,value:e[u].RuleBit,text:e[u].Name,Id:e[u].Id,leaf:!0,checked:!1};return i}a[n]={text:e[n].Text,leaf:!1,checked:!1,children:r(e[n].Value,e[n].Text)}}return a}};return r(e)}}};
var fmAppFactory=fmCommonFactory({appName:"FmApp"});
Ext.ns("FmApp.Common").Service={Sys:{isPermission:function(e){return null!=Ext.Array.findBy(fmAppFactory.Data.getDatas("Privileges"),function(n){return n.Value===e&&n.IsAlloted})}}};var fmService=Ext.ns("FmApp.Common").Service;